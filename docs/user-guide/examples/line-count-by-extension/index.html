<!DOCTYPE HTML>
<meta charset="utf-8">
<head>

<!--
    NOTE: This HTML file was generated automatically by "mjob share" from the
    Manta CLI toolkit.  Do not edit this file directly.
 -->

<title>Line count by file extension</title>

<script type="text/javascript">

/* BEGIN contents of highlight.pack.js (distributed under the BSD license) */
var hljs=new function(){function l(o){return o.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}function b(p){for(var o=p.firstChild;o;o=o.nextSibling){if(o.nodeName=="CODE"){return o}if(!(o.nodeType==3&&o.nodeValue.match(/\s+/))){break}}}function h(p,o){return Array.prototype.map.call(p.childNodes,function(q){if(q.nodeType==3){return o?q.nodeValue.replace(/\n/g,""):q.nodeValue}if(q.nodeName=="BR"){return"\n"}return h(q,o)}).join("")}function a(q){var p=(q.className+" "+q.parentNode.className).split(/\s+/);p=p.map(function(r){return r.replace(/^language-/,"")});for(var o=0;o<p.length;o++){if(e[p[o]]||p[o]=="no-highlight"){return p[o]}}}function c(q){var o=[];(function p(r,s){for(var t=r.firstChild;t;t=t.nextSibling){if(t.nodeType==3){s+=t.nodeValue.length}else{if(t.nodeName=="BR"){s+=1}else{if(t.nodeType==1){o.push({event:"start",offset:s,node:t});s=p(t,s);o.push({event:"stop",offset:s,node:t})}}}}return s})(q,0);return o}function j(x,v,w){var p=0;var y="";var r=[];function t(){if(x.length&&v.length){if(x[0].offset!=v[0].offset){return(x[0].offset<v[0].offset)?x:v}else{return v[0].event=="start"?x:v}}else{return x.length?x:v}}function s(A){function z(B){return" "+B.nodeName+'="'+l(B.value)+'"'}return"<"+A.nodeName+Array.prototype.map.call(A.attributes,z).join("")+">"}while(x.length||v.length){var u=t().splice(0,1)[0];y+=l(w.substr(p,u.offset-p));p=u.offset;if(u.event=="start"){y+=s(u.node);r.push(u.node)}else{if(u.event=="stop"){var o,q=r.length;do{q--;o=r[q];y+=("</"+o.nodeName.toLowerCase()+">")}while(o!=u.node);r.splice(q,1);while(q<r.length){y+=s(r[q]);q++}}}}return y+l(w.substr(p))}function f(q){function o(s,r){return RegExp(s,"m"+(q.cI?"i":"")+(r?"g":""))}function p(y,w){if(y.compiled){return}y.compiled=true;var s=[];if(y.k){var r={};function z(A,t){t.split(" ").forEach(function(B){var C=B.split("|");r[C[0]]=[A,C[1]?Number(C[1]):1];s.push(C[0])})}y.lR=o(y.l||hljs.IR,true);if(typeof y.k=="string"){z("keyword",y.k)}else{for(var x in y.k){if(!y.k.hasOwnProperty(x)){continue}z(x,y.k[x])}}y.k=r}if(w){if(y.bWK){y.b="\\b("+s.join("|")+")\\s"}y.bR=o(y.b?y.b:"\\B|\\b");if(!y.e&&!y.eW){y.e="\\B|\\b"}if(y.e){y.eR=o(y.e)}y.tE=y.e||"";if(y.eW&&w.tE){y.tE+=(y.e?"|":"")+w.tE}}if(y.i){y.iR=o(y.i)}if(y.r===undefined){y.r=1}if(!y.c){y.c=[]}for(var v=0;v<y.c.length;v++){if(y.c[v]=="self"){y.c[v]=y}p(y.c[v],y)}if(y.starts){p(y.starts,w)}var u=[];for(var v=0;v<y.c.length;v++){u.push(y.c[v].b)}if(y.tE){u.push(y.tE)}if(y.i){u.push(y.i)}y.t=u.length?o(u.join("|"),true):{exec:function(t){return null}}}p(q)}function d(D,E){function o(r,M){for(var L=0;L<M.c.length;L++){var K=M.c[L].bR.exec(r);if(K&&K.index==0){return M.c[L]}}}function s(K,r){if(K.e&&K.eR.test(r)){return K}if(K.eW){return s(K.parent,r)}}function t(r,K){return K.i&&K.iR.test(r)}function y(L,r){var K=F.cI?r[0].toLowerCase():r[0];return L.k.hasOwnProperty(K)&&L.k[K]}function G(){var K=l(w);if(!A.k){return K}var r="";var N=0;A.lR.lastIndex=0;var L=A.lR.exec(K);while(L){r+=K.substr(N,L.index-N);var M=y(A,L);if(M){v+=M[1];r+='<span class="'+M[0]+'">'+L[0]+"</span>"}else{r+=L[0]}N=A.lR.lastIndex;L=A.lR.exec(K)}return r+K.substr(N)}function z(){if(A.sL&&!e[A.sL]){return l(w)}var r=A.sL?d(A.sL,w):g(w);if(A.r>0){v+=r.keyword_count;B+=r.r}return'<span class="'+r.language+'">'+r.value+"</span>"}function J(){return A.sL!==undefined?z():G()}function I(L,r){var K=L.cN?'<span class="'+L.cN+'">':"";if(L.rB){x+=K;w=""}else{if(L.eB){x+=l(r)+K;w=""}else{x+=K;w=r}}A=Object.create(L,{parent:{value:A}});B+=L.r}function C(K,r){w+=K;if(r===undefined){x+=J();return 0}var L=o(r,A);if(L){x+=J();I(L,r);return L.rB?0:r.length}var M=s(A,r);if(M){if(!(M.rE||M.eE)){w+=r}x+=J();do{if(A.cN){x+="</span>"}A=A.parent}while(A!=M.parent);if(M.eE){x+=l(r)}w="";if(M.starts){I(M.starts,"")}return M.rE?0:r.length}if(t(r,A)){throw"Illegal"}w+=r;return r.length||1}var F=e[D];f(F);var A=F;var w="";var B=0;var v=0;var x="";try{var u,q,p=0;while(true){A.t.lastIndex=p;u=A.t.exec(E);if(!u){break}q=C(E.substr(p,u.index-p),u[0]);p=u.index+q}C(E.substr(p));return{r:B,keyword_count:v,value:x,language:D}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:l(E)}}else{throw H}}}function g(s){var o={keyword_count:0,r:0,value:l(s)};var q=o;for(var p in e){if(!e.hasOwnProperty(p)){continue}var r=d(p,s);r.language=p;if(r.keyword_count+r.r>q.keyword_count+q.r){q=r}if(r.keyword_count+r.r>o.keyword_count+o.r){q=o;o=r}}if(q.language){o.second_best=q}return o}function i(q,p,o){if(p){q=q.replace(/^((<[^>]+>|\t)+)/gm,function(r,v,u,t){return v.replace(/\t/g,p)})}if(o){q=q.replace(/\n/g,"<br>")}return q}function m(r,u,p){var v=h(r,p);var t=a(r);if(t=="no-highlight"){return}var w=t?d(t,v):g(v);t=w.language;var o=c(r);if(o.length){var q=document.createElement("pre");q.innerHTML=w.value;w.value=j(o,c(q),v)}w.value=i(w.value,u,p);var s=r.className;if(!s.match("(\\s|^)(language-)?"+t+"(\\s|$)")){s=s?(s+" "+t):t}r.innerHTML=w.value;r.className=s;r.result={language:t,kw:w.keyword_count,re:w.r};if(w.second_best){r.second_best={language:w.second_best.language,kw:w.second_best.keyword_count,re:w.second_best.r}}}function n(){if(n.called){return}n.called=true;Array.prototype.map.call(document.getElementsByTagName("pre"),b).filter(Boolean).forEach(function(o){m(o,hljs.tabReplace)})}function k(){window.addEventListener("DOMContentLoaded",n,false);window.addEventListener("load",n,false)}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=m;this.initHighlighting=n;this.initHighlightingOnLoad=k;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.BE={b:"\\\\[\\s\\S]",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(q,r){var o={};for(var p in q){o[p]=q[p]}if(r){for(var p in r){o[p]=r[p]}}return o}}();hljs.LANGUAGES.bash=function(a){var g="true false";var e="if then else elif fi for break continue while in do done echo exit return set declare";var c={cN:"variable",b:"\\$[a-zA-Z0-9_#]+"};var b={cN:"variable",b:"\\${([^}]|\\\\})+}"};var h={cN:"string",b:'"',e:'"',i:"\\n",c:[a.BE,c,b],r:0};var d={cN:"string",b:"'",e:"'",c:[{b:"''"}],r:0};var f={cN:"test_condition",b:"",e:"",c:[h,d,c,b],k:{literal:g},r:0};return{k:{keyword:e,literal:g},c:[{cN:"shebang",b:"(#!\\/bin\\/bash)|(#!\\/bin\\/sh)",r:10},c,b,a.HCM,h,d,a.inherit(f,{b:"\\[ ",e:" \\]",r:0}),a.inherit(f,{b:"\\[\\[ ",e:" \\]\\]"})]}}(hljs);hljs.LANGUAGES.cs=function(a){return{k:"abstract as base bool break byte case catch char checked class const continue decimal default delegate do double else enum event explicit extern false finally fixed float for foreach goto if implicit in int interface internal is lock long namespace new null object operator out override params private protected public readonly ref return sbyte sealed short sizeof stackalloc static string struct switch this throw true try typeof uint ulong unchecked unsafe ushort using virtual volatile void while ascending descending from get group into join let orderby partial select set value var where yield",c:[{cN:"comment",b:"///",e:"$",rB:true,c:[{cN:"xmlDocTag",b:"///|<!--|-->"},{cN:"xmlDocTag",b:"</?",e:">"}]},a.CLCM,a.CBLCLM,{cN:"preprocessor",b:"#",e:"$",k:"if else elif endif define undef warning error line region endregion pragma checksum"},{cN:"string",b:'@"',e:'"',c:[{b:'""'}]},a.ASM,a.QSM,a.CNM]}}(hljs);hljs.LANGUAGES.ruby=function(e){var a="[a-zA-Z_][a-zA-Z0-9_]*(\\!|\\?)?";var j="[a-zA-Z_]\\w*[!?=]?|[-+~]\\@|<<|>>|=~|===?|<=>|[<>]=?|\\*\\*|[-/+%^&*~`|]|\\[\\]=?";var g={keyword:"and false then defined module in return redo if BEGIN retry end for true self when next until do begin unless END rescue nil else break undef not super class case require yield alias while ensure elsif or include"};var c={cN:"yardoctag",b:"@[A-Za-z]+"};var k=[{cN:"comment",b:"#",e:"$",c:[c]},{cN:"comment",b:"^\\=begin",e:"^\\=end",c:[c],r:10},{cN:"comment",b:"^__END__",e:"\\n$"}];var d={cN:"subst",b:"#\\{",e:"}",l:a,k:g};var i=[e.BE,d];var b=[{cN:"string",b:"'",e:"'",c:i,r:0},{cN:"string",b:'"',e:'"',c:i,r:0},{cN:"string",b:"%[qw]?\\(",e:"\\)",c:i},{cN:"string",b:"%[qw]?\\[",e:"\\]",c:i},{cN:"string",b:"%[qw]?{",e:"}",c:i},{cN:"string",b:"%[qw]?<",e:">",c:i,r:10},{cN:"string",b:"%[qw]?/",e:"/",c:i,r:10},{cN:"string",b:"%[qw]?%",e:"%",c:i,r:10},{cN:"string",b:"%[qw]?-",e:"-",c:i,r:10},{cN:"string",b:"%[qw]?\\|",e:"\\|",c:i,r:10}];var h={cN:"function",bWK:true,e:" |$|;",k:"def",c:[{cN:"title",b:j,l:a,k:g},{cN:"params",b:"\\(",e:"\\)",l:a,k:g}].concat(k)};var f=k.concat(b.concat([{cN:"class",bWK:true,e:"$|;",k:"class module",c:[{cN:"title",b:"[A-Za-z_]\\w*(::\\w+)*(\\?|\\!)?",r:0},{cN:"inheritance",b:"<\\s*",c:[{cN:"parent",b:"("+e.IR+"::)?"+e.IR}]}].concat(k)},h,{cN:"constant",b:"(::)?(\\b[A-Z]\\w*(::)?)+",r:0},{cN:"symbol",b:":",c:b.concat([{b:j}]),r:0},{cN:"symbol",b:a+":",r:0},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{cN:"number",b:"\\?\\w"},{cN:"variable",b:"(\\$\\W)|((\\$|\\@\\@?)(\\w+))"},{b:"("+e.RSR+")\\s*",c:k.concat([{cN:"regexp",b:"/",e:"/[a-z]*",i:"\\n",c:[e.BE,d]}]),r:0}]));d.c=f;h.c[1].c=f;return{l:a,k:g,c:f}}(hljs);hljs.LANGUAGES.diff=function(a){return{c:[{cN:"chunk",b:"^\\@\\@ +\\-\\d+,\\d+ +\\+\\d+,\\d+ +\\@\\@$",r:10},{cN:"chunk",b:"^\\*\\*\\* +\\d+,\\d+ +\\*\\*\\*\\*$",r:10},{cN:"chunk",b:"^\\-\\-\\- +\\d+,\\d+ +\\-\\-\\-\\-$",r:10},{cN:"header",b:"Index: ",e:"$"},{cN:"header",b:"=====",e:"=====$"},{cN:"header",b:"^\\-\\-\\-",e:"$"},{cN:"header",b:"^\\*{3} ",e:"$"},{cN:"header",b:"^\\+\\+\\+",e:"$"},{cN:"header",b:"\\*{5}",e:"\\*{5}$"},{cN:"addition",b:"^\\+",e:"$"},{cN:"deletion",b:"^\\-",e:"$"},{cN:"change",b:"^\\!",e:"$"}]}}(hljs);hljs.LANGUAGES.javascript=function(a){return{k:{keyword:"in if for while finally var new function do return void else break catch instanceof with throw case default try this switch continue typeof delete let yield const",literal:"true false null undefined NaN Infinity"},c:[a.ASM,a.QSM,a.CLCM,a.CBLCLM,a.CNM,{b:"("+a.RSR+"|\\b(case|return|throw)\\b)\\s*",k:"return throw case",c:[a.CLCM,a.CBLCLM,{cN:"regexp",b:"/",e:"/[gim]*",i:"\\n",c:[{b:"\\\\/"}]},{b:"<",e:">;",sL:"xml"}],r:0},{cN:"function",bWK:true,e:"{",k:"function",c:[{cN:"title",b:"[A-Za-z$_][0-9A-Za-z$_]*"},{cN:"params",b:"\\(",e:"\\)",c:[a.CLCM,a.CBLCLM],i:"[\"'\\(]"}],i:"\\[|%"}]}}(hljs);hljs.LANGUAGES.xml=function(a){var c="[A-Za-z0-9\\._:-]+";var b={eW:true,c:[{cN:"attribute",b:c,r:0},{b:'="',rB:true,e:'"',c:[{cN:"value",b:'"',eW:true}]},{b:"='",rB:true,e:"'",c:[{cN:"value",b:"'",eW:true}]},{b:"=",c:[{cN:"value",b:"[^\\s/>]+"}]}]};return{cI:true,c:[{cN:"pi",b:"<\\?",e:"\\?>",r:10},{cN:"doctype",b:"<!DOCTYPE",e:">",r:10,c:[{b:"\\[",e:"\\]"}]},{cN:"comment",b:"<!--",e:"-->",r:10},{cN:"cdata",b:"<\\!\\[CDATA\\[",e:"\\]\\]>",r:10},{cN:"tag",b:"<style(?=\\s|>|$)",e:">",k:{title:"style"},c:[b],starts:{e:"</style>",rE:true,sL:"css"}},{cN:"tag",b:"<script(?=\\s|>|$)",e:">",k:{title:"script"},c:[b],starts:{e:"<\/script>",rE:true,sL:"javascript"}},{b:"<%",e:"%>",sL:"vbscript"},{cN:"tag",b:"</?",e:"/?>",c:[{cN:"title",b:"[^ />]+"},b]}]}}(hljs);hljs.LANGUAGES.markdown=function(a){return{c:[{cN:"header",b:"^#{1,3}",e:"$"},{cN:"header",b:"^.+?\\n[=-]{2,}$"},{b:"<",e:">",sL:"xml",r:0},{cN:"bullet",b:"^([*+-]|(\\d+\\.))\\s+"},{cN:"strong",b:"[*_]{2}.+?[*_]{2}"},{cN:"emphasis",b:"\\*.+?\\*"},{cN:"emphasis",b:"_.+?_",r:0},{cN:"blockquote",b:"^>\\s+",e:"$"},{cN:"code",b:"`.+?`"},{cN:"code",b:"^    ",e:"$",r:0},{cN:"horizontal_rule",b:"^-{3,}",e:"$"},{b:"\\[.+?\\]\\(.+?\\)",rB:true,c:[{cN:"link_label",b:"\\[.+\\]"},{cN:"link_url",b:"\\(",e:"\\)",eB:true,eE:true}]}]}}(hljs);hljs.LANGUAGES.css=function(a){var b={cN:"function",b:a.IR+"\\(",e:"\\)",c:[a.NM,a.ASM,a.QSM]};return{cI:true,i:"[=/|']",c:[a.CBLCLM,{cN:"id",b:"\\#[A-Za-z0-9_-]+"},{cN:"class",b:"\\.[A-Za-z0-9_-]+",r:0},{cN:"attr_selector",b:"\\[",e:"\\]",i:"$"},{cN:"pseudo",b:":(:)?[a-zA-Z0-9\\_\\-\\+\\(\\)\\\"\\']+"},{cN:"at_rule",b:"@(font-face|page)",l:"[a-z-]+",k:"font-face page"},{cN:"at_rule",b:"@",e:"[{;]",eE:true,k:"import page media charset",c:[b,a.ASM,a.QSM,a.NM]},{cN:"tag",b:a.IR,r:0},{cN:"rules",b:"{",e:"}",i:"[^\\s]",r:0,c:[a.CBLCLM,{cN:"rule",b:"[^\\s]",rB:true,e:";",eW:true,c:[{cN:"attribute",b:"[A-Z\\_\\.\\-]+",e:":",eE:true,i:"[^\\s]",starts:{cN:"value",eW:true,eE:true,c:[b,a.NM,a.QSM,a.ASM,a.CBLCLM,{cN:"hexcolor",b:"\\#[0-9A-F]+"},{cN:"important",b:"!important"}]}}]}]}]}}(hljs);hljs.LANGUAGES.http=function(a){return{i:"\\S",c:[{cN:"status",b:"^HTTP/[0-9\\.]+",e:"$",c:[{cN:"number",b:"\\b\\d{3}\\b"}]},{cN:"request",b:"^[A-Z]+ (.*?) HTTP/[0-9\\.]+$",rB:true,e:"$",c:[{cN:"string",b:" ",e:" ",eB:true,eE:true}]},{cN:"attribute",b:"^\\w",e:": ",eE:true,i:"\\n|\\s|=",starts:{cN:"string",e:"$"}},{b:"\\n\\n",starts:{sL:"",eW:true}}]}}(hljs);hljs.LANGUAGES.java=function(a){return{k:"false synchronized int abstract float private char boolean static null if const for true while long throw strictfp finally protected import native final return void enum else break transient new catch instanceof byte super volatile case assert short package default double public try this switch continue throws",c:[{cN:"javadoc",b:"/\\*\\*",e:"\\*/",c:[{cN:"javadoctag",b:"@[A-Za-z]+"}],r:10},a.CLCM,a.CBLCLM,a.ASM,a.QSM,{cN:"class",bWK:true,e:"{",k:"class interface",i:":",c:[{bWK:true,k:"extends implements",r:10},{cN:"title",b:a.UIR}]},a.CNM,{cN:"annotation",b:"@[A-Za-z]+"}]}}(hljs);hljs.LANGUAGES.php=function(a){var e={cN:"variable",b:"\\$+[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*"};var b=[a.inherit(a.ASM,{i:null}),a.inherit(a.QSM,{i:null}),{cN:"string",b:'b"',e:'"',c:[a.BE]},{cN:"string",b:"b'",e:"'",c:[a.BE]}];var c=[a.BNM,a.CNM];var d={cN:"title",b:a.UIR};return{cI:true,k:"and include_once list abstract global private echo interface as static endswitch array null if endwhile or const for endforeach self var while isset public protected exit foreach throw elseif include __FILE__ empty require_once do xor return implements parent clone use __CLASS__ __LINE__ else break print eval new catch __METHOD__ case exception php_user_filter default die require __FUNCTION__ enddeclare final try this switch continue endfor endif declare unset true false namespace trait goto instanceof insteadof __DIR__ __NAMESPACE__ __halt_compiler",c:[a.CLCM,a.HCM,{cN:"comment",b:"/\\*",e:"\\*/",c:[{cN:"phpdoc",b:"\\s@[A-Za-z]+"}]},{cN:"comment",eB:true,b:"__halt_compiler.+?;",eW:true},{cN:"string",b:"<<<['\"]?\\w+['\"]?$",e:"^\\w+;",c:[a.BE]},{cN:"preprocessor",b:"<\\?php",r:10},{cN:"preprocessor",b:"\\?>"},e,{cN:"function",bWK:true,e:"{",k:"function",i:"\\$|\\[|%",c:[d,{cN:"params",b:"\\(",e:"\\)",c:["self",e,a.CBLCLM].concat(b).concat(c)}]},{cN:"class",bWK:true,e:"{",k:"class",i:"[:\\(\\$]",c:[{bWK:true,eW:true,k:"extends",c:[d]},d]},{b:"=>"}].concat(b).concat(c)}}(hljs);hljs.LANGUAGES.python=function(a){var f={cN:"prompt",b:"^(>>>|\\.\\.\\.) "};var c=[{cN:"string",b:"(u|b)?r?'''",e:"'''",c:[f],r:10},{cN:"string",b:'(u|b)?r?"""',e:'"""',c:[f],r:10},{cN:"string",b:"(u|r|ur)'",e:"'",c:[a.BE],r:10},{cN:"string",b:'(u|r|ur)"',e:'"',c:[a.BE],r:10},{cN:"string",b:"(b|br)'",e:"'",c:[a.BE]},{cN:"string",b:'(b|br)"',e:'"',c:[a.BE]}].concat([a.ASM,a.QSM]);var e={cN:"title",b:a.UIR};var d={cN:"params",b:"\\(",e:"\\)",c:["self",a.CNM,f].concat(c)};var b={bWK:true,e:":",i:"[${=;\\n]",c:[e,d],r:10};return{k:{keyword:"and elif is global as in if from raise for except finally print import pass return exec else break not with class assert yield try while continue del or def lambda nonlocal|10",built_in:"None True False Ellipsis NotImplemented"},i:"(</|->|\\?)",c:c.concat([f,a.HCM,a.inherit(b,{cN:"function",k:"def"}),a.inherit(b,{cN:"class",k:"class"}),a.CNM,{cN:"decorator",b:"@",e:"$"},{b:"\\b(print|exec)\\("}])}}(hljs);hljs.LANGUAGES.sql=function(a){return{cI:true,c:[{cN:"operator",b:"(begin|start|commit|rollback|savepoint|lock|alter|create|drop|rename|call|delete|do|handler|insert|load|replace|select|truncate|update|set|show|pragma|grant)\\b(?!:)",e:";",eW:true,k:{keyword:"all partial global month current_timestamp using go revoke smallint indicator end-exec disconnect zone with character assertion to add current_user usage input local alter match collate real then rollback get read timestamp session_user not integer bit unique day minute desc insert execute like ilike|2 level decimal drop continue isolation found where constraints domain right national some module transaction relative second connect escape close system_user for deferred section cast current sqlstate allocate intersect deallocate numeric public preserve full goto initially asc no key output collation group by union session both last language constraint column of space foreign deferrable prior connection unknown action commit view or first into float year primary cascaded except restrict set references names table outer open select size are rows from prepare distinct leading create only next inner authorization schema corresponding option declare precision immediate else timezone_minute external varying translation true case exception join hour default double scroll value cursor descriptor values dec fetch procedure delete and false int is describe char as at in varchar null trailing any absolute current_time end grant privileges when cross check write current_date pad begin temporary exec time update catalog user sql date on identity timezone_hour natural whenever interval work order cascade diagnostics nchar having left call do handler load replace truncate start lock show pragma exists number",aggregate:"count sum min max avg"},c:[{cN:"string",b:"'",e:"'",c:[a.BE,{b:"''"}],r:0},{cN:"string",b:'"',e:'"',c:[a.BE,{b:'""'}],r:0},{cN:"string",b:"`",e:"`",c:[a.BE]},a.CNM]},a.CBLCLM,{cN:"comment",b:"--",e:"$"}]}}(hljs);hljs.LANGUAGES.ini=function(a){return{cI:true,i:"[^\\s]",c:[{cN:"comment",b:";",e:"$"},{cN:"title",b:"^\\[",e:"\\]"},{cN:"setting",b:"^[a-z0-9\\[\\]_-]+[ \\t]*=[ \\t]*",e:"$",c:[{cN:"value",eW:true,k:"on off true false yes no",c:[a.QSM,a.NM]}]}]}}(hljs);hljs.LANGUAGES.perl=function(e){var a="getpwent getservent quotemeta msgrcv scalar kill dbmclose undef lc ma syswrite tr send umask sysopen shmwrite vec qx utime local oct semctl localtime readpipe do return format read sprintf dbmopen pop getpgrp not getpwnam rewinddir qqfileno qw endprotoent wait sethostent bless s|0 opendir continue each sleep endgrent shutdown dump chomp connect getsockname die socketpair close flock exists index shmgetsub for endpwent redo lstat msgctl setpgrp abs exit select print ref gethostbyaddr unshift fcntl syscall goto getnetbyaddr join gmtime symlink semget splice x|0 getpeername recv log setsockopt cos last reverse gethostbyname getgrnam study formline endhostent times chop length gethostent getnetent pack getprotoent getservbyname rand mkdir pos chmod y|0 substr endnetent printf next open msgsnd readdir use unlink getsockopt getpriority rindex wantarray hex system getservbyport endservent int chr untie rmdir prototype tell listen fork shmread ucfirst setprotoent else sysseek link getgrgid shmctl waitpid unpack getnetbyname reset chdir grep split require caller lcfirst until warn while values shift telldir getpwuid my getprotobynumber delete and sort uc defined srand accept package seekdir getprotobyname semop our rename seek if q|0 chroot sysread setpwent no crypt getc chown sqrt write setnetent setpriority foreach tie sin msgget map stat getlogin unless elsif truncate exec keys glob tied closedirioctl socket readlink eval xor readline binmode setservent eof ord bind alarm pipe atan2 getgrent exp time push setgrent gt lt or ne m|0 break given say state when";var d={cN:"subst",b:"[$@]\\{",e:"\\}",k:a,r:10};var b={cN:"variable",b:"\\$\\d"};var i={cN:"variable",b:"[\\$\\%\\@\\*](\\^\\w\\b|#\\w+(\\:\\:\\w+)*|[^\\s\\w{]|{\\w+}|\\w+(\\:\\:\\w*)*)"};var f=[e.BE,d,b,i];var h={b:"->",c:[{b:e.IR},{b:"{",e:"}"}]};var g={cN:"comment",b:"^(__END__|__DATA__)",e:"\\n$",r:5};var c=[b,i,e.HCM,g,{cN:"comment",b:"^\\=\\w",e:"\\=cut",eW:true},h,{cN:"string",b:"q[qwxr]?\\s*\\(",e:"\\)",c:f,r:5},{cN:"string",b:"q[qwxr]?\\s*\\[",e:"\\]",c:f,r:5},{cN:"string",b:"q[qwxr]?\\s*\\{",e:"\\}",c:f,r:5},{cN:"string",b:"q[qwxr]?\\s*\\|",e:"\\|",c:f,r:5},{cN:"string",b:"q[qwxr]?\\s*\\<",e:"\\>",c:f,r:5},{cN:"string",b:"qw\\s+q",e:"q",c:f,r:5},{cN:"string",b:"'",e:"'",c:[e.BE],r:0},{cN:"string",b:'"',e:'"',c:f,r:0},{cN:"string",b:"`",e:"`",c:[e.BE]},{cN:"string",b:"{\\w+}",r:0},{cN:"string",b:"-?\\w+\\s*\\=\\>",r:0},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{b:"("+e.RSR+"|\\b(split|return|print|reverse|grep)\\b)\\s*",k:"split return print reverse grep",r:0,c:[e.HCM,g,{cN:"regexp",b:"(s|tr|y)/(\\\\.|[^/])*/(\\\\.|[^/])*/[a-z]*",r:10},{cN:"regexp",b:"(m|qr)?/",e:"/[a-z]*",c:[e.BE],r:0}]},{cN:"sub",bWK:true,e:"(\\s*\\(.*?\\))?[;{]",k:"sub",r:5},{cN:"operator",b:"-\\w\\b",r:0}];d.c=c;h.c[1].c=c;return{k:a,c:c}}(hljs);hljs.LANGUAGES.json=function(a){var e={literal:"true false null"};var d=[a.QSM,a.CNM];var c={cN:"value",e:",",eW:true,eE:true,c:d,k:e};var b={b:"{",e:"}",c:[{cN:"attribute",b:'\\s*"',e:'"\\s*:\\s*',eB:true,eE:true,c:[a.BE],i:"\\n",starts:c}],i:"\\S"};var f={b:"\\[",e:"\\]",c:[a.inherit(c,{cN:null})],i:"\\S"};d.splice(d.length,0,b,f);return{c:d,k:e,i:"\\S"}}(hljs);hljs.LANGUAGES.cpp=function(a){var b={keyword:"false int float while private char catch export virtual operator sizeof dynamic_cast|10 typedef const_cast|10 const struct for static_cast|10 union namespace unsigned long throw volatile static protected bool template mutable if public friend do return goto auto void enum else break new extern using true class asm case typeid short reinterpret_cast|10 default double register explicit signed typename try this switch continue wchar_t inline delete alignof char16_t char32_t constexpr decltype noexcept nullptr static_assert thread_local restrict _Bool complex",built_in:"std string cin cout cerr clog stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap array shared_ptr"};return{k:b,i:"</",c:[a.CLCM,a.CBLCLM,a.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},a.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:b,r:10,c:["self"]}]}}(hljs);
/* END contents of highlight.pack.js */

hljs.initHighlightingOnLoad();

function jShowHide(key)
{
	var link = document.getElementById(key + '_link');
	var contents = document.getElementById(key + '_contents');
	if (contents.style.display == 'none') {
		contents.style.display = 'block';
		link.innerHTML = 'hide';
	} else {
		contents.style.display = 'none';
		link.innerHTML = 'show';
	}
}
</script>

<style>
body {
	font-family: "Helvetica Neue", Helvetica, sans-serif;
}

a {
	color: steelblue;
}

h1 {
	font-size: x-large;
}

h2 {
	font-size: large;
}

div.jHeader {
	background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAANElEQVQokWM0MDBgIAWwMDAwfP/+HVOCk5MTqzgTScaPVA0sDAwMnJycWOWwio/GA000AABQCgy2e+ZDKwAAAABJRU5ErkJggg==');
	box-shadow: 0px 1px 3px #888;
	overflow: hidden;

	height: 35px;
	position: absolute;
	left: 0;
	right: 0;
	top: 0;

	color: white;
	font-size: x-large;
	padding-left: 20px;
	padding-top: 10px;
}

div.jBody {
	margin-top: 75px;
	margin-left: 10%;
	margin-right: 10%;
}

.jWarning {
	color: #b20000;
}

.jNotes {
	font-size: small;
	margin-top: -15px;
	color: #999999;
}

.jAnnotation {
	font-size: small;
	margin-top: -15px;
	color: #999999;
}

.jShowHideLink {
	color: #999999;
}

.jObjectAnnotation {
	font-size: small;
	color: #999999;
}

.jSectionBody {
	margin-left: 50px;
}

.jObjectContents {
	min-width: 600px;
	min-height: 1em;
	margin-top: 10px;
	margin-bottom: 10px;
	margin-left: 10px;
}

.jObjectContents > * > * {
	overflow-x: auto;
}

.jErrorCode {
	width: 150px;
	font-family: monospace;
	color: #999999;
}

.jErrorWhat {
	font-size: small;
}

.jErrorMessage {
	font-size: small;
}

.jErrorTable tr td {
	vertical-align: top;
}

.jHeaderRight {
	float: right;
	margin-right: 100px;
}

table.jObjectTable td {
	vertical-align: top;
}

/*
 * BEGIN contents of github.css, distributed with highlight.js, licensed under
 * the BSD license.
 */
/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

pre code {
  display: block; padding: 0.5em;
  color: #333;
  background: #f8f8ff
}

pre .comment,
pre .template_comment,
pre .diff .header,
pre .javadoc {
  color: #998;
  font-style: italic
}

pre .keyword,
pre .css .rule .keyword,
pre .winutils,
pre .javascript .title,
pre .nginx .title,
pre .subst,
pre .request,
pre .status {
  color: #333;
  font-weight: bold
}

pre .number,
pre .hexcolor,
pre .ruby .constant {
  color: #099;
}

pre .string,
pre .tag .value,
pre .phpdoc,
pre .tex .formula {
  color: #d14
}

pre .title,
pre .id {
  color: #900;
  font-weight: bold
}

pre .javascript .title,
pre .lisp .title,
pre .clojure .title,
pre .subst {
  font-weight: normal
}

pre .class .title,
pre .haskell .type,
pre .vhdl .literal,
pre .tex .command {
  color: #458;
  font-weight: bold
}

pre .tag,
pre .tag .title,
pre .rules .property,
pre .django .tag .keyword {
  color: #000080;
  font-weight: normal
}

pre .attribute,
pre .variable,
pre .lisp .body {
  color: #008080
}

pre .regexp {
  color: #009926
}

pre .class {
  color: #458;
  font-weight: bold
}

pre .symbol,
pre .ruby .symbol .string,
pre .lisp .keyword,
pre .tex .special,
pre .prompt {
  color: #990073
}

pre .built_in,
pre .lisp .title,
pre .clojure .built_in {
  color: #0086b3
}

pre .preprocessor,
pre .pi,
pre .doctype,
pre .shebang,
pre .cdata {
  color: #999;
  font-weight: bold
}

pre .deletion {
  background: #fdd
}

pre .addition {
  background: #dfd
}

pre .diff .change {
  background: #0086b3
}

pre .chunk {
  color: #aaa
}

/* END contents of github.css */
</style>
</head>

<body>

<div class="jHeader">Joyent Manta
<div class="jHeaderRight">
<a href="https://twitter.com/share" class="twitter-share-button"
data-via="joyent" data-size="large" data-count="none" data-hashtags="joyentmanta"
data-dnt="true">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
</div>
<div class="jBody">


<div class="jReadme">
<h1 id="linecountbyfileextension">Line count by file extension</h1>

<p>This job takes an arbitrary number of text files as input and produces a report
summarizing the most common file types (based on file extension, like ".txt",
or ".js") and how many files and lines were found for each file type.  This
example runs over the files in the Node.js v0.10.17 source tree.</p>

<p>This example demonstrates using the <code>$MANTA_INPUT_OBJECT</code> environment variable
to refer to the name of the object, and uses bash features to extract just the
file extension.</p>

<h2 id="runityourself">Run it yourself</h2>

<p>Once you've set up the <a href="http://apidocs.joyent.com/manta/#getting-started">Manta CLI
tools</a>, you can run this job
yourself on the publicly accessible dataset using the following command:</p>

<pre><code>$ mfind -t o /manta/public/examples/node-v0.10.17 | grep '[^/]\.[^/]*$' |
    mjob create -n "Line count by file extension" -o \
        -m 'echo "${MANTA_INPUT_OBJECT##*.}" "$(wc -l)"' \
    -r "awk '{ l[\$1] += \$2; f[\$1]++; } \
     END { for (i in l) { printf(\"%10s %4d %8d\n\", i, f[i], l[i]); } }' | \
        sort -rn -k3,3 | head -15"
</code></pre>

<p>which outputs:</p>

<pre><code>added 1000 inputs to 61aec44b-dd91-4ca8-c6da-841b7ff7b055
added 1000 inputs to 61aec44b-dd91-4ca8-c6da-841b7ff7b055
added 1000 inputs to 61aec44b-dd91-4ca8-c6da-841b7ff7b055
added 1000 inputs to 61aec44b-dd91-4ca8-c6da-841b7ff7b055
added 1000 inputs to 61aec44b-dd91-4ca8-c6da-841b7ff7b055
added 950 inputs to 61aec44b-dd91-4ca8-c6da-841b7ff7b055
         c 1182   440132
        cc  254   351897
         h  620   216657
        js 1510   203378
         s   65    88721
        pl  164    85431
        py  188    79270
       asm   32    45631
      html  163    43539
       pod  337    38653
      json  194    31637
        md  343    27893
       txt   43    12749
  markdown   44    12569
       com   39    12395
</code></pre>
</div>


<h2>Job body</h2>
<div class="jSectionBody jObjectContents">
<pre><code>[
        {
                &quot;exec&quot;: &quot;echo \&quot;${MANTA_INPUT_OBJECT##*.}\&quot; \&quot;$(wc -l)\&quot;&quot;,
                &quot;type&quot;: &quot;map&quot;
        },
        {
                &quot;exec&quot;: &quot;awk &#39;{ l[$1] += $2; f[$1]++; } \t END { for (i in l) { printf(\&quot;%10s %4d %8d\\n\&quot;, i, f[i], l[i]); } }&#39; | \t    sort -rn -k3,3 | head -15&quot;,
                &quot;type&quot;: &quot;reduce&quot;
        }
]</code></pre>
</div>

<h2>Input summary</h2>
<div class="jAnnotation">Showing first 50 input objects</div>

<div class="jSectionBody">
<table class="jObjectTable">
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in0_link" href="javascript:jShowHide('in0');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/CONTRIBUTING.md">/manta/public/examples/node-v0.10.17/CONTRIBUTING.md</a>
<br />
<div id="in0_contents" style="display: none" class="jObjectContents"><pre><code># CONTRIBUTING

The node.js project welcomes new contributors.  This document will guide you
through the process.


### FORK

Fork the project [on GitHub](https://github.com/joyent/node) and check out
your copy.

```
$ git clone git@github.com:username/node.git
$ cd node
$ git remote add upstream git://github.com/joyent/node.git
```

Now decide if you want your feature or bug fix to go into the master branch
or the stable branch.  As a rule of thumb, bug fixes go into the stable branch
while new features go into the master branch.

The stable branch is effectively frozen; patches that change the node.js
API/ABI or affect the run-time behavior of applications get rejected.

The rules for the master branch are less strict; consult the
[stability index page][] for details.

In a nutshell, modules are at varying levels of API stability.  Bug fixes are
always welcome but API or behavioral  changes to modules at stability level 3
and up are off-limits.

Node.js has several bundled dependencies in the deps/ and the tools/
directories that are not part of the project proper.  Any changes to files
in those directories or its subdirectories should be sent to their respective
projects.  Do not send your patch to us, we cannot accept it.

In case of doubt, open an issue in the [issue tracker][], post your question
to the [node.js mailing list][] or contact one of the [project maintainers][]
on [IRC][].

Especially do so if you plan to work on something big.  Nothing is more
frustrating than seeing your hard work go to waste because your vision
does not align with that of a project maintainer.


### BRANCH

Okay, so you have decided on the proper branch.  Create a feature branch
and start hacking:

```
$ git checkout -b my-feature-branch -t origin/v0.10
```

(Where v0.10 is the latest stable branch as of this writing.)


### COMMIT

Make sure git knows your name and email address:

```
$ git config --global user.name &quot;J. Random User&quot;
$ git config --global user.email &quot;j.random.user@example.com&quot;
```

Writing good commit logs is important.  A commit log should describe what
changed and why.  Follow these guidelines when writing one:

1. The first line should be 50 characters or less and contain a short
   description of the change prefixed with the name of the changed
   subsystem (e.g. &quot;net: add localAddress and localPort to Socket&quot;).
2. Keep the second line blank.
3. Wrap all other lines at 72 columns.

A good commit log looks like this:

```
subsystem: explaining the commit in one line

Body of commit message is a few lines of text, explaining things
in more detail, possibly giving some background about the issue
being fixed, etc etc.

The body of the commit message can be several paragraphs, and
please do proper word-wrap and keep columns shorter than about
72 characters or so. That way `git log` will show things
nicely even when it is indented.
```

The header line should be meaningful; it is what other people see when they
run `git shortlog` or `git log --oneline`.

Check the output of `git log --oneline files_that_you_changed` to find out
what subsystem (or subsystems) your changes touch.


### REBASE

Use `git rebase` (not `git merge`) to sync your work from time to time.

```
$ git fetch upstream
$ git rebase upstream/v0.10  # or upstream/master
```


### TEST

Bug fixes and features should come with tests.  Add your tests in the
test/simple/ directory.  Look at other tests to see how they should be
structured (license boilerplate, common includes, etc.).

```
$ make jslint test
```

Make sure the linter is happy and that all tests pass.  Please, do not submit
patches that fail either check.


### PUSH

```
$ git push origin my-feature-branch
```

Go to https://github.com/username/node and select your feature branch.  Click
the &#39;Pull Request&#39; button and fill out the form.

Pull requests are usually reviewed within a few days.  If there are comments
to address, apply your changes in a separate commit and push that to your
feature branch.  Post a comment in the pull request afterwards; GitHub does
not send out notifications when you add commits.


### CONTRIBUTOR LICENSE AGREEMENT

Please visit http://nodejs.org/cla.html and sign the Contributor License
Agreement.  You only need to do that once.


[stability index page]: https://github.com/joyent/node/blob/master/doc/api/documentation.markdown
[issue tracker]: https://github.com/joyent/node/issues
[node.js mailing list]: http://groups.google.com/group/nodejs
[IRC]: http://webchat.freenode.net/?channels=node.js
[project maintainers]: https://github.com/joyent/node/wiki/Project-Organization
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in1_link" href="javascript:jShowHide('in1');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/common.gypi">/manta/public/examples/node-v0.10.17/common.gypi</a>
<br />
<div id="in1_contents" style="display: none" class="jObjectContents"><pre><code>{
  &#39;variables&#39;: {
    &#39;visibility%&#39;: &#39;hidden&#39;,         # V8&#39;s visibility setting
    &#39;target_arch%&#39;: &#39;ia32&#39;,          # set v8&#39;s target architecture
    &#39;host_arch%&#39;: &#39;ia32&#39;,            # set v8&#39;s host architecture
    &#39;want_separate_host_toolset&#39;: 0, # V8 should not build target and host
    &#39;library%&#39;: &#39;static_library&#39;,    # allow override to &#39;shared_library&#39; for DLL/.so builds
    &#39;component%&#39;: &#39;static_library&#39;,  # NB. these names match with what V8 expects
    &#39;msvs_multi_core_compile&#39;: &#39;0&#39;,  # we do enable multicore compiles, but not using the V8 way
    &#39;gcc_version%&#39;: &#39;unknown&#39;,
    &#39;clang%&#39;: 0,
    &#39;python%&#39;: &#39;python&#39;,

    # Turn on optimizations that may trigger compiler bugs.
    # Use at your own risk. Do *NOT* report bugs if this option is enabled.
    &#39;node_unsafe_optimizations%&#39;: 0,

    # Enable V8&#39;s post-mortem debugging only on unix flavors.
    &#39;conditions&#39;: [
      [&#39;OS != &quot;win&quot;&#39;, {
        &#39;v8_postmortem_support&#39;: &#39;true&#39;
      }]
    ],
  },

  &#39;target_defaults&#39;: {
    &#39;default_configuration&#39;: &#39;Release&#39;,
    &#39;configurations&#39;: {
      &#39;Debug&#39;: {
        &#39;defines&#39;: [ &#39;DEBUG&#39;, &#39;_DEBUG&#39; ],
        &#39;cflags&#39;: [ &#39;-g&#39;, &#39;-O0&#39; ],
        &#39;conditions&#39;: [
          [&#39;target_arch==&quot;x64&quot;&#39;, {
            &#39;msvs_configuration_platform&#39;: &#39;x64&#39;,
          }],
        ],
        &#39;msvs_settings&#39;: {
          &#39;VCCLCompilerTool&#39;: {
            &#39;RuntimeLibrary&#39;: 1, # static debug
            &#39;Optimization&#39;: 0, # /Od, no optimization
            &#39;MinimalRebuild&#39;: &#39;false&#39;,
            &#39;OmitFramePointers&#39;: &#39;false&#39;,
            &#39;BasicRuntimeChecks&#39;: 3, # /RTC1
          },
          &#39;VCLinkerTool&#39;: {
            &#39;LinkIncremental&#39;: 2, # enable incremental linking
          },
        },
        &#39;xcode_settings&#39;: {
          &#39;GCC_OPTIMIZATION_LEVEL&#39;: &#39;0&#39;, # stop gyp from defaulting to -Os
        },
      },
      &#39;Release&#39;: {
        &#39;conditions&#39;: [
          [&#39;target_arch==&quot;x64&quot;&#39;, {
            &#39;msvs_configuration_platform&#39;: &#39;x64&#39;,
          }],
          [&#39;node_unsafe_optimizations==1&#39;, {
            &#39;cflags&#39;: [ &#39;-O3&#39;, &#39;-ffunction-sections&#39;, &#39;-fdata-sections&#39; ],
            &#39;ldflags&#39;: [ &#39;-Wl,--gc-sections&#39; ],
          }, {
            &#39;cflags&#39;: [ &#39;-O2&#39;, &#39;-fno-strict-aliasing&#39; ],
            &#39;cflags!&#39;: [ &#39;-O3&#39;, &#39;-fstrict-aliasing&#39; ],
            &#39;conditions&#39;: [
              # Required by the dtrace post-processor. Unfortunately,
              # some gcc/binutils combos generate bad code when
              # -ffunction-sections is enabled. Let&#39;s hope for the best.
              [&#39;OS==&quot;solaris&quot;&#39;, {
                &#39;cflags&#39;: [ &#39;-ffunction-sections&#39;, &#39;-fdata-sections&#39; ],
              }, {
                &#39;cflags!&#39;: [ &#39;-ffunction-sections&#39;, &#39;-fdata-sections&#39; ],
              }],
              [&#39;clang == 0 and gcc_version &gt;= 40&#39;, {
                &#39;cflags&#39;: [ &#39;-fno-tree-vrp&#39; ],
              }],
              [&#39;clang == 0 and gcc_version &lt;= 44&#39;, {
                &#39;cflags&#39;: [ &#39;-fno-tree-sink&#39; ],
              }],
            ],
          }],
          [&#39;OS==&quot;solaris&quot;&#39;, {
            &#39;cflags&#39;: [ &#39;-fno-omit-frame-pointer&#39; ],
            # pull in V8&#39;s postmortem metadata
            &#39;ldflags&#39;: [ &#39;-Wl,-z,allextract&#39; ]
          }],
        ],
        &#39;msvs_settings&#39;: {
          &#39;VCCLCompilerTool&#39;: {
            &#39;RuntimeLibrary&#39;: 0, # static release
            &#39;Optimization&#39;: 3, # /Ox, full optimization
            &#39;FavorSizeOrSpeed&#39;: 1, # /Ot, favour speed over size
            &#39;InlineFunctionExpansion&#39;: 2, # /Ob2, inline anything eligible
            &#39;WholeProgramOptimization&#39;: &#39;true&#39;, # /GL, whole program optimization, needed for LTCG
            &#39;OmitFramePointers&#39;: &#39;true&#39;,
            &#39;EnableFunctionLevelLinking&#39;: &#39;true&#39;,
            &#39;EnableIntrinsicFunctions&#39;: &#39;true&#39;,
            &#39;RuntimeTypeInfo&#39;: &#39;false&#39;,
            &#39;ExceptionHandling&#39;: &#39;0&#39;,
            &#39;AdditionalOptions&#39;: [
              &#39;/MP&#39;, # compile across multiple CPUs
            ],
          },
          &#39;VCLibrarianTool&#39;: {
            &#39;AdditionalOptions&#39;: [
              &#39;/LTCG&#39;, # link time code generation
            ],
          },
          &#39;VCLinkerTool&#39;: {
            &#39;LinkTimeCodeGeneration&#39;: 1, # link-time code generation
            &#39;OptimizeReferences&#39;: 2, # /OPT:REF
            &#39;EnableCOMDATFolding&#39;: 2, # /OPT:ICF
            &#39;LinkIncremental&#39;: 1, # disable incremental linking
          },
        },
      }
    },
    &#39;msvs_settings&#39;: {
      &#39;VCCLCompilerTool&#39;: {
        &#39;StringPooling&#39;: &#39;true&#39;, # pool string literals
        &#39;DebugInformationFormat&#39;: 3, # Generate a PDB
        &#39;WarningLevel&#39;: 3,
        &#39;BufferSecurityCheck&#39;: &#39;true&#39;,
        &#39;ExceptionHandling&#39;: 1, # /EHsc
        &#39;SuppressStartupBanner&#39;: &#39;true&#39;,
        &#39;WarnAsError&#39;: &#39;false&#39;,
      },
      &#39;VCLibrarianTool&#39;: {
      },
      &#39;VCLinkerTool&#39;: {
        &#39;conditions&#39;: [
          [&#39;target_arch==&quot;x64&quot;&#39;, {
            &#39;TargetMachine&#39; : 17 # /MACHINE:X64
          }],
        ],
        &#39;GenerateDebugInformation&#39;: &#39;true&#39;,
        &#39;RandomizedBaseAddress&#39;: 2, # enable ASLR
        &#39;DataExecutionPrevention&#39;: 2, # enable DEP
        &#39;AllowIsolation&#39;: &#39;true&#39;,
        &#39;SuppressStartupBanner&#39;: &#39;true&#39;,
        &#39;target_conditions&#39;: [
          [&#39;_type==&quot;executable&quot;&#39;, {
            &#39;SubSystem&#39;: 1, # console executable
          }],
        ],
      },
    },
    &#39;conditions&#39;: [
      [&#39;OS == &quot;win&quot;&#39;, {
        &#39;msvs_cygwin_shell&#39;: 0, # prevent actions from trying to use cygwin
        &#39;defines&#39;: [
          &#39;WIN32&#39;,
          # we don&#39;t really want VC++ warning us about
          # how dangerous C functions are...
          &#39;_CRT_SECURE_NO_DEPRECATE&#39;,
          # ... or that C implementations shouldn&#39;t use
          # POSIX names
          &#39;_CRT_NONSTDC_NO_DEPRECATE&#39;,
          &#39;BUILDING_V8_SHARED=1&#39;,
          &#39;BUILDING_UV_SHARED=1&#39;,
        ],
      }],
      [ &#39;OS==&quot;linux&quot; or OS==&quot;freebsd&quot; or OS==&quot;openbsd&quot; or OS==&quot;solaris&quot;&#39;, {
        &#39;cflags&#39;: [ &#39;-Wall&#39;, &#39;-Wextra&#39;, &#39;-Wno-unused-parameter&#39;, &#39;-pthread&#39;, ],
        &#39;cflags_cc&#39;: [ &#39;-fno-rtti&#39;, &#39;-fno-exceptions&#39; ],
        &#39;ldflags&#39;: [ &#39;-pthread&#39;, &#39;-rdynamic&#39; ],
        &#39;target_conditions&#39;: [
          [&#39;_type==&quot;static_library&quot;&#39;, {
            &#39;standalone_static_library&#39;: 1, # disable thin archive which needs binutils &gt;= 2.19
          }],
        ],
        &#39;conditions&#39;: [
          [ &#39;target_arch==&quot;ia32&quot;&#39;, {
            &#39;cflags&#39;: [ &#39;-m32&#39; ],
            &#39;ldflags&#39;: [ &#39;-m32&#39; ],
          }],
          [ &#39;target_arch==&quot;x64&quot;&#39;, {
            &#39;cflags&#39;: [ &#39;-m64&#39; ],
            &#39;ldflags&#39;: [ &#39;-m64&#39; ],
          }],
          [ &#39;OS==&quot;solaris&quot;&#39;, {
            &#39;cflags&#39;: [ &#39;-pthreads&#39; ],
            &#39;ldflags&#39;: [ &#39;-pthreads&#39; ],
            &#39;cflags!&#39;: [ &#39;-pthread&#39; ],
            &#39;ldflags!&#39;: [ &#39;-pthread&#39; ],
          }],
        ],
      }],
      [&#39;OS==&quot;mac&quot;&#39;, {
        &#39;defines&#39;: [&#39;_DARWIN_USE_64_BIT_INODE=1&#39;],
        &#39;xcode_settings&#39;: {
          &#39;ALWAYS_SEARCH_USER_PATHS&#39;: &#39;NO&#39;,
          &#39;GCC_CW_ASM_SYNTAX&#39;: &#39;NO&#39;,                # No -fasm-blocks
          &#39;GCC_DYNAMIC_NO_PIC&#39;: &#39;NO&#39;,               # No -mdynamic-no-pic
                                                    # (Equivalent to -fPIC)
          &#39;GCC_ENABLE_CPP_EXCEPTIONS&#39;: &#39;NO&#39;,        # -fno-exceptions
          &#39;GCC_ENABLE_CPP_RTTI&#39;: &#39;NO&#39;,              # -fno-rtti
          &#39;GCC_ENABLE_PASCAL_STRINGS&#39;: &#39;NO&#39;,        # No -mpascal-strings
          &#39;GCC_THREADSAFE_STATICS&#39;: &#39;NO&#39;,           # -fno-threadsafe-statics
          &#39;PREBINDING&#39;: &#39;NO&#39;,                       # No -Wl,-prebind
          &#39;MACOSX_DEPLOYMENT_TARGET&#39;: &#39;10.5&#39;,       # -mmacosx-version-min=10.5
          &#39;USE_HEADERMAP&#39;: &#39;NO&#39;,
          &#39;OTHER_CFLAGS&#39;: [
            &#39;-fno-strict-aliasing&#39;,
          ],
          &#39;WARNING_CFLAGS&#39;: [
            &#39;-Wall&#39;,
            &#39;-Wendif-labels&#39;,
            &#39;-W&#39;,
            &#39;-Wno-unused-parameter&#39;,
          ],
        },
        &#39;target_conditions&#39;: [
          [&#39;_type!=&quot;static_library&quot;&#39;, {
            &#39;xcode_settings&#39;: {&#39;OTHER_LDFLAGS&#39;: [&#39;-Wl,-search_paths_first&#39;]},
          }],
        ],
        &#39;conditions&#39;: [
          [&#39;target_arch==&quot;ia32&quot;&#39;, {
            &#39;xcode_settings&#39;: {&#39;ARCHS&#39;: [&#39;i386&#39;]},
          }],
          [&#39;target_arch==&quot;x64&quot;&#39;, {
            &#39;xcode_settings&#39;: {&#39;ARCHS&#39;: [&#39;x86_64&#39;]},
          }],
        ],
      }],
      [&#39;OS==&quot;freebsd&quot; and node_use_dtrace==&quot;true&quot;&#39;, {
        &#39;libraries&#39;: [ &#39;-lelf&#39; ],
      }]
    ],
  }
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in2_link" href="javascript:jShowHide('in2');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/.travis.yml">/manta/public/examples/node-v0.10.17/.travis.yml</a>
<br />
<div id="in2_contents" style="display: none" class="jObjectContents"><pre><code>language: node_js

before_script:
  - &quot;./configure&quot;
  - &quot;make&quot;

script:
  - &quot;make test&quot;

notifications:
  email: false
  irc:
    - &quot;irc.freenode.net#libuv&quot;

</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in3_link" href="javascript:jShowHide('in3');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/README.md">/manta/public/examples/node-v0.10.17/README.md</a>
<br />
<div id="in3_contents" style="display: none" class="jObjectContents"><pre><code>Evented I/O for V8 javascript. [![Build Status](https://secure.travis-ci.org/joyent/node.png)](http://travis-ci.org/joyent/node)
===

### To build:

Prerequisites (Unix only):

    * GCC 4.2 or newer
    * Python 2.6 or 2.7
    * GNU Make 3.81 or newer
    * libexecinfo (FreeBSD and OpenBSD only)

Unix/Macintosh:

    ./configure
    make
    make install

If your python binary is in a non-standard location or has a
non-standard name, run the following instead:

    export PYTHON=/path/to/python
    $PYTHON ./configure
    make
    make install

Windows:

    vcbuild.bat

### To run the tests:

Unix/Macintosh:

    make test

Windows:

    vcbuild.bat test

### To build the documentation:

    make doc

### To read the documentation:

    man doc/node.1

Resources for Newcomers
---
  - [The Wiki](https://github.com/joyent/node/wiki)
  - [nodejs.org](http://nodejs.org/)
  - [how to install node.js and npm (node package manager)](http://joyeur.com/2010/12/10/installing-node-and-npm/)
  - [list of modules](https://github.com/joyent/node/wiki/modules)
  - [searching the npm registry](http://npmjs.org/)
  - [list of companies and projects using node](https://github.com/joyent/node/wiki/Projects,-Applications,-and-Companies-Using-Node)
  - [node.js mailing list](http://groups.google.com/group/nodejs)
  - irc chatroom, [#node.js on freenode.net](http://webchat.freenode.net?channels=node.js&amp;uio=d4)
  - [community](https://github.com/joyent/node/wiki/Community)
  - [contributing](https://github.com/joyent/node/wiki/Contributing)
  - [big list of all the helpful wiki pages](https://github.com/joyent/node/wiki/_pages)
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in4_link" href="javascript:jShowHide('in4');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/node.gyp">/manta/public/examples/node-v0.10.17/node.gyp</a>
<br />
<div id="in4_contents" style="display: none" class="jObjectContents"><pre><code>{
  &#39;variables&#39;: {
    &#39;v8_use_snapshot%&#39;: &#39;true&#39;,
    # Turn off -Werror in V8
    # See http://codereview.chromium.org/8159015
    &#39;werror&#39;: &#39;&#39;,
    &#39;node_use_dtrace%&#39;: &#39;false&#39;,
    &#39;node_use_etw%&#39;: &#39;false&#39;,
    &#39;node_use_perfctr%&#39;: &#39;false&#39;,
    &#39;node_has_winsdk%&#39;: &#39;false&#39;,
    &#39;node_shared_v8%&#39;: &#39;false&#39;,
    &#39;node_shared_zlib%&#39;: &#39;false&#39;,
    &#39;node_shared_http_parser%&#39;: &#39;false&#39;,
    &#39;node_shared_cares%&#39;: &#39;false&#39;,
    &#39;node_shared_libuv%&#39;: &#39;false&#39;,
    &#39;node_use_openssl%&#39;: &#39;true&#39;,
    &#39;node_use_systemtap%&#39;: &#39;false&#39;,
    &#39;node_shared_openssl%&#39;: &#39;false&#39;,
    &#39;library_files&#39;: [
      &#39;src/node.js&#39;,
      &#39;lib/_debugger.js&#39;,
      &#39;lib/_linklist.js&#39;,
      &#39;lib/assert.js&#39;,
      &#39;lib/buffer.js&#39;,
      &#39;lib/child_process.js&#39;,
      &#39;lib/console.js&#39;,
      &#39;lib/constants.js&#39;,
      &#39;lib/crypto.js&#39;,
      &#39;lib/cluster.js&#39;,
      &#39;lib/dgram.js&#39;,
      &#39;lib/dns.js&#39;,
      &#39;lib/domain.js&#39;,
      &#39;lib/events.js&#39;,
      &#39;lib/freelist.js&#39;,
      &#39;lib/fs.js&#39;,
      &#39;lib/http.js&#39;,
      &#39;lib/https.js&#39;,
      &#39;lib/module.js&#39;,
      &#39;lib/net.js&#39;,
      &#39;lib/os.js&#39;,
      &#39;lib/path.js&#39;,
      &#39;lib/punycode.js&#39;,
      &#39;lib/querystring.js&#39;,
      &#39;lib/readline.js&#39;,
      &#39;lib/repl.js&#39;,
      &#39;lib/stream.js&#39;,
      &#39;lib/_stream_readable.js&#39;,
      &#39;lib/_stream_writable.js&#39;,
      &#39;lib/_stream_duplex.js&#39;,
      &#39;lib/_stream_transform.js&#39;,
      &#39;lib/_stream_passthrough.js&#39;,
      &#39;lib/string_decoder.js&#39;,
      &#39;lib/sys.js&#39;,
      &#39;lib/timers.js&#39;,
      &#39;lib/tls.js&#39;,
      &#39;lib/tty.js&#39;,
      &#39;lib/url.js&#39;,
      &#39;lib/util.js&#39;,
      &#39;lib/vm.js&#39;,
      &#39;lib/zlib.js&#39;,
    ],
  },

  &#39;targets&#39;: [
    {
      &#39;target_name&#39;: &#39;node&#39;,
      &#39;type&#39;: &#39;executable&#39;,

      &#39;dependencies&#39;: [
        &#39;node_js2c#host&#39;,
      ],

      &#39;include_dirs&#39;: [
        &#39;src&#39;,
        &#39;tools/msvs/genfiles&#39;,
        &#39;deps/uv/src/ares&#39;,
        &#39;&lt;(SHARED_INTERMEDIATE_DIR)&#39; # for node_natives.h
      ],

      &#39;sources&#39;: [
        &#39;src/fs_event_wrap.cc&#39;,
        &#39;src/cares_wrap.cc&#39;,
        &#39;src/handle_wrap.cc&#39;,
        &#39;src/node.cc&#39;,
        &#39;src/node_buffer.cc&#39;,
        &#39;src/node_constants.cc&#39;,
        &#39;src/node_extensions.cc&#39;,
        &#39;src/node_file.cc&#39;,
        &#39;src/node_http_parser.cc&#39;,
        &#39;src/node_javascript.cc&#39;,
        &#39;src/node_main.cc&#39;,
        &#39;src/node_os.cc&#39;,
        &#39;src/node_script.cc&#39;,
        &#39;src/node_stat_watcher.cc&#39;,
        &#39;src/node_string.cc&#39;,
        &#39;src/node_zlib.cc&#39;,
        &#39;src/pipe_wrap.cc&#39;,
        &#39;src/signal_wrap.cc&#39;,
        &#39;src/string_bytes.cc&#39;,
        &#39;src/stream_wrap.cc&#39;,
        &#39;src/slab_allocator.cc&#39;,
        &#39;src/tcp_wrap.cc&#39;,
        &#39;src/timer_wrap.cc&#39;,
        &#39;src/tty_wrap.cc&#39;,
        &#39;src/process_wrap.cc&#39;,
        &#39;src/v8_typed_array.cc&#39;,
        &#39;src/udp_wrap.cc&#39;,
        # headers to make for a more pleasant IDE experience
        &#39;src/handle_wrap.h&#39;,
        &#39;src/node.h&#39;,
        &#39;src/node_buffer.h&#39;,
        &#39;src/node_constants.h&#39;,
        &#39;src/node_crypto.h&#39;,
        &#39;src/node_extensions.h&#39;,
        &#39;src/node_file.h&#39;,
        &#39;src/node_http_parser.h&#39;,
        &#39;src/node_javascript.h&#39;,
        &#39;src/node_os.h&#39;,
        &#39;src/node_root_certs.h&#39;,
        &#39;src/node_script.h&#39;,
        &#39;src/node_string.h&#39;,
        &#39;src/node_version.h&#39;,
        &#39;src/ngx-queue.h&#39;,
        &#39;src/pipe_wrap.h&#39;,
        &#39;src/tty_wrap.h&#39;,
        &#39;src/tcp_wrap.h&#39;,
        &#39;src/udp_wrap.h&#39;,
        &#39;src/req_wrap.h&#39;,
        &#39;src/slab_allocator.h&#39;,
        &#39;src/string_bytes.h&#39;,
        &#39;src/stream_wrap.h&#39;,
        &#39;src/tree.h&#39;,
        &#39;src/v8_typed_array.h&#39;,
        &#39;deps/http_parser/http_parser.h&#39;,
        &#39;&lt;(SHARED_INTERMEDIATE_DIR)/node_natives.h&#39;,
        # javascript files to make for an even more pleasant IDE experience
        &#39;&lt;@(library_files)&#39;,
        # node.gyp is added to the project by default.
        &#39;common.gypi&#39;,
      ],

      &#39;defines&#39;: [
        &#39;NODE_WANT_INTERNALS=1&#39;,
        &#39;ARCH=&quot;&lt;(target_arch)&quot;&#39;,
        &#39;PLATFORM=&quot;&lt;(OS)&quot;&#39;,
        &#39;NODE_TAG=&quot;&lt;(node_tag)&quot;&#39;,
      ],

      &#39;conditions&#39;: [
        [ &#39;node_use_openssl==&quot;true&quot;&#39;, {
          &#39;defines&#39;: [ &#39;HAVE_OPENSSL=1&#39; ],
          &#39;sources&#39;: [ &#39;src/node_crypto.cc&#39; ],
          &#39;conditions&#39;: [
            [ &#39;node_shared_openssl==&quot;false&quot;&#39;, {
              &#39;dependencies&#39;: [ &#39;./deps/openssl/openssl.gyp:openssl&#39; ],
            }]]
        }, {
          &#39;defines&#39;: [ &#39;HAVE_OPENSSL=0&#39; ]
        }],
        [ &#39;node_use_dtrace==&quot;true&quot;&#39;, {
          &#39;defines&#39;: [ &#39;HAVE_DTRACE=1&#39; ],
          &#39;dependencies&#39;: [ &#39;node_dtrace_header&#39; ],
          &#39;include_dirs&#39;: [ &#39;&lt;(SHARED_INTERMEDIATE_DIR)&#39; ],
          #
          # DTrace is supported on solaris, mac, and bsd.  There are three
          # object files associated with DTrace support, but they&#39;re not all
          # used all the time:
          #
          #   node_dtrace.o           all configurations
          #   node_dtrace_ustack.o    not supported on OS X
          #   node_dtrace_provider.o  All except OS X.  &quot;dtrace -G&quot; is not
          #                           used on OS X.
          #
          # Note that node_dtrace_provider.cc and node_dtrace_ustack.cc do not
          # actually exist.  They&#39;re listed here to trick GYP into linking the
          # corresponding object files into the final &quot;node&quot; executable.  These
          # object files are generated by &quot;dtrace -G&quot; using custom actions
          # below, and the GYP-generated Makefiles will properly build them when
          # needed.
          #
          &#39;sources&#39;: [
            &#39;src/node_dtrace.cc&#39;,
          ],
          &#39;conditions&#39;: [ [
            &#39;OS!=&quot;mac&quot;&#39;, {
              &#39;sources&#39;: [
                &#39;src/node_dtrace_ustack.cc&#39;,
                &#39;src/node_dtrace_provider.cc&#39;,
              ]
            }
          ] ]
        } ],
        [ &#39;node_use_systemtap==&quot;true&quot;&#39;, {
          &#39;defines&#39;: [ &#39;HAVE_SYSTEMTAP=1&#39;, &#39;STAP_SDT_V1=1&#39; ],
          &#39;dependencies&#39;: [ &#39;node_systemtap_header&#39; ],
          &#39;include_dirs&#39;: [ &#39;&lt;(SHARED_INTERMEDIATE_DIR)&#39; ],
          &#39;sources&#39;: [
            &#39;src/node_dtrace.cc&#39;,
            &#39;&lt;(SHARED_INTERMEDIATE_DIR)/node_systemtap.h&#39;,
          ],
        } ],
        [ &#39;node_use_etw==&quot;true&quot;&#39;, {
          &#39;defines&#39;: [ &#39;HAVE_ETW=1&#39; ],
          &#39;dependencies&#39;: [ &#39;node_etw&#39; ],
          &#39;sources&#39;: [
            &#39;src/node_win32_etw_provider.h&#39;,
            &#39;src/node_win32_etw_provider-inl.h&#39;,
            &#39;src/node_win32_etw_provider.cc&#39;,
            &#39;src/node_dtrace.cc&#39;,
            &#39;tools/msvs/genfiles/node_etw_provider.h&#39;,
            &#39;tools/msvs/genfiles/node_etw_provider.rc&#39;,
          ]
        } ],
        [ &#39;node_use_perfctr==&quot;true&quot;&#39;, {
          &#39;defines&#39;: [ &#39;HAVE_PERFCTR=1&#39; ],
          &#39;dependencies&#39;: [ &#39;node_perfctr&#39; ],
          &#39;sources&#39;: [
            &#39;src/node_win32_perfctr_provider.h&#39;,
            &#39;src/node_win32_perfctr_provider.cc&#39;,
            &#39;src/node_counters.cc&#39;,
            &#39;src/node_counters.h&#39;,
            &#39;tools/msvs/genfiles/node_perfctr_provider.rc&#39;,
          ]
        } ],
        [ &#39;node_shared_v8==&quot;false&quot;&#39;, {
          &#39;sources&#39;: [
            &#39;deps/v8/include/v8.h&#39;,
            &#39;deps/v8/include/v8-debug.h&#39;,
          ],
          &#39;dependencies&#39;: [ &#39;deps/v8/tools/gyp/v8.gyp:v8&#39; ],
        }],

        [ &#39;node_shared_zlib==&quot;false&quot;&#39;, {
          &#39;dependencies&#39;: [ &#39;deps/zlib/zlib.gyp:zlib&#39; ],
        }],

        [ &#39;node_shared_http_parser==&quot;false&quot;&#39;, {
          &#39;dependencies&#39;: [ &#39;deps/http_parser/http_parser.gyp:http_parser&#39; ],
        }],

        [ &#39;node_shared_cares==&quot;false&quot;&#39;, {
          &#39;dependencies&#39;: [ &#39;deps/cares/cares.gyp:cares&#39; ],
        }],

        [ &#39;node_shared_libuv==&quot;false&quot;&#39;, {
          &#39;dependencies&#39;: [ &#39;deps/uv/uv.gyp:libuv&#39; ],
        }],

        [ &#39;OS==&quot;win&quot;&#39;, {
          &#39;sources&#39;: [
            &#39;src/res/node.rc&#39;,
          ],
          &#39;defines&#39;: [
            &#39;FD_SETSIZE=1024&#39;,
            # we need to use node&#39;s preferred &quot;win32&quot; rather than gyp&#39;s preferred &quot;win&quot;
            &#39;PLATFORM=&quot;win32&quot;&#39;,
            &#39;_UNICODE=1&#39;,
          ],
          &#39;libraries&#39;: [ &#39;-lpsapi.lib&#39; ]
        }, { # POSIX
          &#39;defines&#39;: [ &#39;__POSIX__&#39; ],
        }],
        [ &#39;OS==&quot;mac&quot;&#39;, {
          &#39;libraries&#39;: [ &#39;-framework Carbon&#39; ],
          &#39;defines!&#39;: [
            &#39;PLATFORM=&quot;mac&quot;&#39;,
          ],
          &#39;defines&#39;: [
            # we need to use node&#39;s preferred &quot;darwin&quot; rather than gyp&#39;s preferred &quot;mac&quot;
            &#39;PLATFORM=&quot;darwin&quot;&#39;,
          ],
        }],
        [ &#39;OS==&quot;freebsd&quot;&#39;, {
          &#39;libraries&#39;: [
            &#39;-lutil&#39;,
            &#39;-lkvm&#39;,
          ],
        }],
        [ &#39;OS==&quot;solaris&quot;&#39;, {
          &#39;libraries&#39;: [
            &#39;-lkstat&#39;,
            &#39;-lumem&#39;,
          ],
          &#39;defines!&#39;: [
            &#39;PLATFORM=&quot;solaris&quot;&#39;,
          ],
          &#39;defines&#39;: [
            # we need to use node&#39;s preferred &quot;sunos&quot;
            # rather than gyp&#39;s preferred &quot;solaris&quot;
            &#39;PLATFORM=&quot;sunos&quot;&#39;,
          ],
        }],
      ],
      &#39;msvs_settings&#39;: {
        &#39;VCLinkerTool&#39;: {
          &#39;SubSystem&#39;: 1, # /subsystem:console
        },
      },
    },
    # generate ETW header and resource files
    {
      &#39;target_name&#39;: &#39;node_etw&#39;,
      &#39;type&#39;: &#39;none&#39;,
      &#39;conditions&#39;: [
        [ &#39;node_use_etw==&quot;true&quot; and node_has_winsdk==&quot;true&quot;&#39;, {
          &#39;actions&#39;: [
            {
              &#39;action_name&#39;: &#39;node_etw&#39;,
              &#39;inputs&#39;: [ &#39;src/res/node_etw_provider.man&#39; ],
              &#39;outputs&#39;: [
                &#39;tools/msvs/genfiles/node_etw_provider.rc&#39;,
                &#39;tools/msvs/genfiles/node_etw_provider.h&#39;,
                &#39;tools/msvs/genfiles/node_etw_providerTEMP.BIN&#39;,
              ],
              &#39;action&#39;: [ &#39;mc &lt;@(_inputs) -h tools/msvs/genfiles -r tools/msvs/genfiles&#39; ]
            }
          ]
        } ]
      ]
    },
    # generate perf counter header and resource files
    {
      &#39;target_name&#39;: &#39;node_perfctr&#39;,
      &#39;type&#39;: &#39;none&#39;,
      &#39;conditions&#39;: [
        [ &#39;node_use_perfctr==&quot;true&quot; and node_has_winsdk==&quot;true&quot;&#39;, {
          &#39;actions&#39;: [
            {
              &#39;action_name&#39;: &#39;node_perfctr_man&#39;,
              &#39;inputs&#39;: [ &#39;src/res/node_perfctr_provider.man&#39; ],
              &#39;outputs&#39;: [
                &#39;tools/msvs/genfiles/node_perfctr_provider.h&#39;,
                &#39;tools/msvs/genfiles/node_perfctr_provider.rc&#39;,
                &#39;tools/msvs/genfiles/MSG00001.</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in5_link" href="javascript:jShowHide('in5');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/vcbuild.bat">/manta/public/examples/node-v0.10.17/vcbuild.bat</a>
<br />
<div id="in5_contents" style="display: none" class="jObjectContents"><pre><code>@echo off

cd %~dp0

if /i &quot;%1&quot;==&quot;help&quot; goto help
if /i &quot;%1&quot;==&quot;--help&quot; goto help
if /i &quot;%1&quot;==&quot;-help&quot; goto help
if /i &quot;%1&quot;==&quot;/help&quot; goto help
if /i &quot;%1&quot;==&quot;?&quot; goto help
if /i &quot;%1&quot;==&quot;-?&quot; goto help
if /i &quot;%1&quot;==&quot;--?&quot; goto help
if /i &quot;%1&quot;==&quot;/?&quot; goto help

@rem Process arguments.
set config=Release
set msiplatform=x86
set target=Build
set target_arch=ia32
set debug_arg=
set nosnapshot_arg=
set noprojgen=
set nobuild=
set nosign=
set nosnapshot=
set test=
set test_args=
set msi=
set licensertf=
set upload=
set jslint=
set buildnodeweak=
set noetw=
set noetw_arg=
set noetw_msi_arg=
set noperfctr=
set noperfctr_arg=
set noperfctr_msi_arg=

:next-arg
if &quot;%1&quot;==&quot;&quot; goto args-done
if /i &quot;%1&quot;==&quot;debug&quot;         set config=Debug&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;release&quot;       set config=Release&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;clean&quot;         set target=Clean&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;ia32&quot;          set target_arch=ia32&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;x86&quot;           set target_arch=ia32&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;x64&quot;           set target_arch=x64&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;noprojgen&quot;     set noprojgen=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;nobuild&quot;       set nobuild=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;nosign&quot;        set nosign=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;nosnapshot&quot;    set nosnapshot=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;noetw&quot;         set noetw=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;noperfctr&quot;     set noperfctr=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;licensertf&quot;    set licensertf=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;test-uv&quot;       set test=test-uv&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;test-internet&quot; set test=test-internet&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;test-pummel&quot;   set test=test-pummel&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;test-simple&quot;   set test=test-simple&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;test-message&quot;  set test=test-message&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;test-gc&quot;       set test=test-gc&amp;set buildnodeweak=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;test-all&quot;      set test=test-all&amp;set buildnodeweak=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;test&quot;          set test=test&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;msi&quot;           set msi=1&amp;set licensertf=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;upload&quot;        set upload=1&amp;goto arg-ok
if /i &quot;%1&quot;==&quot;jslint&quot;        set jslint=1&amp;goto arg-ok

echo Warning: ignoring invalid command line option `%1`.

:arg-ok
:arg-ok
shift
goto next-arg

:args-done
if defined upload goto upload
if defined jslint goto jslint

if &quot;%config%&quot;==&quot;Debug&quot; set debug_arg=--debug
if &quot;%target_arch%&quot;==&quot;x64&quot; set msiplatform=x64
if defined nosnapshot set nosnapshot_arg=--without-snapshot
if defined noetw set noetw_arg=--without-etw&amp; set noetw_msi_arg=/p:NoETW=1
if defined noperfctr set noperfctr_arg=--without-perfctr&amp; set noperfctr_msi_arg=/p:NoPerfCtr=1

:project-gen
@rem Skip project generation if requested.
if defined noprojgen goto msbuild

if defined NIGHTLY set TAG=nightly-%NIGHTLY%

@rem Generate the VS project.
SETLOCAL
  if defined VS100COMNTOOLS call &quot;%VS100COMNTOOLS%\VCVarsQueryRegistry.bat&quot;
  python configure %debug_arg% %nosnapshot_arg% %noetw_arg% %noperfctr_arg% --dest-cpu=%target_arch% --tag=%TAG%
  if errorlevel 1 goto create-msvs-files-failed
  if not exist node.sln goto create-msvs-files-failed
  echo Project files generated.
ENDLOCAL

:msbuild
@rem Skip project generation if requested.
if defined nobuild goto sign

@rem Look for Visual Studio 2012
if not defined VS110COMNTOOLS goto vc-set-2010
if not exist &quot;%VS110COMNTOOLS%\..\..\vc\vcvarsall.bat&quot; goto vc-set-2010
call &quot;%VS110COMNTOOLS%\..\..\vc\vcvarsall.bat&quot;
if not defined VCINSTALLDIR goto msbuild-not-found
set GYP_MSVS_VERSION=2012
goto msbuild-found

:vc-set-2010
if not defined VS100COMNTOOLS goto msbuild-not-found
if not exist &quot;%VS100COMNTOOLS%\..\..\vc\vcvarsall.bat&quot; goto msbuild-not-found
call &quot;%VS100COMNTOOLS%\..\..\vc\vcvarsall.bat&quot;
if not defined VCINSTALLDIR goto msbuild-not-found
goto msbuild-found

:msbuild-not-found
echo Build skipped. To build, this file needs to run from VS cmd prompt.
goto run

:msbuild-found
@rem Build the sln with msbuild.
msbuild node.sln /m /t:%target% /p:Configuration=%config% /clp:NoSummary;NoItemAndPropertyList;Verbosity=minimal /nologo
if errorlevel 1 goto exit

:sign
@rem Skip signing if the `nosign` option was specified.
if defined nosign goto licensertf

signtool sign /a Release\node.exe

:licensertf
@rem Skip license.rtf generation if not requested.
if not defined licensertf goto msi

%config%\node tools\license2rtf.js &lt; LICENSE &gt; %config%\license.rtf
if errorlevel 1 echo Failed to generate license.rtf&amp;goto exit

:msi
@rem Skip msi generation if not requested
if not defined msi goto run
call :getnodeversion

if not defined NIGHTLY goto msibuild
set NODE_VERSION=%NODE_VERSION%.%NIGHTLY%

:msibuild
echo Building node-%NODE_VERSION%
msbuild &quot;%~dp0tools\msvs\msi\nodemsi.sln&quot; /m /t:Clean,Build /p:Configuration=%config% /p:Platform=%msiplatform% /p:NodeVersion=%NODE_VERSION% %noetw_msi_arg% %noperfctr_msi_arg% /clp:NoSummary;NoItemAndPropertyList;Verbosity=minimal /nologo
if errorlevel 1 goto exit

if defined nosign goto run
signtool sign /a Release\node-v%NODE_VERSION%-%msiplatform%.msi

:run
@rem Run tests if requested.
if &quot;%test%&quot;==&quot;&quot; goto exit

if &quot;%config%&quot;==&quot;Debug&quot; set test_args=--mode=debug
if &quot;%config%&quot;==&quot;Release&quot; set test_args=--mode=release

if &quot;%test%&quot;==&quot;test&quot; set test_args=%test_args% simple message
if &quot;%test%&quot;==&quot;test-internet&quot; set test_args=%test_args% internet
if &quot;%test%&quot;==&quot;test-pummel&quot; set test_args=%test_args% pummel
if &quot;%test%&quot;==&quot;test-simple&quot; set test_args=%test_args% simple
if &quot;%test%&quot;==&quot;test-message&quot; set test_args=%test_args% message
if &quot;%test%&quot;==&quot;test-gc&quot; set test_args=%test_args% gc
if &quot;%test%&quot;==&quot;test-all&quot; set test_args=%test_args%

:build-node-weak
@rem Build node-weak if required
if &quot;%buildnodeweak%&quot;==&quot;&quot; goto run-tests
&quot;%config%\node&quot; deps\npm\node_modules\node-gyp\bin\node-gyp rebuild --directory=&quot;%~dp0test\gc\node_modules\weak&quot; --nodedir=&quot;%~dp0.&quot;
if errorlevel 1 goto build-node-weak-failed
goto run-tests

:build-node-weak-failed
echo Failed to build node-weak.
goto exit

:run-tests
echo running &#39;python tools/test.py %test_args%&#39;
python tools/test.py %test_args%
if &quot;%test%&quot;==&quot;test&quot; goto jslint
goto exit

:create-msvs-files-failed
echo Failed to create vc project files. 
goto exit

:upload
echo uploading .exe .msi .pdb to nodejs.org
call :getnodeversion
@echo on
ssh node@nodejs.org mkdir -p web/nodejs.org/dist/v%NODE_VERSION%
scp Release\node.msi node@nodejs.org:~/web/nodejs.org/dist/v%NODE_VERSION%/node-v%NODE_VERSION%.msi
scp Release\node.exe node@nodejs.org:~/web/nodejs.org/dist/v%NODE_VERSION%/node.exe
scp Release\node.pdb node@nodejs.org:~/web/nodejs.org/dist/v%NODE_VERSION%/node.pdb
@echo off
goto exit

:jslint
echo running jslint
set PYTHONPATH=tools/closure_linter/
python tools/closure_linter/closure_linter/gjslint.py --unix_mode --strict --nojsdoc -r lib/ -r src/ --exclude_files lib/punycode.js
goto exit

:help
echo vcbuild.bat [debug/release] [msi] [test-all/test-uv/test-internet/test-pummel/test-simple/test-message] [clean] [noprojgen] [nobuild] [nosign] [x86/x64]
echo Examples:
echo   vcbuild.bat                : builds release build
echo   vcbuild.bat debug          : builds debug build
echo   vcbuild.bat release msi    : builds release build and MSI installer package
echo   vcbuild.bat test           : builds debug build and runs tests
goto exit

:exit
goto :EOF

rem ***************
rem   Subroutines
rem ***************

:getnodeversion
set NODE_VERSION=
for /F &quot;usebackq tokens=*&quot; %i in (`python &quot;%~dp0tools\getnodeversion.py&quot;`) do set NODE_VERSION=%i
if not defined NODE_VERSION echo Cannot determine current version of node.js &amp; exit /b 1
goto :EOF
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in6_link" href="javascript:jShowHide('in6');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/common.js">/manta/public/examples/node-v0.10.17/benchmark/common.js</a>
<br />
<div id="in6_contents" style="display: none" class="jObjectContents"><pre><code>var assert = require(&#39;assert&#39;);
var path = require(&#39;path&#39;);
var silent = +process.env.NODE_BENCH_SILENT;

exports.PORT = process.env.PORT || 12346;

// If this is the main module, then run the benchmarks
if (module === require.main) {
  var type = process.argv[2];
  if (!type) {
    console.error(&#39;usage:\n ./node benchmark/common.js &lt;type&gt;&#39;);
    process.exit(1);
  }

  var fs = require(&#39;fs&#39;);
  var dir = path.join(__dirname, type);
  var tests = fs.readdirSync(dir);
  var spawn = require(&#39;child_process&#39;).spawn;

  runBenchmarks();

  function runBenchmarks() {
    var test = tests.shift();
    if (!test)
      return;

    if (test.match(/^[\._]/))
      return process.nextTick(runBenchmarks);

    console.error(type + &#39;/&#39; + test);
    test = path.resolve(dir, test);

    var child = spawn(process.execPath, [ test ], { stdio: &#39;inherit&#39; });
    child.on(&#39;close&#39;, function(code) {
      if (code)
        process.exit(code);
      else {
        console.log(&#39;&#39;);
        runBenchmarks();
      }
    });
  }
}

exports.createBenchmark = function(fn, options) {
  return new Benchmark(fn, options);
};

function Benchmark(fn, options) {
  this.fn = fn;
  this.options = options;
  this.config = parseOpts(options);
  this._name = require.main.filename.split(/benchmark[\/\\]/).pop();
  this._start = [0,0];
  this._started = false;
  var self = this;
  process.nextTick(function() {
    self._run();
  });
}

// benchmark an http server.
Benchmark.prototype.http = function(p, args, cb) {
  var self = this;
  var wrk = path.resolve(__dirname, &#39;..&#39;, &#39;tools&#39;, &#39;wrk&#39;, &#39;wrk&#39;);
  var regexp = /Requests\/sec:[ \t]+([0-9\.]+)/;
  var spawn = require(&#39;child_process&#39;).spawn;
  var url = &#39;http://127.0.0.1:&#39; + exports.PORT + p;

  args = args.concat(url);

  var out = &#39;&#39;;
  var child = spawn(wrk, args);

  child.stdout.setEncoding(&#39;utf8&#39;);

  child.stdout.on(&#39;data&#39;, function(chunk) {
    out += chunk;
  });

  child.on(&#39;close&#39;, function(code) {
    if (cb)
      cb(code);

    if (code) {
      console.error(&#39;wrk failed with &#39; + code);
      process.exit(code)
    }
    var m = out.match(regexp);
    var qps = m &amp;&amp; +m[1];
    if (!qps) {
      console.error(&#39;%j&#39;, out);
      console.error(&#39;wrk produced strange output&#39;);
      process.exit(1);
    }
    self.report(+qps);
  });
};

Benchmark.prototype._run = function() {
  if (this.config)
    return this.fn(this.config);

  // one more more options weren&#39;t set.
  // run with all combinations
  var main = require.main.filename;
  var settings = [];
  var queueLen = 1;
  var options = this.options;

  var queue = Object.keys(options).reduce(function(set, key) {
    var vals = options[key];
    assert(Array.isArray(vals));

    // match each item in the set with each item in the list
    var newSet = new Array(set.length * vals.length);
    var j = 0;
    set.forEach(function(s) {
      vals.forEach(function(val) {
        newSet[j++] = s.concat(key + &#39;=&#39; + val);
      });
    });
    return newSet;
  }, [[main]]);

  var spawn = require(&#39;child_process&#39;).spawn;
  var node = process.execPath;
  var i = 0;
  function run() {
    var argv = queue[i++];
    if (!argv)
      return;
    var child = spawn(node, argv, { stdio: &#39;inherit&#39; });
    child.on(&#39;close&#39;, function(code, signal) {
      if (code)
        console.error(&#39;child process exited with code &#39; + code);
      else
        run();
    });
  }
  run();
};

function parseOpts(options) {
  // verify that there&#39;s an option provided for each of the options
  // if they&#39;re not *all* specified, then we return null.
  var keys = Object.keys(options);
  var num = keys.length;
  var conf = {};
  for (var i = 2; i &lt; process.argv.length; i++) {
    var m = process.argv[i].match(/^(.+)=(.+)$/);
    if (!m || !m[1] || !m[2] || !options[m[1]])
      return null;
    else {
      conf[m[1]] = isFinite(m[2]) ? +m[2] : m[2]
      num--;
    }
  }
  // still go ahead and set whatever WAS set, if it was.
  if (num !== 0) {
    Object.keys(conf).forEach(function(k) {
      options[k] = [conf[k]];
    });
  }
  return num === 0 ? conf : null;
};

Benchmark.prototype.start = function() {
  if (this._started)
    throw new Error(&#39;Called start more than once in a single benchmark&#39;);
  this._started = true;
  this._start = process.hrtime();
};

Benchmark.prototype.end = function(operations) {
  var elapsed = process.hrtime(this._start);
  if (!this._started)
    throw new Error(&#39;called end without start&#39;);
  if (typeof operations !== &#39;number&#39;)
    throw new Error(&#39;called end() without specifying operation count&#39;);
  var time = elapsed[0] + elapsed[1]/1e9;
  var rate = operations/time;
  this.report(rate);
};

Benchmark.prototype.report = function(value) {
  var heading = this.getHeading();
  if (!silent)
    console.log(&#39;%s: %s&#39;, heading, value.toPrecision(5));
  process.exit(0);
};

Benchmark.prototype.getHeading = function() {
  var conf = this.config;
  return this._name + &#39; &#39; + Object.keys(conf).map(function(key) {
    return key + &#39;=&#39; + conf[key];
  }).join(&#39; &#39;);
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in7_link" href="javascript:jShowHide('in7');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/fs-write-stream-throughput.js">/manta/public/examples/node-v0.10.17/benchmark/fs-write-stream-throughput.js</a>
<br />
<div id="in7_contents" style="display: none" class="jObjectContents"><pre><code>
// If there are no args, then this is the root.  Run all the benchmarks!
if (!process.argv[2])
  parent();
else
  runTest(+process.argv[2], +process.argv[3], process.argv[4]);

function parent() {
  var types = [ &#39;string&#39;, &#39;buffer&#39; ];
  var durs = [ 1, 5 ];
  var sizes = [ 1, 10, 100, 2048, 10240 ];
  var queue = [];
  types.forEach(function(t) {
    durs.forEach(function(d) {
      sizes.forEach(function(s) {
        queue.push([__filename, d, s, t]);
      });
    });
  });

  var spawn = require(&#39;child_process&#39;).spawn;
  var node = process.execPath;

  run();

  function run() {
    var args = queue.shift();
    if (!args)
      return;
    var child = spawn(node, args, { stdio: &#39;inherit&#39; });
    child.on(&#39;close&#39;, function(code, signal) {
      if (code)
        throw new Error(&#39;Benchmark failed: &#39; + args.slice(1));
      run();
    });
  }
}

function runTest(dur, size, type) {
  if (type !== &#39;string&#39;)
    type = &#39;buffer&#39;;
  switch (type) {
    case &#39;string&#39;:
      var chunk = new Array(size + 1).join(&#39;a&#39;);
      break;
    case &#39;buffer&#39;:
      var chunk = new Buffer(size);
      chunk.fill(&#39;a&#39;);
      break;
  }

  var writes = 0;
  var fs = require(&#39;fs&#39;);
  try { fs.unlinkSync(&#39;write_stream_throughput&#39;); } catch (e) {}

  var start
  var end;
  function done() {
    var time = end[0] + end[1]/1E9;
    var written = fs.statSync(&#39;write_stream_throughput&#39;).size / 1024;
    var rate = (written / time).toFixed(2);
    console.log(&#39;fs_write_stream_dur_%d_size_%d_type_%s: %d&#39;,
                dur, size, type, rate);

    try { fs.unlinkSync(&#39;write_stream_throughput&#39;); } catch (e) {}
  }

  var f = require(&#39;fs&#39;).createWriteStream(&#39;write_stream_throughput&#39;);
  f.on(&#39;drain&#39;, write);
  f.on(&#39;open&#39;, write);
  f.on(&#39;close&#39;, done);

  // streams2 fs.WriteStreams will let you send a lot of writes into the
  // buffer before returning false, so capture the *actual* end time when
  // all the bytes have been written to the disk, indicated by &#39;finish&#39;
  f.on(&#39;finish&#39;, function() {
    end = process.hrtime(start);
  });

  var ending = false;
  function write() {
    // don&#39;t try to write after we end, even if a &#39;drain&#39; event comes.
    // v0.8 streams are so sloppy!
    if (ending)
      return;

    start = start || process.hrtime();
    while (false !== f.write(chunk));
    end = process.hrtime(start);

    if (end[0] &gt;= dur) {
      ending = true;
      f.end();
    }
  }
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in8_link" href="javascript:jShowHide('in8');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/http-flamegraph.sh">/manta/public/examples/node-v0.10.17/benchmark/http-flamegraph.sh</a>
<br />
<div id="in8_contents" style="display: none" class="jObjectContents"><pre><code>#!/bin/bash
cd &quot;$(dirname &quot;$(dirname $0)&quot;)&quot;

node=${NODE:-./node}

name=${NAME:-stacks}

if type sysctl &amp;&gt;/dev/null; then
  # darwin and linux
  sudo sysctl -w net.inet.ip.portrange.first=12000
  sudo sysctl -w net.inet.tcp.msl=1000
  sudo sysctl -w kern.maxfiles=1000000 kern.maxfilesperproc=1000000
elif type /usr/sbin/ndd &amp;&gt;/dev/null; then
  # sunos
  /usr/sbin/ndd -set /dev/tcp tcp_smallest_anon_port 12000
  /usr/sbin/ndd -set /dev/tcp tcp_largest_anon_port 65535
  /usr/sbin/ndd -set /dev/tcp tcp_max_buf 2097152
  /usr/sbin/ndd -set /dev/tcp tcp_xmit_hiwat 1048576
  /usr/sbin/ndd -set /dev/tcp tcp_recv_hiwat 1048576
fi

ulimit -n 100000
$node benchmark/http_simple.js &amp;
nodepid=$!
echo &quot;node pid = $nodepid&quot;
sleep 1

# has to stay alive until dtrace exits
dtrace -n &#39;profile-97/pid == &#39;$nodepid&#39; &amp;&amp; arg1/{ @[jstack(150, 8000)] = count(); } tick-60s { exit(0); }&#39; \
  | grep -v _ZN2v88internalL21Builtin_HandleApiCallENS0_12_GLOBAL__N_116BuiltinA \
  &gt; &quot;$name&quot;.src &amp;

dtracepid=$!

echo &quot;dtrace pid = $dtracepid&quot;

sleep 1

test () {
  c=$1
  t=$2
  l=$3
  k=$4
  ab $k -t 10 -c $c http://127.0.0.1:8000/$t/$l \
    2&gt;&amp;1 | grep Req
}

#test 100 bytes 1024
#test 10  bytes 100 -k
#test 100 bytes 1024 -k
#test 100 bytes 1024 -k
#test 100 bytes 1024 -k

echo &#39;Keep going until dtrace stops listening...&#39;
while pargs $dtracepid &amp;&gt;/dev/null; do
  test 100 bytes ${LENGTH:-1} -k
done

kill $nodepid

echo &#39;Turn the stacks into a svg&#39;
stackvis dtrace flamegraph-svg &lt; &quot;$name&quot;.src &gt; &quot;$name&quot;.raw.svg

echo &#39;Prune tiny stacks out of the graph&#39;
node -e &#39;
var infile = process.argv[1];
var outfile = process.argv[2];
var output = &quot;&quot;;
var fs = require(&quot;fs&quot;);
var input = fs.readFileSync(infile, &quot;utf8&quot;);

input = input.split(&quot;id=\&quot;details\&quot; &gt; &lt;/text&gt;&quot;);
var head = input.shift() + &quot;id=\&quot;details\&quot; &gt; &lt;/text&gt;&quot;;
input = input.join(&quot;id=\&quot;details\&quot; &gt; &lt;/text&gt;&quot;);

var tail = &quot;&lt;/svg&gt;&quot;;
input = input.split(&quot;&lt;/svg&gt;&quot;)[0];

var minyKept = Infinity;
var minyOverall = Infinity;
var rects = input.trim().split(/\n/).filter(function(rect) {
  var my = rect.match(/y=&quot;([0-9\.]+)&quot;/);

  if (!my)
    return false;
  var y = +my[1];
  if (!y)
    return false;
  minyOverall = Math.min(minyOverall, y);

  // pluck off everything that will be less than one pixel.
  var mw = rect.match(/width=&quot;([0-9\.]+)&quot;/)
  if (mw) {
    var width = +mw[1];
    if (!(width &gt;= 1))
      return false;
  }
  minyKept = Math.min(minyKept, y);
  return true;
});

// move everything up to the top of the page.
var ydiff = minyKept - minyOverall;
rects = rects.map(function(rect) {
  var my = rect.match(/y=&quot;([0-9\.]+)&quot;/);
  var y = +my[1];
  var newy = y - ydiff;
  rect = rect.replace(/y=&quot;([0-9\.]+)&quot;/, &quot;y=\&quot;&quot; + newy + &quot;\&quot;&quot;);
  return rect;
});

fs.writeFileSync(outfile, head + &quot;\n&quot; + rects.join(&quot;\n&quot;) + &quot;\n&quot; + tail);
&#39; &quot;$name&quot;.raw.svg &quot;$name&quot;.svg

echo &#39;&#39;
echo &#39;done. Results in &#39;&quot;$name&quot;&#39;.svg&#39;
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in9_link" href="javascript:jShowHide('in9');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/compare.js">/manta/public/examples/node-v0.10.17/benchmark/compare.js</a>
<br />
<div id="in9_contents" style="display: none" class="jObjectContents"><pre><code>var usage = &#39;node benchmark/compare.js &#39; +
            &#39;&lt;node-binary1&gt; &lt;node-binary2&gt; &#39; +
            &#39;[--html] [--red|-r] [--green|-g]&#39;;

var show = &#39;both&#39;;
var nodes = [];
var html = false;

for (var i = 2; i &lt; process.argv.length; i++) {
  var arg = process.argv[i];
  switch (arg) {
    case &#39;--red&#39;: case &#39;-r&#39;:
      show = show === &#39;green&#39; ? &#39;both&#39; : &#39;red&#39;;
      break;
    case &#39;--green&#39;: case &#39;-g&#39;:
      show = show === &#39;red&#39; ? &#39;both&#39; : &#39;green&#39;;
      break;
    case &#39;--html&#39;:
      html = true;
      break;
    case &#39;-h&#39;: case &#39;-?&#39;: case &#39;--help&#39;:
      console.log(usage);
      process.exit(0);
    default:
      nodes.push(arg);
      break;
  }
}

if (!html) {
  var start = &#39;&#39;;
  var green = &#39;\033[1;32m&#39;;
  var red = &#39;\033[1;31m&#39;;
  var reset = &#39;\033[m&#39;;
  var end = &#39;&#39;;
} else {
  var start = &#39;&lt;pre style=&quot;background-color:#333;color:#eee&quot;&gt;&#39;;
  var green = &#39;&lt;span style=&quot;background-color:#0f0;color:#000&quot;&gt;&#39;;
  var red = &#39;&lt;span style=&quot;background-color:#f00;color:#fff&quot;&gt;&#39;;
  var reset = &#39;&lt;/span&gt;&#39;;
  var end = &#39;&lt;/pre&gt;&#39;;
}

var runBench = process.env.NODE_BENCH || &#39;bench&#39;;

if (nodes.length !== 2)
  return console.error(&#39;usage:\n  %s&#39;, usage);

var spawn = require(&#39;child_process&#39;).spawn;
var results = {};
var toggle = 1;
var r = (+process.env.NODE_BENCH_RUNS || 1) * 2;

run();
function run() {
  if (--r &lt; 0)
    return compare();
  toggle = ++toggle % 2;

  var node = nodes[toggle];
  console.error(&#39;running %s&#39;, node);
  var env = {};
  for (var i in process.env)
    env[i] = process.env[i];
  env.NODE = node;

  var out = &#39;&#39;;
  var child = spawn(&#39;make&#39;, [runBench], { env: env });
  child.stdout.setEncoding(&#39;utf8&#39;);
  child.stdout.on(&#39;data&#39;, function(c) {
    out += c;
  });

  child.stderr.pipe(process.stderr);

  child.on(&#39;close&#39;, function(code) {
    if (code) {
      console.error(&#39;%s exited with code=%d&#39;, node, code);
      process.exit(code);
    } else {
      out.trim().split(/\r?\n/).forEach(function(line) {
        line = line.trim();
        if (!line)
          return;

        var s = line.split(&#39;:&#39;);
        var num = +s.pop();
        if (!num &amp;&amp; num !== 0)
          return;

        line = s.join(&#39;:&#39;);
        var res = results[line] = results[line] || {};
        res[node] = res[node] || [];
        res[node].push(num);
      });

      run();
    }
  });
}

function compare() {
  // each result is an object with {&quot;foo.js arg=bar&quot;:12345,...}
  // compare each thing, and show which node did the best.
  // node[0] is shown in green, node[1] shown in red.
  var maxLen = -Infinity;
  var util = require(&#39;util&#39;);
  console.log(start);

  Object.keys(results).map(function(bench) {
    var res = results[bench];
    var n0 = avg(res[nodes[0]]);
    var n1 = avg(res[nodes[1]]);

    var pct = ((n0 - n1) / n1 * 100).toFixed(2);

    var g = n0 &gt; n1 ? green : &#39;&#39;;
    var r = n0 &gt; n1 ? &#39;&#39; : red;
    var c = r || g;

    if (show === &#39;green&#39; &amp;&amp; !g || show === &#39;red&#39; &amp;&amp; !r)
      return;

    var r0 = util.format(&#39;%s%s: %d%s&#39;, g, nodes[0], n0.toPrecision(5), g ? reset : &#39;&#39;);
    var r1 = util.format(&#39;%s%s: %d%s&#39;, r, nodes[1], n1.toPrecision(5), r ? reset : &#39;&#39;);
    var pct = c + pct + &#39;%&#39; + reset;
    var l = util.format(&#39;%s: %s %s&#39;, bench, r0, r1);
    maxLen = Math.max(l.length + pct.length, maxLen);
    return [l, pct];
  }).filter(function(l) {
    return l;
  }).forEach(function(line) {
    var l = line[0];
    var pct = line[1];
    var dotLen = maxLen - l.length - pct.length + 2;
    var dots = &#39; &#39; + new Array(Math.max(0, dotLen)).join(&#39;.&#39;) + &#39; &#39;;
    console.log(l + dots + pct);
  });
  console.log(end);
}

function avg(list) {
  if (list.length &gt;= 3) {
    list = list.sort();
    var q = Math.floor(list.length / 4) || 1;
    list = list.slice(q, -q);
  }
  return list.reduce(function(a, b) {
    return a + b;
  }, 0) / list.length;
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in10_link" href="javascript:jShowHide('in10');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/http.sh">/manta/public/examples/node-v0.10.17/benchmark/http.sh</a>
<br />
<div id="in10_contents" style="display: none" class="jObjectContents"><pre><code>#!/bin/bash
cd &quot;$(dirname &quot;$(dirname $0)&quot;)&quot;

if type sysctl &amp;&gt;/dev/null; then
  # darwin and linux
  sudo sysctl -w net.ipv4.ip_local_port_range=&quot;12000 65535&quot;
  sudo sysctl -w net.inet.ip.portrange.first=12000
  sudo sysctl -w net.inet.tcp.msl=1000
  sudo sysctl -w kern.maxfiles=1000000 kern.maxfilesperproc=1000000
elif type /usr/sbin/ndd &amp;&gt;/dev/null; then
  # sunos
  /usr/sbin/ndd -set /dev/tcp tcp_smallest_anon_port 12000
  /usr/sbin/ndd -set /dev/tcp tcp_largest_anon_port 65535
  /usr/sbin/ndd -set /dev/tcp tcp_max_buf 2097152
  /usr/sbin/ndd -set /dev/tcp tcp_xmit_hiwat 1048576
  /usr/sbin/ndd -set /dev/tcp tcp_recv_hiwat 1048576
fi

ulimit -n 100000

k=${KEEPALIVE}
if [ &quot;$k&quot; = &quot;no&quot; ]; then
  k=&quot;&quot;
else
  k=&quot;-k&quot;
fi
node=${NODE:-./node}

$node benchmark/http_simple.js &amp;
npid=$!

sleep 1

if [ &quot;$k&quot; = &quot;-k&quot; ]; then
  echo &quot;using keepalive&quot;
fi

for i in a a a a a a a a a a a a a a a a a a a a; do
  ab $k -t 10 -c 100 http://127.0.0.1:8000/${TYPE:-bytes}/${LENGTH:-1024} \
    2&gt;&amp;1 | grep Req | egrep -o &#39;[0-9\.]+&#39;
done

kill $npid
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in11_link" href="javascript:jShowHide('in11');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/http_bench.js">/manta/public/examples/node-v0.10.17/benchmark/http_bench.js</a>
<br />
<div id="in11_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var spawn = require(&#39;child_process&#39;).spawn;
var cluster = require(&#39;cluster&#39;);
var http = require(&#39;http&#39;);

var options = {
  mode: &#39;master&#39;,
  host: &#39;127.0.0.1&#39;,
  port: 22344,
  path: &#39;/&#39;,
  servers: 1,
  clients: 1
};

for (var i = 2; i &lt; process.argv.length; ++i) {
  var args = process.argv[i].split(&#39;=&#39;, 2);
  var key = args[0];
  var val = args[1];
  options[key] = val;
}

switch (options.mode) {
case &#39;master&#39;: startMaster(); break;
case &#39;server&#39;: startServer(); break;
case &#39;client&#39;: startClient(); break;
default: throw new Error(&#39;Bad mode: &#39; + options.mode);
}

process.title = &#39;http_bench[&#39; + options.mode + &#39;]&#39;;

// monkey-patch the log functions so they include name + pid
console.log = patch(console.log);
console.trace = patch(console.trace);
console.error = patch(console.error);

function patch(fun) {
  var prefix = process.title + &#39;[&#39; + process.pid + &#39;] &#39;;
  return function() {
    var args = Array.prototype.slice.call(arguments);
    args[0] = prefix + args[0];
    return fun.apply(console, args);
  };
}

function startMaster() {
  if (!cluster.isMaster) return startServer();

  for (var i = ~~options.servers; i &gt; 0; --i) cluster.fork();

  for (var i = ~~options.clients; i &gt; 0; --i) {
    var cp = spawn(process.execPath, [__filename, &#39;mode=client&#39;]);
    cp.stdout.pipe(process.stdout);
    cp.stderr.pipe(process.stderr);
  }
}

function startServer() {
  http.createServer(onRequest).listen(options.port, options.host);

  var body = Array(1024).join(&#39;x&#39;);
  var headers = {&#39;Content-Length&#39;: &#39;&#39; + body.length};

  function onRequest(req, res) {
    req.on(&#39;error&#39;, onError);
    res.on(&#39;error&#39;, onError);
    res.writeHead(200, headers);
    res.end(body);
  }

  function onError(err) {
    console.error(err.stack);
  }
}

function startClient() {
  // send off a bunch of concurrent requests
  // TODO make configurable
  sendRequest();
  sendRequest();

  function sendRequest() {
    var req = http.request(options, onConnection);
    req.on(&#39;error&#39;, onError);
    req.end();
  }

  // add a little back-off to prevent EADDRNOTAVAIL errors, it&#39;s pretty easy
  // to exhaust the available port range
  function relaxedSendRequest() {
    setTimeout(sendRequest, 1);
  }

  function onConnection(res) {
    res.on(&#39;error&#39;, onError);
    res.on(&#39;data&#39;, onData);
    res.on(&#39;end&#39;, relaxedSendRequest);
  }

  function onError(err) {
    console.error(err.stack);
    relaxedSendRequest();
  }

  function onData(data) {
    // this space intentionally left blank
  }
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in12_link" href="javascript:jShowHide('in12');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/http_simple.js">/manta/public/examples/node-v0.10.17/benchmark/http_simple.js</a>
<br />
<div id="in12_contents" style="display: none" class="jObjectContents"><pre><code>var path = require(&#39;path&#39;),
    exec = require(&#39;child_process&#39;).exec,
    http = require(&#39;http&#39;);

var port = parseInt(process.env.PORT || 8000);

var fixed = makeString(20 * 1024, &#39;C&#39;),
    storedBytes = {},
    storedBuffer = {},
    storedUnicode = {};

var useDomains = process.env.NODE_USE_DOMAINS;

// set up one global domain.
if (useDomains) {
  var domain = require(&#39;domain&#39;);
  var gdom = domain.create();
  gdom.on(&#39;error&#39;, function(er) {
    console.error(&#39;Error on global domain&#39;, er);
    throw er;
  });
  gdom.enter();
}

var server = module.exports = http.createServer(function (req, res) {
  if (useDomains) {
    var dom = domain.create();
    dom.add(req);
    dom.add(res);
  }

  var commands = req.url.split(&#39;/&#39;);
  var command = commands[1];
  var body = &#39;&#39;;
  var arg = commands[2];
  var n_chunks = parseInt(commands[3], 10);
  var status = 200;

  if (command == &#39;bytes&#39;) {
    var n = ~~arg;
    if (n &lt;= 0)
      throw new Error(&#39;bytes called with n &lt;= 0&#39;)
    if (storedBytes[n] === undefined) {
      storedBytes[n] = makeString(n, &#39;C&#39;);
    }
    body = storedBytes[n];

  } else if (command == &#39;buffer&#39;) {
    var n = ~~arg;
    if (n &lt;= 0)
      throw new Error(&#39;buffer called with n &lt;= 0&#39;);
    if (storedBuffer[n] === undefined) {
      storedBuffer[n] = new Buffer(n);
      for (var i = 0; i &lt; n; i++) {
        storedBuffer[n][i] = &#39;C&#39;.charCodeAt(0);
      }
    }
    body = storedBuffer[n];

  } else if (command == &#39;unicode&#39;) {
    var n = ~~arg;
    if (n &lt;= 0)
      throw new Error(&#39;unicode called with n &lt;= 0&#39;);
    if (storedUnicode[n] === undefined) {
      storedUnicode[n] = makeString(n, &#39;\u263A&#39;);
    }
    body = storedUnicode[n];

  } else if (command == &#39;quit&#39;) {
    res.connection.server.close();
    body = &#39;quitting&#39;;

  } else if (command == &#39;fixed&#39;) {
    body = fixed;

  } else if (command == &#39;echo&#39;) {
    res.writeHead(200, { &#39;Content-Type&#39;: &#39;text/plain&#39;,
                         &#39;Transfer-Encoding&#39;: &#39;chunked&#39; });
    req.pipe(res);
    return;

  } else {
    status = 404;
    body = &#39;not found\n&#39;;
  }

  // example: http://localhost:port/bytes/512/4
  // sends a 512 byte body in 4 chunks of 128 bytes
  if (n_chunks &gt; 0) {
    res.writeHead(status, { &#39;Content-Type&#39;: &#39;text/plain&#39;,
                            &#39;Transfer-Encoding&#39;: &#39;chunked&#39; });
    // send body in chunks
    var len = body.length;
    var step = Math.floor(len / n_chunks) || 1;

    for (var i = 0, n = (n_chunks - 1); i &lt; n; ++i) {
      res.write(body.slice(i * step, i * step + step));
    }
    res.end(body.slice((n_chunks - 1) * step));
  } else {
    var content_length = body.length.toString();

    res.writeHead(status, { &#39;Content-Type&#39;: &#39;text/plain&#39;,
                            &#39;Content-Length&#39;: content_length });
    res.end(body);
  }
});

function makeString(size, c) {
  var s = &#39;&#39;;
  while (s.length &lt; size) {
    s += c;
  }
  return s;
}

server.listen(port, function () {
  if (module === require.main)
    console.error(&#39;Listening at http://127.0.0.1:&#39;+port+&#39;/&#39;);
});
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in13_link" href="javascript:jShowHide('in13');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/http_simple_bench.sh">/manta/public/examples/node-v0.10.17/benchmark/http_simple_bench.sh</a>
<br />
<div id="in13_contents" style="display: none" class="jObjectContents"><pre><code>#!/bin/bash

SERVER=127.0.0.1
PORT=${PORT:=8000}

# You may want to configure your TCP settings to make many ports available
# to node and ab. On macintosh use: 
#   sudo sysctl -w net.inet.ip.portrange.first=32768
#   sudo sysctl -w net.inet.tcp.msl=1000

if [ ! -d benchmark/ ]; then
  echo &quot;Run this script from the node root directory&quot;
  exit 1
fi

if [ $SERVER == &quot;127.0.0.1&quot; ]; then
  ./node benchmark/http_simple.js &amp;
  node_pid=$!
  sleep 1
fi

date=`date &quot;+%Y%m%d%H%M%S&quot;`

ab_hello_world() {
  local type=&quot;$1&quot;
  local ressize=&quot;$2&quot;
  if [ $type == &quot;string&quot; ]; then 
    local uri=&quot;bytes/$ressize&quot;
  else
    local uri=&quot;buffer/$ressize&quot;
  fi


  name=&quot;ab-hello-world-$type-$ressize&quot;

  dir=&quot;.benchmark_reports/$name/$rev/&quot;
  if [ ! -d $dir ]; then
    mkdir -p $dir
  fi

  summary_fn=&quot;$dir/$date.summary&quot;
  data_fn=&quot;$dir/$date.data&quot;

  echo &quot;Bench $name starts in 3 seconds...&quot;
  # let shit calm down
  sleep 3

  # hammer that as hard as it can for 10 seconds.
  ab -g $data_fn -c 100 -t 10 http://$SERVER:$PORT/$uri &gt; $summary_fn

  # add our data about the server
  echo &gt;&gt; $summary_fn
  echo &gt;&gt; $summary_fn
  echo &quot;webserver-rev: $rev&quot; &gt;&gt; $summary_fn
  echo &quot;webserver-uname: $uname&quot; &gt;&gt; $summary_fn

  grep Req $summary_fn 

  echo &quot;Summary: $summary_fn&quot;
  echo
}

# 1k
ab_hello_world &#39;string&#39; &#39;1024&#39;
ab_hello_world &#39;buffer&#39; &#39;1024&#39;

# 100k 
ab_hello_world &#39;string&#39; &#39;102400&#39;
ab_hello_world &#39;buffer&#39; &#39;102400&#39;


if [ ! -z $node_pid ]; then
  kill -9 $node_pid
fi
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in14_link" href="javascript:jShowHide('in14');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/http_simple.rb">/manta/public/examples/node-v0.10.17/benchmark/http_simple.rb</a>
<br />
<div id="in14_contents" style="display: none" class="jObjectContents"><pre><code>DIR = File.dirname(__FILE__)

def fib(n)
  return 1 if n &lt;= 1
  fib(n-1) + fib(n-2)
end

def wait(seconds)
  n = (seconds / 0.01).to_i
  n.times do
    sleep(0.01)
    #File.read(DIR + &#39;/yahoo.html&#39;)
  end
end

class SimpleApp
  @@responses = {}

  def initialize
    @count = 0
  end

  def deferred?(env)
    false
  end

  def call(env)
    path = env[&#39;PATH_INFO&#39;] || env[&#39;REQUEST_URI&#39;]
    commands = path.split(&#39;/&#39;)

    @count += 1
    if commands.include?(&#39;periodical_activity&#39;) and @count % 10 != 1
      return [200, {&#39;Content-Type&#39;=&gt;&#39;text/plain&#39;}, &quot;quick response!\r\n&quot;]
    end

    if commands.include?(&#39;fibonacci&#39;)
      n = commands.last.to_i
      raise &quot;fibonacci called with n &lt;= 0&quot; if n &lt;= 0
      body = (1..n).to_a.map { |i| fib(i).to_s }.join(&#39; &#39;)
      status = 200

    elsif commands.include?(&#39;wait&#39;)
      n = commands.last.to_f
      raise &quot;wait called with n &lt;= 0&quot; if n &lt;= 0
      wait(n)
      body = &quot;waited about #{n} seconds&quot;
      status = 200

    elsif commands.include?(&#39;bytes&#39;)
      n = commands.last.to_i
      raise &quot;bytes called with n &lt;= 0&quot; if n &lt;= 0
      body = @@responses[n] || &quot;C&quot;*n
      status = 200

    elsif commands.include?(&#39;fixed&#39;)
      n = 20 * 1024;
      body = @@responses[n] || &quot;C&quot;*n
      status = 200

    elsif commands.include?(&#39;test_post_length&#39;)
      input_body = &quot;&quot;
      while chunk = env[&#39;rack.input&#39;].read(512)
        input_body &lt;&lt; chunk
      end
      if env[&#39;CONTENT_LENGTH&#39;].to_i == input_body.length
        body = &quot;Content-Length matches input length&quot;
        status = 200
      else
        body = &quot;Content-Length doesn&#39;t matches input length!
          content_length = #{env[&#39;CONTENT_LENGTH&#39;].to_i}
          input_body.length = #{input_body.length}&quot;
        status = 500
      end
    else
      status = 404
      body = &quot;Undefined url&quot;
    end

    body += &quot;\r\n&quot;
    headers = {&#39;Content-Type&#39; =&gt; &#39;text/plain&#39;, &#39;Content-Length&#39; =&gt; body.length.to_s }
    [status, headers, [body]]
  end
end


if $0 == __FILE__
  #require DIR + &#39;/../lib/ebb&#39;
  require &#39;rubygems&#39;
  require &#39;rack&#39;
  require &#39;thin&#39;
  require &#39;ebb&#39;
#  Rack::Handler::Mongrel.run(SimpleApp.new, :Port =&gt; 8000)
  Thin::Server.start(&quot;0.0.0.0&quot;, 8000, SimpleApp.new)
#  Ebb::start_server(SimpleApp.new, :port =&gt; 8000)
end
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in15_link" href="javascript:jShowHide('in15');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/http_simple_auto.js">/manta/public/examples/node-v0.10.17/benchmark/http_simple_auto.js</a>
<br />
<div id="in15_contents" style="display: none" class="jObjectContents"><pre><code>//
// Usage:
//   node benchmark/http_simple_auto.js &lt;args&gt; &lt;target&gt;
//
// Where:
//   &lt;args&gt;   Arguments to pass to `ab`.
//   &lt;target&gt; Target to benchmark, e.g. `bytes/1024` or `buffer/8192`.
//

var path = require(&quot;path&quot;);
var http = require(&quot;http&quot;);
var spawn = require(&quot;child_process&quot;).spawn;

var port = parseInt(process.env.PORT || 8000);

var fixed = &quot;&quot;
for (var i = 0; i &lt; 20*1024; i++) {
  fixed += &quot;C&quot;;
}

var stored = {};
var storedBuffer = {};

var server = http.createServer(function (req, res) {
  var commands = req.url.split(&quot;/&quot;);
  var command = commands[1];
  var body = &quot;&quot;;
  var arg = commands[2];
  var n_chunks = parseInt(commands[3], 10);
  var status = 200;

  if (command == &quot;bytes&quot;) {
    var n = parseInt(arg, 10)
    if (n &lt;= 0)
      throw &quot;bytes called with n &lt;= 0&quot;
    if (stored[n] === undefined) {
      stored[n] = &quot;&quot;;
      for (var i = 0; i &lt; n; i++) {
        stored[n] += &quot;C&quot;
      }
    }
    body = stored[n];

  } else if (command == &quot;buffer&quot;) {
    var n = parseInt(arg, 10)
    if (n &lt;= 0) throw new Error(&quot;bytes called with n &lt;= 0&quot;);
    if (storedBuffer[n] === undefined) {
      storedBuffer[n] = new Buffer(n);
      for (var i = 0; i &lt; n; i++) {
        storedBuffer[n][i] = &quot;C&quot;.charCodeAt(0);
      }
    }
    body = storedBuffer[n];

  } else if (command == &quot;quit&quot;) {
    res.connection.server.close();
    body = &quot;quitting&quot;;

  } else if (command == &quot;fixed&quot;) {
    body = fixed;

  } else if (command == &quot;echo&quot;) {
    res.writeHead(200, { &quot;Content-Type&quot;: &quot;text/plain&quot;,
                         &quot;Transfer-Encoding&quot;: &quot;chunked&quot; });
    req.pipe(res);
    return;

  } else {
    status = 404;
    body = &quot;not found\n&quot;;
  }

  // example: http://localhost:port/bytes/512/4
  // sends a 512 byte body in 4 chunks of 128 bytes
  if (n_chunks &gt; 0) {
    res.writeHead(status, { &quot;Content-Type&quot;: &quot;text/plain&quot;,
                            &quot;Transfer-Encoding&quot;: &quot;chunked&quot; });
    // send body in chunks
    var len = body.length;
    var step = Math.floor(len / n_chunks) || 1;

    for (var i = 0, n = (n_chunks - 1); i &lt; n; ++i) {
      res.write(body.slice(i * step, i * step + step));
    }
    res.end(body.slice((n_chunks - 1) * step));
  } else {
    var content_length = body.length.toString();

    res.writeHead(status, { &quot;Content-Type&quot;: &quot;text/plain&quot;,
                            &quot;Content-Length&quot;: content_length });
    res.end(body);
  }

});

server.listen(port, function () {
  var url = &#39;http://127.0.0.1:&#39; + port + &#39;/&#39;;

  var n = process.argv.length - 1;
  process.argv[n] = url + process.argv[n];

  var cp = spawn(&#39;ab&#39;, process.argv.slice(2));
  cp.stdout.pipe(process.stdout);
  cp.stderr.pipe(process.stderr);
  cp.on(&#39;exit&#39;, function() {
    server.close();
    process.nextTick(dump_mm_stats);
  });
});

function dump_mm_stats() {
  if (typeof gc != &#39;function&#39;) return;

  var before = process.memoryUsage();
  for (var i = 0; i &lt; 10; ++i) gc();
  var after = process.memoryUsage();
  setTimeout(print_stats, 250); // give GC time to settle

  function print_stats() {
    console.log(&#39;\nBEFORE / AFTER GC&#39;);
    [&#39;rss&#39;, &#39;heapTotal&#39;, &#39;heapUsed&#39;].forEach(function(key) {
      var a = before[key] / (1024 * 1024);
      var b = after[key] / (1024 * 1024);
      console.log(&#39;%sM / %sM %s&#39;, a.toFixed(2), b.toFixed(2), key);
    });
  }
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in16_link" href="javascript:jShowHide('in16');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/http_server_lag.js">/manta/public/examples/node-v0.10.17/benchmark/http_server_lag.js</a>
<br />
<div id="in16_contents" style="display: none" class="jObjectContents"><pre><code>var http = require(&#39;http&#39;);
var port = parseInt(process.env.PORT, 10) || 8000;
var defaultLag = parseInt(process.argv[2], 10) || 100;

http.createServer(function(req, res) {
  res.writeHead(200, { &#39;content-type&#39;: &#39;text/plain&#39;,
                       &#39;content-length&#39;: &#39;2&#39; });

  var lag = parseInt(req.url.split(&quot;/&quot;).pop(), 10) || defaultLag;
  setTimeout(function() {
    res.end(&#39;ok&#39;);
  }, lag);
}).listen(port, &#39;localhost&#39;);
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in17_link" href="javascript:jShowHide('in17');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/http_simple_cluster.js">/manta/public/examples/node-v0.10.17/benchmark/http_simple_cluster.js</a>
<br />
<div id="in17_contents" style="display: none" class="jObjectContents"><pre><code>var cluster = require(&#39;cluster&#39;);
var os = require(&#39;os&#39;);

if (cluster.isMaster) {
  console.log(&#39;master running on pid %d&#39;, process.pid);
  for (var i = 0, n = os.cpus().length; i &lt; n; ++i) cluster.fork();
} else {
  require(__dirname + &#39;/http_simple.js&#39;);
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in18_link" href="javascript:jShowHide('in18');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/report-startup-memory.js">/manta/public/examples/node-v0.10.17/benchmark/report-startup-memory.js</a>
<br />
<div id="in18_contents" style="display: none" class="jObjectContents"><pre><code>console.log(process.memoryUsage().rss);
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in19_link" href="javascript:jShowHide('in19');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/idle_clients.js">/manta/public/examples/node-v0.10.17/benchmark/idle_clients.js</a>
<br />
<div id="in19_contents" style="display: none" class="jObjectContents"><pre><code>net = require(&#39;net&#39;);

var errors = 0, connections = 0;

var lastClose = 0;

function connect () {
  process.nextTick(function () {
    var s = net.Stream();
    var gotConnected = false;
    s.connect(9000);

    s.on(&#39;connect&#39;, function () {
      gotConnected = true;
      connections++;
      connect();
    });

    s.on(&#39;close&#39;, function () {
      if (gotConnected) connections--;
      lastClose = new Date();
    });

    s.on(&#39;error&#39;, function () {
      errors++;
    });
  });
}

connect();


var oldConnections, oldErrors;

// Try to start new connections every so often
setInterval(connect, 5000);

setInterval(function () {
  if (oldConnections != connections) {
    oldConnections = connections;
    console.log(&quot;CLIENT %d connections: %d&quot;, process.pid, connections);
  }

  if (oldErrors != errors) {
    oldErrors = errors;
    console.log(&quot;CLIENT %d errors: %d&quot;, process.pid, errors);
  }
}, 1000);

</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in20_link" href="javascript:jShowHide('in20');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/plot.R">/manta/public/examples/node-v0.10.17/benchmark/plot.R</a>
<br />
<div id="in20_contents" style="display: none" class="jObjectContents"><pre><code>#!/usr/bin/env Rscript

# To use this script you&#39;ll need to install R: http://www.r-project.org/
# and a library for R called ggplot2 
# Which can be done by starting R and typing install.packages(&quot;ggplot2&quot;)
# like this:
#
#     shell% R
#     R version 2.11.0 beta (2010-04-12 r51689)
#     &gt;  install.packages(&quot;ggplot2&quot;)
#     (follow prompt) 
#
# Then you can try this script by providing a full path to .data file
# outputed from &#39;make bench&#39;
#
#     &gt; cd ~/src/node
#     &gt; make bench
#     ...
#     &gt; ./benchmark/plot.R .benchmark_reports/ab-hello-world-buffer-1024/ff456b38862de3fd0118c6ac6b3f46edb1fbb87f/20101013162056.data
#     
# This will generate a PNG file which you can view
#
#
# Hopefully these steps will be automated in the future.



library(ggplot2)

args &lt;- commandArgs(TRUE)

ab.load &lt;- function (filename, name) {
  raw &lt;- data.frame(read.csv(filename, sep=&quot;\t&quot;, header=T), server=name)
  raw &lt;- data.frame(raw, time=raw$seconds-min(raw$seconds))
  raw &lt;- data.frame(raw, time_s=raw$time/1000000)
  raw
}

#ab.tsPoint &lt;- function (d) {
#  qplot(time_s, ttime, data=d, facets=server~.,
#        geom=&quot;point&quot;, alpha=I(1/15), ylab=&quot;response time (ms)&quot;,
#        xlab=&quot;time (s)&quot;, main=&quot;c=30, res=26kb&quot;, 
#        ylim=c(0,100))
#}
#
#ab.tsLine &lt;- function (d) {
#  qplot(time_s, ttime, data=d, facets=server~.,
#        geom=&quot;line&quot;, ylab=&quot;response time (ms)&quot;,
#        xlab=&quot;time (s)&quot;, main=&quot;c=30, res=26kb&quot;, 
#        ylim=c(0,100))
#}


filename &lt;- args[0:1]
data &lt;- ab.load(filename, &quot;node&quot;)


# histogram

#hist_png_filename &lt;- gsub(&quot;.data&quot;, &quot;_hist.png&quot;, filename)
hist_png_filename &lt;- &quot;hist.png&quot;

png(filename = hist_png_filename, width = 480, height = 380, units = &quot;px&quot;)

qplot(ttime, data=data, geom=&quot;histogram&quot;,
      main=&quot;xxx&quot;,
      binwidth=1, xlab=&quot;response time (ms)&quot;,
      xlim=c(0,100))

print(hist_png_filename)



# time series

#ts_png_filename &lt;- gsub(&quot;.data&quot;, &quot;_ts.png&quot;, filename)
ts_png_filename = &quot;ts.png&quot;

png(filename = ts_png_filename, width = 480, height = 380, units = &quot;px&quot;)

qplot(time, ttime, data=data, facets=server~.,
      geom=&quot;point&quot;, alpha=I(1/15), ylab=&quot;response time (ms)&quot;,
      xlab=&quot;time (s)&quot;, main=&quot;xxx&quot;,
      ylim=c(0,100))

print(ts_png_filename)
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in21_link" href="javascript:jShowHide('in21');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/io.c">/manta/public/examples/node-v0.10.17/benchmark/io.c</a>
<br />
<div id="in21_contents" style="display: none" class="jObjectContents"><pre><code>/**
 * gcc -o iotest io.c
 */

#include &lt;assert.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;assert.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
 
static int c = 0;
static int tsize = 1000 * 1048576;
static const char* path = &quot;/tmp/wt.dat&quot;;
static char buf[65536];

static uint64_t now(void) {
  struct timeval tv;

  if (gettimeofday(&amp;tv, NULL))
    abort();

  return tv.tv_sec * 1000000ULL + tv.tv_usec;
}

static void writetest(int size, size_t bsize)
{
  int i;
  uint64_t start, end;
  double elapsed;
  double mbps;

  assert(bsize &lt;= sizeof buf);

  int fd = open(path, O_CREAT|O_WRONLY, 0644);
  if (fd &lt; 0) {
    perror(&quot;open failed&quot;);
    exit(254);
  }

  start = now();

  for (i = 0; i &lt; size; i += bsize) {
    int rv = write(fd, buf, bsize);
    if (rv &lt; 0) {
      perror(&quot;write failed&quot;);
      exit(254);
    }
  }

#ifndef NSYNC
# ifdef __linux__
  fdatasync(fd);
# else
  fsync(fd);
# endif
#endif /* SYNC */

  close(fd);

  end = now();
  elapsed = (end - start) / 1e6;
  mbps = ((tsize/elapsed)) / 1048576;

  fprintf(stderr, &quot;Wrote %d bytes in %03fs using %ld byte buffers: %03f\n&quot;, size, elapsed, bsize, mbps);
}

void readtest(int size, size_t bsize)
{
  int i;
  uint64_t start, end;
  double elapsed;
  double mbps;

  assert(bsize &lt;= sizeof buf);

  int fd = open(path, O_RDONLY, 0644);
  if (fd &lt; 0) {
    perror(&quot;open failed&quot;);
    exit(254);
  }

  start = now();

  for (i = 0; i &lt; size; i += bsize) {
    int rv = read(fd, buf, bsize);
    if (rv &lt; 0) {
      perror(&quot;write failed&quot;);
      exit(254);
    }
  }
  close(fd);

  end = now();
  elapsed = (end - start) / 1e6;
  mbps = ((tsize/elapsed)) / 1048576;

  fprintf(stderr, &quot;Read %d bytes in %03fs using %ld byte buffers: %03fmB/s\n&quot;, size, elapsed, bsize, mbps);
}

void cleanup() {
  unlink(path);
}

int main(int argc, char** argv)
{
  int i;
  int bsizes[] = {1024, 4096, 8192, 16384, 32768, 65536, 0};

  if (argc &gt; 1) path = argv[1];

  for (i = 0; bsizes[i] != 0; i++) {
    writetest(tsize, bsizes[i]);
  }
  for (i = 0; bsizes[i] != 0; i++) {
    readtest(tsize, bsizes[i]);
  }
  atexit(cleanup);
  return 0;
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in22_link" href="javascript:jShowHide('in22');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/idle_server.js">/manta/public/examples/node-v0.10.17/benchmark/idle_server.js</a>
<br />
<div id="in22_contents" style="display: none" class="jObjectContents"><pre><code>net = require(&#39;net&#39;);
connections = 0;

var errors = 0;

server = net.Server(function (socket) {

  socket.on(&#39;error&#39;, function () {
    errors++; 
  });

});

//server.maxConnections = 128;

server.listen(9000);

var oldConnections, oldErrors;

setInterval(function () {
  if (oldConnections != server.connections) {
    oldConnections = server.connections;
    console.log(&quot;SERVER %d connections: %d&quot;, process.pid, server.connections);
  }

  if (oldErrors != errors) {
    oldErrors = errors;
    console.log(&quot;SERVER %d errors: %d&quot;, process.pid, errors);
  }
}, 1000);

</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in23_link" href="javascript:jShowHide('in23');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/static_http_server.js">/manta/public/examples/node-v0.10.17/benchmark/static_http_server.js</a>
<br />
<div id="in23_contents" style="display: none" class="jObjectContents"><pre><code>var http = require(&#39;http&#39;);

var concurrency = 30;
var port = 12346;
var n = 700;
var bytes = 1024*5;

var requests = 0;
var responses = 0;

var body = &#39;&#39;;
for (var i = 0; i &lt; bytes; i++) {
  body += &#39;C&#39;;
}

var server = http.createServer(function(req, res) {
  res.writeHead(200, {
    &#39;Content-Type&#39;: &#39;text/plain&#39;,
    &#39;Content-Length&#39;: body.length
  });
  res.end(body);
})

server.listen(port, function() {
  var agent = new http.Agent();
  agent.maxSockets = concurrency;

  for (var i = 0; i &lt; n; i++) {
    var req = http.get({
      port:  port,
      path:  &#39;/&#39;,
      agent: agent
    }, function(res) {
      res.resume();
      res.on(&#39;end&#39;, function() {
        if (++responses === n) {
          server.close();
        }
      });
    });
    req.id = i;
    requests++;
  }
});
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in24_link" href="javascript:jShowHide('in24');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/buffers/buffer-creation.js">/manta/public/examples/node-v0.10.17/benchmark/buffers/buffer-creation.js</a>
<br />
<div id="in24_contents" style="display: none" class="jObjectContents"><pre><code>SlowBuffer = require(&#39;buffer&#39;).SlowBuffer;

var common = require(&#39;../common.js&#39;);
var bench = common.createBenchmark(main, {
  type: [&#39;fast&#39;, &#39;slow&#39;],
  len: [10, 1024],
  n: [1024]
});

function main(conf) {
  var len = +conf.len;
  var n = +conf.n;
  var clazz = conf.type === &#39;fast&#39; ? Buffer : SlowBuffer;
  bench.start();
  for (var i = 0; i &lt; n * 1024; i++) {
    b = new clazz(len);
  }
  bench.end(n);
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in25_link" href="javascript:jShowHide('in25');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/buffers/dataview-set.js">/manta/public/examples/node-v0.10.17/benchmark/buffers/dataview-set.js</a>
<br />
<div id="in25_contents" style="display: none" class="jObjectContents"><pre><code>
var common = require(&#39;../common.js&#39;);
var bench = common.createBenchmark(main, {
  type: [&#39;Uint8&#39;, &#39;Uint16LE&#39;, &#39;Uint16BE&#39;,
         &#39;Uint32LE&#39;, &#39;Uint32BE&#39;,
         &#39;Int8&#39;, &#39;Int16LE&#39;, &#39;Int16BE&#39;,
         &#39;Int32LE&#39;, &#39;Int32BE&#39;,
         &#39;Float32LE&#39;, &#39;Float32BE&#39;,
         &#39;Float64LE&#39;, &#39;Float64BE&#39;],
  millions: [1]
});

const INT8   = 0x7f;
const INT16  = 0x7fff;
const INT32  = 0x7fffffff;
const UINT8  = INT8 * 2;
const UINT16 = INT16 * 2;
const UINT32 = INT32 * 2;

var mod = {
  setInt8: INT8,
  setInt16: INT16,
  setInt32: INT32,
  setUint8: UINT8,
  setUint16: UINT16,
  setUint32: UINT32
};

function main(conf) {
  var len = +conf.millions * 1e6;
  var ab = new ArrayBuffer(8);
  var dv = new DataView(ab, 0, 8);
  var le = /LE$/.test(conf.type);
  var fn = &#39;set&#39; + conf.type.replace(/[LB]E$/, &#39;&#39;);

  if (/int/i.test(fn))
    benchInt(dv, fn, len, le);
  else
    benchFloat(dv, fn, len, le);
}

function benchInt(dv, fn, len, le) {
  var m = mod[fn];
  bench.start();
  for (var i = 0; i &lt; len; i++) {
    dv[fn](0, i % m, le);
  }
  bench.end(len / 1e6);
}

function benchFloat(dv, fn, len, le) {
  bench.start();
  for (var i = 0; i &lt; len; i++) {
    dv[fn](0, i * 0.1, le);
  }
  bench.end(len / 1e6);
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in26_link" href="javascript:jShowHide('in26');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/buffers/buffer-base64-encode.js">/manta/public/examples/node-v0.10.17/benchmark/buffers/buffer-base64-encode.js</a>
<br />
<div id="in26_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var common = require(&#39;../common.js&#39;);

var bench = common.createBenchmark(main, {});

function main(conf) {
  var N = 64 * 1024 * 1024;
  var b = Buffer(N);
  var s = &#39;&#39;;
  for (var i = 0; i &lt; 256; ++i) s += String.fromCharCode(i);

  bench.start();
  for (var i = 0; i &lt; N; i += 256) b.write(s, i, 256, &#39;ascii&#39;);
  for (var i = 0; i &lt; 32; ++i) b.toString(&#39;base64&#39;);
  bench.end(64);
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in27_link" href="javascript:jShowHide('in27');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/buffers/buffer-read.js">/manta/public/examples/node-v0.10.17/benchmark/buffers/buffer-read.js</a>
<br />
<div id="in27_contents" style="display: none" class="jObjectContents"><pre><code>var common = require(&#39;../common.js&#39;);

var bench = common.createBenchmark(main, {
  noAssert: [false, true],
  buffer: [&#39;fast&#39;, &#39;slow&#39;],
  type: [&#39;UInt8&#39;, &#39;UInt16LE&#39;, &#39;UInt16BE&#39;,
         &#39;UInt32LE&#39;, &#39;UInt32BE&#39;,
         &#39;Int8&#39;, &#39;Int16LE&#39;, &#39;Int16BE&#39;,
         &#39;Int32LE&#39;, &#39;Int32BE&#39;,
         &#39;FloatLE&#39;, &#39;FloatBE&#39;,
         &#39;DoubleLE&#39;, &#39;DoubleBE&#39;],
  millions: [1]
});

function main(conf) {
  var noAssert = conf.noAssert === &#39;true&#39;;
  var len = +conf.millions * 1e6;
  var clazz = conf.buf === &#39;fast&#39; ? Buffer : require(&#39;buffer&#39;).SlowBuffer;
  var buff = new clazz(8);
  var fn = &#39;read&#39; + conf.type;

  buff.writeDoubleLE(0, 0, noAssert);
  bench.start();
  for (var i = 0; i &lt; len; i++) {
    buff[fn](0, noAssert);
  }
  bench.end(len / 1e6);
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in28_link" href="javascript:jShowHide('in28');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/benchmark/buffers/buffer-write.js">/manta/public/examples/node-v0.10.17/benchmark/buffers/buffer-write.js</a>
<br />
<div id="in28_contents" style="display: none" class="jObjectContents"><pre><code>
var common = require(&#39;../common.js&#39;);
var bench = common.createBenchmark(main, {
  noAssert: [false, true],
  buffer: [&#39;fast&#39;, &#39;slow&#39;],
  type: [&#39;UInt8&#39;, &#39;UInt16LE&#39;, &#39;UInt16BE&#39;,
         &#39;UInt32LE&#39;, &#39;UInt32BE&#39;,
         &#39;Int8&#39;, &#39;Int16LE&#39;, &#39;Int16BE&#39;,
         &#39;Int32LE&#39;, &#39;Int32BE&#39;,
         &#39;FloatLE&#39;, &#39;FloatBE&#39;,
         &#39;DoubleLE&#39;, &#39;DoubleBE&#39;],
  millions: [1]
});

const INT8   = 0x7f;
const INT16  = 0x7fff;
const INT32  = 0x7fffffff;
const UINT8  = INT8 * 2;
const UINT16 = INT16 * 2;
const UINT32 = INT32 * 2;

var mod = {
  writeInt8: INT8,
  writeInt16BE: INT16,
  writeInt16LE: INT16,
  writeInt32BE: INT32,
  writeInt32LE: INT32,
  writeUInt8: UINT8,
  writeUInt16BE: UINT16,
  writeUInt16LE: UINT16,
  writeUInt32BE: UINT32,
  writeUInt32LE: UINT32
};

function main(conf) {
  var noAssert = conf.noAssert === &#39;true&#39;;
  var len = +conf.millions * 1e6;
  var clazz = conf.buf === &#39;fast&#39; ? Buffer : require(&#39;buffer&#39;).SlowBuffer;
  var buff = new clazz(8);
  var fn = &#39;write&#39; + conf.type;

  if (fn.match(/Int/))
    benchInt(buff, fn, len, noAssert);
  else
    benchFloat(buff, fn, len, noAssert);
}

function benchInt(buff, fn, len, noAssert) {
  var m = mod[fn];
  bench.start();
  for (var i = 0; i &lt; len; i++) {
    buff[fn](i % m, 0, noAssert);
  }
  bench.end(len / 1e6);
}

function benchFloat(buff, fn, len, noAssert) {
  bench.start();
  for (var i = 0; i &lt; len; i++) {
    buff[fn](i * 0.1, 0, noAssert);
  }
  bench.end(len / 1e6);
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in29_link" href="javascript:jShowHide('in29');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/_debugger.js">/manta/public/examples/node-v0.10.17/lib/_debugger.js</a>
<br />
<div id="in29_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var util = require(&#39;util&#39;),
    path = require(&#39;path&#39;),
    net = require(&#39;net&#39;),
    vm = require(&#39;vm&#39;),
    repl = require(&#39;repl&#39;),
    inherits = util.inherits,
    spawn = require(&#39;child_process&#39;).spawn;

exports.start = function(argv, stdin, stdout) {
  argv || (argv = process.argv.slice(2));

  if (argv.length &lt; 1) {
    console.error(&#39;Usage: node debug script.js&#39;);
    process.exit(1);
  }

  // Setup input/output streams
  stdin = stdin || process.stdin;
  stdout = stdout || process.stdout;

  var args = [&#39;--debug-brk&#39;].concat(argv),
      interface_ = new Interface(stdin, stdout, args);

  stdin.resume();

  process.on(&#39;uncaughtException&#39;, function(e) {
    console.error(&quot;There was an internal error in Node&#39;s debugger. &quot; +
        &#39;Please report this bug.&#39;);
    console.error(e.message);
    console.error(e.stack);
    if (interface_.child) interface_.child.kill();
    process.exit(1);
  });
};

exports.port = 5858;


//
// Parser/Serializer for V8 debugger protocol
// http://code.google.com/p/v8/wiki/DebuggerProtocol
//
// Usage:
//    p = new Protocol();
//
//    p.onResponse = function(res) {
//      // do stuff with response from V8
//    };
//
//    socket.setEncoding(&#39;utf8&#39;);
//    socket.on(&#39;data&#39;, function(s) {
//      // Pass strings into the protocol
//      p.execute(s);
//    });
//
//
function Protocol() {
  this._newRes();
}
exports.Protocol = Protocol;


Protocol.prototype._newRes = function(raw) {
  this.res = { raw: raw || &#39;&#39;, headers: {} };
  this.state = &#39;headers&#39;;
  this.reqSeq = 1;
  this.execute(&#39;&#39;);
};


Protocol.prototype.execute = function(d) {
  var res = this.res;
  res.raw += d;

  switch (this.state) {
    case &#39;headers&#39;:
      var endHeaderIndex = res.raw.indexOf(&#39;\r\n\r\n&#39;);

      if (endHeaderIndex &lt; 0) break;

      var rawHeader = res.raw.slice(0, endHeaderIndex);
      var endHeaderByteIndex = Buffer.byteLength(rawHeader, &#39;utf8&#39;);
      var lines = rawHeader.split(&#39;\r\n&#39;);
      for (var i = 0; i &lt; lines.length; i++) {
        var kv = lines[i].split(/: +/);
        res.headers[kv[0]] = kv[1];
      }

      this.contentLength = +res.headers[&#39;Content-Length&#39;];
      this.bodyStartByteIndex = endHeaderByteIndex + 4;

      this.state = &#39;body&#39;;

      var len = Buffer.byteLength(res.raw, &#39;utf8&#39;);
      if (len - this.bodyStartByteIndex &lt; this.contentLength) {
        break;
      }
      // pass thru
    case &#39;body&#39;:
      var resRawByteLength = Buffer.byteLength(res.raw, &#39;utf8&#39;);

      if (resRawByteLength - this.bodyStartByteIndex &gt;= this.contentLength) {
        var buf = new Buffer(resRawByteLength);
        buf.write(res.raw, 0, resRawByteLength, &#39;utf8&#39;);
        res.body =
            buf.slice(this.bodyStartByteIndex,
                      this.bodyStartByteIndex +
                      this.contentLength).toString(&#39;utf8&#39;);
        // JSON parse body?
        res.body = res.body.length ? JSON.parse(res.body) : {};

        // Done!
        this.onResponse(res);

        this._newRes(buf.slice(this.bodyStartByteIndex +
                               this.contentLength).toString(&#39;utf8&#39;));
      }
      break;

    default:
      throw new Error(&#39;Unknown state&#39;);
      break;
  }
};


Protocol.prototype.serialize = function(req) {
  req.type = &#39;request&#39;;
  req.seq = this.reqSeq++;
  var json = JSON.stringify(req);
  return &#39;Content-Length: &#39; + Buffer.byteLength(json, &#39;utf8&#39;) +
         &#39;\r\n\r\n&#39; + json;
};


var NO_FRAME = -1;

function Client() {
  net.Stream.call(this);
  var protocol = this.protocol = new Protocol(this);
  this._reqCallbacks = [];
  var socket = this;

  this.currentFrame = NO_FRAME;
  this.currentSourceLine = -1;
  this.currentSource = null;
  this.handles = {};
  this.scripts = {};
  this.breakpoints = [];

  // Note that &#39;Protocol&#39; requires strings instead of Buffers.
  socket.setEncoding(&#39;utf8&#39;);
  socket.on(&#39;data&#39;, function(d) {
    protocol.execute(d);
  });

  protocol.onResponse = this._onResponse.bind(this);
}
inherits(Client, net.Stream);
exports.Client = Client;


Client.prototype._addHandle = function(desc) {
  if (typeof desc != &#39;object&#39; || typeof desc.handle != &#39;number&#39;) {
    return;
  }

  this.handles[desc.handle] = desc;

  if (desc.type == &#39;script&#39;) {
    this._addScript(desc);
  }
};


var natives = process.binding(&#39;natives&#39;);


Client.prototype._addScript = function(desc) {
  this.scripts[desc.id] = desc;
  if (desc.name) {
    desc.isNative = (desc.name.replace(&#39;.js&#39;, &#39;&#39;) in natives) ||
                    desc.name == &#39;node.js&#39;;
  }
};


Client.prototype._removeScript = function(desc) {
  this.scripts[desc.id] = undefined;
};


Client.prototype._onResponse = function(res) {
  var cb,
      index = -1;

  this._reqCallbacks.some(function(fn, i) {
    if (fn.request_seq == res.body.request_seq) {
      cb = fn;
      index = i;
      return true;
    }
  });

  var self = this;
  var handled = false;

  if (res.headers.Type == &#39;connect&#39;) {
    // Request a list of scripts for our own storage.
    self.reqScripts();
    self.emit(&#39;ready&#39;);
    handled = true;

  } else if (res.body &amp;&amp; res.body.event == &#39;break&#39;) {
    this.emit(&#39;break&#39;, res.body);
    handled = true;

  } else if (res.body &amp;&amp; res.body.event == &#39;exception&#39;) {
    this.emit(&#39;exception&#39;, res.body);
    handled = true;

  } else if (res.body &amp;&amp; res.body.event == &#39;afterCompile&#39;) {
    this._addHandle(res.body.body.script);
    handled = true;

  } else if (res.body &amp;&amp; res.body.event == &#39;scriptCollected&#39;) {
    // ???
    this._removeScript(res.body.body.script);
    handled = true;

  }

  if (cb) {
    this._reqCallbacks.splice(index, 1);
    handled = true;

    var err = res.success === false &amp;&amp; (res.message || true) ||
              res.body.success === false &amp;&amp; (res.body.message || true);
    cb(err, res.body &amp;&amp; res.body.body || res.body, res);
  }

  if (!handled) this.emit(&#39;unhandledResponse&#39;, res.body);
};


Client.prototype.req = function(req, cb) {
  this.write(this.protocol.serialize(req));
  cb.request_seq = req.seq;
  this._reqCallbacks.push(cb);
};


Client.prototype.reqVersion = function(cb) {
  cb = cb || function() {};
  this.req({ command: &#39;version&#39; } , function(err, body, res) {
    if (err) return cb(err);
    cb(null, res.body.body.V8Version, res.body.running);
  });
};


Client.prototype.reqLookup = function(refs, cb) {
  var self = this;

  // TODO: We have a cache of handle&#39;s we&#39;ve already seen in this.handles
  // This can be used if we&#39;re careful.
  var req = {
    command: &#39;lookup&#39;,
    arguments: {
      handles: refs
    }
  };

  cb = cb || function() {};
  this.req(req, function(err, res) {
    if (err) return cb(err);
    for (var ref in res) {
      if (typeof res[ref] == &#39;object&#39;) {
        self._addHandle(res[ref]);
      }
    }

    cb(null, res);
  });
};

Client.prototype.reqScopes = function(cb) {
  var self = this,
      req = {
        command: &#39;scopes&#39;,
        arguments: {}
      };

  cb = cb || function() {};
  this.req(req, function(err, res) {
    if (err) return cb(err);
    var refs = res.scopes.map(function(scope) {
      return scope.object.ref;
    });

    self.reqLookup(refs, function(err, res) {
      if (err) return cb(err);

      var globals = Object.keys(res).map(function(key) {
        return res[key].properties.map(function(prop) {
          return prop.name;
        });
      });

      cb(null, globals.reverse());
    });
  });
};

// This is like reqEval, except it will look up the expression in each of the
// scopes associated with the current frame.
Client.prototype.reqEval = function(expression, cb) {
  var self = this;

  if (this.currentFrame == NO_FRAME) {
    // Only need to eval in global scope.
    this.reqFrameEval(expression, NO_FRAME, cb);
    return;
  }

  cb = cb || function() {};
  // Otherwise we need to get the current frame to see which scopes it has.
  this.reqBacktrace(function(err, bt) {
    if (err || !bt.frames) {
      // ??
      return cb(null, {});
    }

    var frame = bt.frames[self.currentFrame];

    var evalFrames = frame.scopes.map(function(s) {
      if (!s) return;
      var x = bt.frames[s.index];
      if (!x) return;
      return x.index;
    });

    self._reqFramesEval(expression, evalFrames, cb);
  });
};


// Finds the first scope in the array in which the epxression evals.
Client.prototype._reqFramesEval = function(expression, evalFrames, cb) {
  if (evalFrames.length == 0) {
    // Just eval in global scope.
    this.reqFrameEval(expression, NO_FRAME, cb);
    return;
  }

  var self = this;
  var i = evalFrames.shift();

  cb = cb || function() {};
  this.reqFrameEval(expression, i, function(err, res) {
    if (!err) return cb(null, res);
    self._reqFramesEval(expression, evalFrames, cb);
  });
};


Client.prototype.reqFrameEval = function(expression, frame, cb) {
  var self = this;
  var req = {
    command: &#39;evaluate&#39;,
    arguments: { expression: expression }
  };

  if (frame == NO_FRAME) {
    req.arguments.global = true;
  } else {
    req.arguments.frame = frame;
  }

  cb = cb || function() {};
  this.req(req, function(err, res) {
    if (!err) self._addHandle(res);</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in30_link" href="javascript:jShowHide('in30');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/_linklist.js">/manta/public/examples/node-v0.10.17/lib/_linklist.js</a>
<br />
<div id="in30_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

function init(list) {
  list._idleNext = list;
  list._idlePrev = list;
}
exports.init = init;


// show the most idle item
function peek(list) {
  if (list._idlePrev == list) return null;
  return list._idlePrev;
}
exports.peek = peek;


// remove the most idle item from the list
function shift(list) {
  var first = list._idlePrev;
  remove(first);
  return first;
}
exports.shift = shift;


// remove a item from its list
function remove(item) {
  if (item._idleNext) {
    item._idleNext._idlePrev = item._idlePrev;
  }

  if (item._idlePrev) {
    item._idlePrev._idleNext = item._idleNext;
  }

  item._idleNext = null;
  item._idlePrev = null;
}
exports.remove = remove;


// remove a item from its list and place at the end.
function append(list, item) {
  remove(item);
  item._idleNext = list._idleNext;
  list._idleNext._idlePrev = item;
  item._idlePrev = list;
  list._idleNext = item;
}
exports.append = append;


function isEmpty(list) {
  return list._idleNext === list;
}
exports.isEmpty = isEmpty;
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in31_link" href="javascript:jShowHide('in31');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/_stream_transform.js">/manta/public/examples/node-v0.10.17/lib/_stream_transform.js</a>
<br />
<div id="in31_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.


// a transform stream is a readable/writable stream where you do
// something with the data.  Sometimes it&#39;s called a &quot;filter&quot;,
// but that&#39;s not a great name for it, since that implies a thing where
// some bits pass through, and others are simply ignored.  (That would
// be a valid example of a transform, of course.)
//
// While the output is causally related to the input, it&#39;s not a
// necessarily symmetric or synchronous transformation.  For example,
// a zlib stream might take multiple plain-text writes(), and then
// emit a single compressed chunk some time in the future.
//
// Here&#39;s how this works:
//
// The Transform stream has all the aspects of the readable and writable
// stream classes.  When you write(chunk), that calls _write(chunk,cb)
// internally, and returns false if there&#39;s a lot of pending writes
// buffered up.  When you call read(), that calls _read(n) until
// there&#39;s enough pending readable data buffered up.
//
// In a transform stream, the written data is placed in a buffer.  When
// _read(n) is called, it transforms the queued up data, calling the
// buffered _write cb&#39;s as it consumes chunks.  If consuming a single
// written chunk would result in multiple output chunks, then the first
// outputted bit calls the readcb, and subsequent chunks just go into
// the read buffer, and will cause it to emit &#39;readable&#39; if necessary.
//
// This way, back-pressure is actually determined by the reading side,
// since _read has to be called to start processing a new chunk.  However,
// a pathological inflate type of transform can cause excessive buffering
// here.  For example, imagine a stream where every byte of input is
// interpreted as an integer from 0-255, and then results in that many
// bytes of output.  Writing the 4 bytes {ff,ff,ff,ff} would result in
// 1kb of data being output.  In this case, you could write a very small
// amount of input, and end up with a very large amount of output.  In
// such a pathological inflating mechanism, there&#39;d be no way to tell
// the system to stop doing the transform.  A single 4MB write could
// cause the system to run out of memory.
//
// However, even in such a pathological case, only a single written chunk
// would be consumed, and then the rest would wait (un-transformed) until
// the results of the previous transformed chunk were consumed.

module.exports = Transform;

var Duplex = require(&#39;_stream_duplex&#39;);
var util = require(&#39;util&#39;);
util.inherits(Transform, Duplex);


function TransformState(options, stream) {
  this.afterTransform = function(er, data) {
    return afterTransform(stream, er, data);
  };

  this.needTransform = false;
  this.transforming = false;
  this.writecb = null;
  this.writechunk = null;
}

function afterTransform(stream, er, data) {
  var ts = stream._transformState;
  ts.transforming = false;

  var cb = ts.writecb;

  if (!cb)
    return stream.emit(&#39;error&#39;, new Error(&#39;no writecb in Transform class&#39;));

  ts.writechunk = null;
  ts.writecb = null;

  if (data !== null &amp;&amp; data !== undefined)
    stream.push(data);

  if (cb)
    cb(er);

  var rs = stream._readableState;
  rs.reading = false;
  if (rs.needReadable || rs.length &lt; rs.highWaterMark) {
    stream._read(rs.highWaterMark);
  }
}


function Transform(options) {
  if (!(this instanceof Transform))
    return new Transform(options);

  Duplex.call(this, options);

  var ts = this._transformState = new TransformState(options, this);

  // when the writable side finishes, then flush out anything remaining.
  var stream = this;

  // start out asking for a readable event once data is transformed.
  this._readableState.needReadable = true;

  // we have implemented the _read method, and done the other things
  // that Readable wants before the first _read call, so unset the
  // sync guard flag.
  this._readableState.sync = false;

  this.once(&#39;finish&#39;, function() {
    if (&#39;function&#39; === typeof this._flush)
      this._flush(function(er) {
        done(stream, er);
      });
    else
      done(stream);
  });
}

Transform.prototype.push = function(chunk, encoding) {
  this._transformState.needTransform = false;
  return Duplex.prototype.push.call(this, chunk, encoding);
};

// This is the part where you do stuff!
// override this function in implementation classes.
// &#39;chunk&#39; is an input chunk.
//
// Call `push(newChunk)` to pass along transformed output
// to the readable side.  You may call &#39;push&#39; zero or more times.
//
// Call `cb(err)` when you are done with this chunk.  If you pass
// an error, then that&#39;ll put the hurt on the whole operation.  If you
// never call cb(), then you&#39;ll never get another chunk.
Transform.prototype._transform = function(chunk, encoding, cb) {
  throw new Error(&#39;not implemented&#39;);
};

Transform.prototype._write = function(chunk, encoding, cb) {
  var ts = this._transformState;
  ts.writecb = cb;
  ts.writechunk = chunk;
  ts.writeencoding = encoding;
  if (!ts.transforming) {
    var rs = this._readableState;
    if (ts.needTransform ||
        rs.needReadable ||
        rs.length &lt; rs.highWaterMark)
      this._read(rs.highWaterMark);
  }
};

// Doesn&#39;t matter what the args are here.
// _transform does all the work.
// That we got here means that the readable side wants more data.
Transform.prototype._read = function(n) {
  var ts = this._transformState;

  if (ts.writechunk &amp;&amp; ts.writecb &amp;&amp; !ts.transforming) {
    ts.transforming = true;
    this._transform(ts.writechunk, ts.writeencoding, ts.afterTransform);
  } else {
    // mark that we need a transform, so that any data that comes in
    // will get processed, now that we&#39;ve asked for it.
    ts.needTransform = true;
  }
};


function done(stream, er) {
  if (er)
    return stream.emit(&#39;error&#39;, er);

  // if there&#39;s nothing in the write buffer, then that means
  // that nothing more will ever be provided
  var ws = stream._writableState;
  var rs = stream._readableState;
  var ts = stream._transformState;

  if (ws.length)
    throw new Error(&#39;calling transform done when ws.length != 0&#39;);

  if (ts.transforming)
    throw new Error(&#39;calling transform done when still transforming&#39;);

  return stream.push(null);
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in32_link" href="javascript:jShowHide('in32');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/_stream_readable.js">/manta/public/examples/node-v0.10.17/lib/_stream_readable.js</a>
<br />
<div id="in32_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

module.exports = Readable;
Readable.ReadableState = ReadableState;

var EE = require(&#39;events&#39;).EventEmitter;
var Stream = require(&#39;stream&#39;);
var util = require(&#39;util&#39;);
var StringDecoder;

util.inherits(Readable, Stream);

function ReadableState(options, stream) {
  options = options || {};

  // the point at which it stops calling _read() to fill the buffer
  // Note: 0 is a valid value, means &quot;don&#39;t call _read preemptively ever&quot;
  var hwm = options.highWaterMark;
  this.highWaterMark = (hwm || hwm === 0) ? hwm : 16 * 1024;

  // cast to ints.
  this.highWaterMark = ~~this.highWaterMark;

  this.buffer = [];
  this.length = 0;
  this.pipes = null;
  this.pipesCount = 0;
  this.flowing = false;
  this.ended = false;
  this.endEmitted = false;
  this.reading = false;

  // In streams that never have any data, and do push(null) right away,
  // the consumer can miss the &#39;end&#39; event if they do some I/O before
  // consuming the stream.  So, we don&#39;t emit(&#39;end&#39;) until some reading
  // happens.
  this.calledRead = false;

  // a flag to be able to tell if the onwrite cb is called immediately,
  // or on a later tick.  We set this to true at first, becuase any
  // actions that shouldn&#39;t happen until &quot;later&quot; should generally also
  // not happen before the first write call.
  this.sync = true;

  // whenever we return null, then we set a flag to say
  // that we&#39;re awaiting a &#39;readable&#39; event emission.
  this.needReadable = false;
  this.emittedReadable = false;
  this.readableListening = false;


  // object stream flag. Used to make read(n) ignore n and to
  // make all the buffer merging and length checks go away
  this.objectMode = !!options.objectMode;

  // Crypto is kind of old and crusty.  Historically, its default string
  // encoding is &#39;binary&#39; so we have to make this configurable.
  // Everything else in the universe uses &#39;utf8&#39;, though.
  this.defaultEncoding = options.defaultEncoding || &#39;utf8&#39;;

  // when piping, we only care about &#39;readable&#39; events that happen
  // after read()ing all the bytes and not getting any pushback.
  this.ranOut = false;

  // the number of writers that are awaiting a drain event in .pipe()s
  this.awaitDrain = 0;

  // if true, a maybeReadMore has been scheduled
  this.readingMore = false;

  this.decoder = null;
  this.encoding = null;
  if (options.encoding) {
    if (!StringDecoder)
      StringDecoder = require(&#39;string_decoder&#39;).StringDecoder;
    this.decoder = new StringDecoder(options.encoding);
    this.encoding = options.encoding;
  }
}

function Readable(options) {
  if (!(this instanceof Readable))
    return new Readable(options);

  this._readableState = new ReadableState(options, this);

  // legacy
  this.readable = true;

  Stream.call(this);
}

// Manually shove something into the read() buffer.
// This returns true if the highWaterMark has not been hit yet,
// similar to how Writable.write() returns true if you should
// write() some more.
Readable.prototype.push = function(chunk, encoding) {
  var state = this._readableState;

  if (typeof chunk === &#39;string&#39; &amp;&amp; !state.objectMode) {
    encoding = encoding || state.defaultEncoding;
    if (encoding !== state.encoding) {
      chunk = new Buffer(chunk, encoding);
      encoding = &#39;&#39;;
    }
  }

  return readableAddChunk(this, state, chunk, encoding, false);
};

// Unshift should *always* be something directly out of read()
Readable.prototype.unshift = function(chunk) {
  var state = this._readableState;
  return readableAddChunk(this, state, chunk, &#39;&#39;, true);
};

function readableAddChunk(stream, state, chunk, encoding, addToFront) {
  var er = chunkInvalid(state, chunk);
  if (er) {
    stream.emit(&#39;error&#39;, er);
  } else if (chunk === null || chunk === undefined) {
    state.reading = false;
    if (!state.ended)
      onEofChunk(stream, state);
  } else if (state.objectMode || chunk &amp;&amp; chunk.length &gt; 0) {
    if (state.ended &amp;&amp; !addToFront) {
      var e = new Error(&#39;stream.push() after EOF&#39;);
      stream.emit(&#39;error&#39;, e);
    } else if (state.endEmitted &amp;&amp; addToFront) {
      var e = new Error(&#39;stream.unshift() after end event&#39;);
      stream.emit(&#39;error&#39;, e);
    } else {
      if (state.decoder &amp;&amp; !addToFront &amp;&amp; !encoding)
        chunk = state.decoder.write(chunk);

      // update the buffer info.
      state.length += state.objectMode ? 1 : chunk.length;
      if (addToFront) {
        state.buffer.unshift(chunk);
      } else {
        state.reading = false;
        state.buffer.push(chunk);
      }

      if (state.needReadable)
        emitReadable(stream);

      maybeReadMore(stream, state);
    }
  } else if (!addToFront) {
    state.reading = false;
  }

  return needMoreData(state);
}



// if it&#39;s past the high water mark, we can push in some more.
// Also, if we have no data yet, we can stand some
// more bytes.  This is to work around cases where hwm=0,
// such as the repl.  Also, if the push() triggered a
// readable event, and the user called read(largeNumber) such that
// needReadable was set, then we ought to push more, so that another
// &#39;readable&#39; event will be triggered.
function needMoreData(state) {
  return !state.ended &amp;&amp;
         (state.needReadable ||
          state.length &lt; state.highWaterMark ||
          state.length === 0);
}

// backwards compatibility.
Readable.prototype.setEncoding = function(enc) {
  if (!StringDecoder)
    StringDecoder = require(&#39;string_decoder&#39;).StringDecoder;
  this._readableState.decoder = new StringDecoder(enc);
  this._readableState.encoding = enc;
};

// Don&#39;t raise the hwm &gt; 128MB
var MAX_HWM = 0x800000;
function roundUpToNextPowerOf2(n) {
  if (n &gt;= MAX_HWM) {
    n = MAX_HWM;
  } else {
    // Get the next highest power of 2
    n--;
    for (var p = 1; p &lt; 32; p &lt;&lt;= 1) n |= n &gt;&gt; p;
    n++;
  }
  return n;
}

function howMuchToRead(n, state) {
  if (state.length === 0 &amp;&amp; state.ended)
    return 0;

  if (state.objectMode)
    return n === 0 ? 0 : 1;

  if (isNaN(n) || n === null) {
    // only flow one buffer at a time
    if (state.flowing &amp;&amp; state.buffer.length)
      return state.buffer[0].length;
    else
      return state.length;
  }

  if (n &lt;= 0)
    return 0;

  // If we&#39;re asking for more than the target buffer level,
  // then raise the water mark.  Bump up to the next highest
  // power of 2, to prevent increasing it excessively in tiny
  // amounts.
  if (n &gt; state.highWaterMark)
    state.highWaterMark = roundUpToNextPowerOf2(n);

  // don&#39;t have that much.  return null, unless we&#39;ve ended.
  if (n &gt; state.length) {
    if (!state.ended) {
      state.needReadable = true;
      return 0;
    } else
      return state.length;
  }

  return n;
}

// you can override either this method, or the async _read(n) below.
Readable.prototype.read = function(n) {
  var state = this._readableState;
  state.calledRead = true;
  var nOrig = n;

  if (typeof n !== &#39;number&#39; || n &gt; 0)
    state.emittedReadable = false;

  // if we&#39;re doing read(0) to trigger a readable event, but we
  // already have a bunch of data in the buffer, then just trigger
  // the &#39;readable&#39; event and move on.
  if (n === 0 &amp;&amp;
      state.needReadable &amp;&amp;
      (state.length &gt;= state.highWaterMark || state.ended)) {
    emitReadable(this);
    return null;
  }

  n = howMuchToRead(n, state);

  // if we&#39;ve ended, and we&#39;re now clear, then finish it up.
  if (n === 0 &amp;&amp; state.ended) {
    if (state.length === 0)
      endReadable(this);
    return null;
  }

  // All the actual chunk generation logic needs to be
  // *below* the call to _read.  The reason is that in certain
  // synthetic stream cases, such as passthrough streams, _read
  // may be a completely synchronous operation which may change
  // the state of the read buffer, providing enough data when
  // before there was *not* enough.
  //
  // So, the steps are:
  // 1. Figure out what the state of things will be after we do
  // a read from the buffer.
  //
  // 2. If that resulting state will trigger a _read, then call _read.
  // Note that this may be asynchronous, or synchronous.  Yes, it is
  // deeply ugly to write APIs this way, but that still doesn&#39;t mean
  // that the Readable class should behave improperly, as streams are
  // designed to be sync/async agnostic.
  // Take note if the _read call is sync or async (ie, if the read call
  // has returned yet), so that we know whether or not it&#39;s safe to emit
  // &#39;readable&#39; etc.
  //
  // 3. Actually pull the requested chunks out of the buffer and return.

  // if we need a readable event, then we need to do some reading.
  var doRead = state.needReadable;

  // if we currently have less than the highWaterMark, then also read some
  if (state.length - n &lt;= state.highWaterMark)
    doRead = true;

  // however, if we&#39;ve ended, then there&#39;s no point, and if we&#39;re already
  // reading, then it&#39;s unnecessary.
  if (state.ended || state.reading)
    doRead = false;

  if (doRead) {
    state.reading = true;
    state.sync = true;
    // if the length is currently zero, then we *need* a readable event.
    if (state.length === 0)
      state.needReadable = true;
    // call inte</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in33_link" href="javascript:jShowHide('in33');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/_stream_passthrough.js">/manta/public/examples/node-v0.10.17/lib/_stream_passthrough.js</a>
<br />
<div id="in33_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

// a passthrough stream.
// basically just the most minimal sort of Transform stream.
// Every written chunk gets output as-is.

module.exports = PassThrough;

var Transform = require(&#39;_stream_transform&#39;);
var util = require(&#39;util&#39;);
util.inherits(PassThrough, Transform);

function PassThrough(options) {
  if (!(this instanceof PassThrough))
    return new PassThrough(options);

  Transform.call(this, options);
}

PassThrough.prototype._transform = function(chunk, encoding, cb) {
  cb(null, chunk);
};
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in34_link" href="javascript:jShowHide('in34');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/_stream_duplex.js">/manta/public/examples/node-v0.10.17/lib/_stream_duplex.js</a>
<br />
<div id="in34_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

// a duplex stream is just a stream that is both readable and writable.
// Since JS doesn&#39;t have multiple prototypal inheritance, this class
// prototypally inherits from Readable, and then parasitically from
// Writable.

module.exports = Duplex;
var util = require(&#39;util&#39;);
var Readable = require(&#39;_stream_readable&#39;);
var Writable = require(&#39;_stream_writable&#39;);

util.inherits(Duplex, Readable);

Object.keys(Writable.prototype).forEach(function(method) {
  if (!Duplex.prototype[method])
    Duplex.prototype[method] = Writable.prototype[method];
});

function Duplex(options) {
  if (!(this instanceof Duplex))
    return new Duplex(options);

  Readable.call(this, options);
  Writable.call(this, options);

  if (options &amp;&amp; options.readable === false)
    this.readable = false;

  if (options &amp;&amp; options.writable === false)
    this.writable = false;

  this.allowHalfOpen = true;
  if (options &amp;&amp; options.allowHalfOpen === false)
    this.allowHalfOpen = false;

  this.once(&#39;end&#39;, onend);
}

// the no-half-open enforcer
function onend() {
  // if we allow half-open state, or if the writable side ended,
  // then we&#39;re ok.
  if (this.allowHalfOpen || this._writableState.ended)
    return;

  // no more data can be written.
  // But allow more writes to happen in this tick.
  process.nextTick(this.end.bind(this));
}
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in35_link" href="javascript:jShowHide('in35');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/_stream_writable.js">/manta/public/examples/node-v0.10.17/lib/_stream_writable.js</a>
<br />
<div id="in35_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

// A bit simpler than readable streams.
// Implement an async ._write(chunk, cb), and it&#39;ll handle all
// the drain event emission and buffering.

module.exports = Writable;
Writable.WritableState = WritableState;

var util = require(&#39;util&#39;);
var assert = require(&#39;assert&#39;);
var Stream = require(&#39;stream&#39;);

util.inherits(Writable, Stream);

function WriteReq(chunk, encoding, cb) {
  this.chunk = chunk;
  this.encoding = encoding;
  this.callback = cb;
}

function WritableState(options, stream) {
  options = options || {};

  // the point at which write() starts returning false
  // Note: 0 is a valid value, means that we always return false if
  // the entire buffer is not flushed immediately on write()
  var hwm = options.highWaterMark;
  this.highWaterMark = (hwm || hwm === 0) ? hwm : 16 * 1024;

  // object stream flag to indicate whether or not this stream
  // contains buffers or objects.
  this.objectMode = !!options.objectMode;

  // cast to ints.
  this.highWaterMark = ~~this.highWaterMark;

  this.needDrain = false;
  // at the start of calling end()
  this.ending = false;
  // when end() has been called, and returned
  this.ended = false;
  // when &#39;finish&#39; is emitted
  this.finished = false;

  // should we decode strings into buffers before passing to _write?
  // this is here so that some node-core streams can optimize string
  // handling at a lower level.
  var noDecode = options.decodeStrings === false;
  this.decodeStrings = !noDecode;

  // Crypto is kind of old and crusty.  Historically, its default string
  // encoding is &#39;binary&#39; so we have to make this configurable.
  // Everything else in the universe uses &#39;utf8&#39;, though.
  this.defaultEncoding = options.defaultEncoding || &#39;utf8&#39;;

  // not an actual buffer we keep track of, but a measurement
  // of how much we&#39;re waiting to get pushed to some underlying
  // socket or file.
  this.length = 0;

  // a flag to see when we&#39;re in the middle of a write.
  this.writing = false;

  // a flag to be able to tell if the onwrite cb is called immediately,
  // or on a later tick.  We set this to true at first, becuase any
  // actions that shouldn&#39;t happen until &quot;later&quot; should generally also
  // not happen before the first write call.
  this.sync = true;

  // a flag to know if we&#39;re processing previously buffered items, which
  // may call the _write() callback in the same tick, so that we don&#39;t
  // end up in an overlapped onwrite situation.
  this.bufferProcessing = false;

  // the callback that&#39;s passed to _write(chunk,cb)
  this.onwrite = function(er) {
    onwrite(stream, er);
  };

  // the callback that the user supplies to write(chunk,encoding,cb)
  this.writecb = null;

  // the amount that is being written when _write is called.
  this.writelen = 0;

  this.buffer = [];
}

function Writable(options) {
  // Writable ctor is applied to Duplexes, though they&#39;re not
  // instanceof Writable, they&#39;re instanceof Readable.
  if (!(this instanceof Writable) &amp;&amp; !(this instanceof Stream.Duplex))
    return new Writable(options);

  this._writableState = new WritableState(options, this);

  // legacy.
  this.writable = true;

  Stream.call(this);
}

// Otherwise people can pipe Writable streams, which is just wrong.
Writable.prototype.pipe = function() {
  this.emit(&#39;error&#39;, new Error(&#39;Cannot pipe. Not readable.&#39;));
};


function writeAfterEnd(stream, state, cb) {
  var er = new Error(&#39;write after end&#39;);
  // TODO: defer error events consistently everywhere, not just the cb
  stream.emit(&#39;error&#39;, er);
  process.nextTick(function() {
    cb(er);
  });
}

// If we get something that is not a buffer, string, null, or undefined,
// and we&#39;re not in objectMode, then that&#39;s an error.
// Otherwise stream chunks are all considered to be of length=1, and the
// watermarks determine how many objects to keep in the buffer, rather than
// how many bytes or characters.
function validChunk(stream, state, chunk, cb) {
  var valid = true;
  if (!Buffer.isBuffer(chunk) &amp;&amp;
      &#39;string&#39; !== typeof chunk &amp;&amp;
      chunk !== null &amp;&amp;
      chunk !== undefined &amp;&amp;
      !state.objectMode) {
    var er = new TypeError(&#39;Invalid non-string/buffer chunk&#39;);
    stream.emit(&#39;error&#39;, er);
    process.nextTick(function() {
      cb(er);
    });
    valid = false;
  }
  return valid;
}

Writable.prototype.write = function(chunk, encoding, cb) {
  var state = this._writableState;
  var ret = false;

  if (typeof encoding === &#39;function&#39;) {
    cb = encoding;
    encoding = null;
  }

  if (Buffer.isBuffer(chunk))
    encoding = &#39;buffer&#39;;
  else if (!encoding)
    encoding = state.defaultEncoding;

  if (typeof cb !== &#39;function&#39;)
    cb = function() {};

  if (state.ended)
    writeAfterEnd(this, state, cb);
  else if (validChunk(this, state, chunk, cb))
    ret = writeOrBuffer(this, state, chunk, encoding, cb);

  return ret;
};

function decodeChunk(state, chunk, encoding) {
  if (!state.objectMode &amp;&amp;
      state.decodeStrings !== false &amp;&amp;
      typeof chunk === &#39;string&#39;) {
    chunk = new Buffer(chunk, encoding);
  }
  return chunk;
}

// if we&#39;re already writing something, then just put this
// in the queue, and wait our turn.  Otherwise, call _write
// If we return false, then we need a drain event, so set that flag.
function writeOrBuffer(stream, state, chunk, encoding, cb) {
  chunk = decodeChunk(state, chunk, encoding);
  var len = state.objectMode ? 1 : chunk.length;

  state.length += len;

  var ret = state.length &lt; state.highWaterMark;
  state.needDrain = !ret;

  if (state.writing)
    state.buffer.push(new WriteReq(chunk, encoding, cb));
  else
    doWrite(stream, state, len, chunk, encoding, cb);

  return ret;
}

function doWrite(stream, state, len, chunk, encoding, cb) {
  state.writelen = len;
  state.writecb = cb;
  state.writing = true;
  state.sync = true;
  stream._write(chunk, encoding, state.onwrite);
  state.sync = false;
}

function onwriteError(stream, state, sync, er, cb) {
  if (sync)
    process.nextTick(function() {
      cb(er);
    });
  else
    cb(er);

  stream.emit(&#39;error&#39;, er);
}

function onwriteStateUpdate(state) {
  state.writing = false;
  state.writecb = null;
  state.length -= state.writelen;
  state.writelen = 0;
}

function onwrite(stream, er) {
  var state = stream._writableState;
  var sync = state.sync;
  var cb = state.writecb;

  onwriteStateUpdate(state);

  if (er)
    onwriteError(stream, state, sync, er, cb);
  else {
    // Check if we&#39;re actually ready to finish, but don&#39;t emit yet
    var finished = needFinish(stream, state);

    if (!finished &amp;&amp; !state.bufferProcessing &amp;&amp; state.buffer.length)
      clearBuffer(stream, state);

    if (sync) {
      process.nextTick(function() {
        afterWrite(stream, state, finished, cb);
      });
    } else {
      afterWrite(stream, state, finished, cb);
    }
  }
}

function afterWrite(stream, state, finished, cb) {
  if (!finished)
    onwriteDrain(stream, state);
  cb();
  if (finished)
    finishMaybe(stream, state);
}

// Must force callback to be called on nextTick, so that we don&#39;t
// emit &#39;drain&#39; before the write() consumer gets the &#39;false&#39; return
// value, and has a chance to attach a &#39;drain&#39; listener.
function onwriteDrain(stream, state) {
  if (state.length === 0 &amp;&amp; state.needDrain) {
    state.needDrain = false;
    stream.emit(&#39;drain&#39;);
  }
}


// if there&#39;s something in the buffer waiting, then process it
function clearBuffer(stream, state) {
  state.bufferProcessing = true;

  for (var c = 0; c &lt; state.buffer.length; c++) {
    var entry = state.buffer[c];
    var chunk = entry.chunk;
    var encoding = entry.encoding;
    var cb = entry.callback;
    var len = state.objectMode ? 1 : chunk.length;

    doWrite(stream, state, len, chunk, encoding, cb);

    // if we didn&#39;t call the onwrite immediately, then
    // it means that we need to wait until it does.
    // also, that means that the chunk and cb are currently
    // being processed, so move the buffer counter past them.
    if (state.writing) {
      c++;
      break;
    }
  }

  state.bufferProcessing = false;
  if (c &lt; state.buffer.length)
    state.buffer = state.buffer.slice(c);
  else
    state.buffer.length = 0;
}

Writable.prototype._write = function(chunk, encoding, cb) {
  cb(new Error(&#39;not implemented&#39;));
};

Writable.prototype.end = function(chunk, encoding, cb) {
  var state = this._writableState;

  if (typeof chunk === &#39;function&#39;) {
    cb = chunk;
    chunk = null;
    encoding = null;
  } else if (typeof encoding === &#39;function&#39;) {
    cb = encoding;
    encoding = null;
  }

  if (typeof chunk !== &#39;undefined&#39; &amp;&amp; chunk !== null)
    this.write(chunk, encoding);

  // ignore unnecessary end() calls.
  if (!state.ending &amp;&amp; !state.finished)
    endWritable(this, state, cb);
};


function needFinish(stream, state) {
  return (state.ending &amp;&amp;
          state.length === 0 &amp;&amp;
          !state.finished &amp;&amp;
          !state.writing);
}

function finishMaybe(stream, state) {
  var need = needFinish(stream, state);
  if (need) {
    state.finished = true;
    stream.emit(&#39;finish&#39;);
  }
  return need;
}

function endWritable(strea</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in36_link" href="javascript:jShowHide('in36');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/assert.js">/manta/public/examples/node-v0.10.17/lib/assert.js</a>
<br />
<div id="in36_contents" style="display: none" class="jObjectContents"><pre><code>// http://wiki.commonjs.org/wiki/Unit_Testing/1.0
//
// THIS IS NOT TESTED NOR LIKELY TO WORK OUTSIDE V8!
//
// Originally from narwhal.js (http://narwhaljs.org)
// Copyright (c) 2009 Thomas Robinson &lt;280north.com&gt;
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the &#39;Software&#39;), to
// deal in the Software without restriction, including without limitation the
// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
// sell copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &#39;AS IS&#39;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
// ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

// UTILITY
var util = require(&#39;util&#39;);
var pSlice = Array.prototype.slice;

// 1. The assert module provides functions that throw
// AssertionError&#39;s when particular conditions are not met. The
// assert module must conform to the following interface.

var assert = module.exports = ok;

// 2. The AssertionError is defined in assert.
// new assert.AssertionError({ message: message,
//                             actual: actual,
//                             expected: expected })

assert.AssertionError = function AssertionError(options) {
  this.name = &#39;AssertionError&#39;;
  this.actual = options.actual;
  this.expected = options.expected;
  this.operator = options.operator;
  this.message = options.message || getMessage(this);
  var stackStartFunction = options.stackStartFunction || fail;
  Error.captureStackTrace(this, stackStartFunction);
};

// assert.AssertionError instanceof Error
util.inherits(assert.AssertionError, Error);

function replacer(key, value) {
  if (value === undefined) {
    return &#39;&#39; + value;
  }
  if (typeof value === &#39;number&#39; &amp;&amp; (isNaN(value) || !isFinite(value))) {
    return value.toString();
  }
  if (typeof value === &#39;function&#39; || value instanceof RegExp) {
    return value.toString();
  }
  return value;
}

function truncate(s, n) {
  if (typeof s == &#39;string&#39;) {
    return s.length &lt; n ? s : s.slice(0, n);
  } else {
    return s;
  }
}

function getMessage(self) {
  return truncate(JSON.stringify(self.actual, replacer), 128) + &#39; &#39; +
         self.operator + &#39; &#39; +
         truncate(JSON.stringify(self.expected, replacer), 128);
}

// At present only the three keys mentioned above are used and
// understood by the spec. Implementations or sub modules can pass
// other keys to the AssertionError&#39;s constructor - they will be
// ignored.

// 3. All of the following functions must throw an AssertionError
// when a corresponding condition is not met, with a message that
// may be undefined if not provided.  All assertion methods provide
// both the actual and expected values to the assertion error for
// display purposes.

function fail(actual, expected, message, operator, stackStartFunction) {
  throw new assert.AssertionError({
    message: message,
    actual: actual,
    expected: expected,
    operator: operator,
    stackStartFunction: stackStartFunction
  });
}

// EXTENSION! allows for well behaved errors defined elsewhere.
assert.fail = fail;

// 4. Pure assertion tests whether a value is truthy, as determined
// by !!guard.
// assert.ok(guard, message_opt);
// This statement is equivalent to assert.equal(true, !!guard,
// message_opt);. To test strictly for the value true, use
// assert.strictEqual(true, guard, message_opt);.

function ok(value, message) {
  if (!!!value) fail(value, true, message, &#39;==&#39;, assert.ok);
}
assert.ok = ok;

// 5. The equality assertion tests shallow, coercive equality with
// ==.
// assert.equal(actual, expected, message_opt);

assert.equal = function equal(actual, expected, message) {
  if (actual != expected) fail(actual, expected, message, &#39;==&#39;, assert.equal);
};

// 6. The non-equality assertion tests for whether two objects are not equal
// with != assert.notEqual(actual, expected, message_opt);

assert.notEqual = function notEqual(actual, expected, message) {
  if (actual == expected) {
    fail(actual, expected, message, &#39;!=&#39;, assert.notEqual);
  }
};

// 7. The equivalence assertion tests a deep equality relation.
// assert.deepEqual(actual, expected, message_opt);

assert.deepEqual = function deepEqual(actual, expected, message) {
  if (!_deepEqual(actual, expected)) {
    fail(actual, expected, message, &#39;deepEqual&#39;, assert.deepEqual);
  }
};

function _deepEqual(actual, expected) {
  // 7.1. All identical values are equivalent, as determined by ===.
  if (actual === expected) {
    return true;

  } else if (Buffer.isBuffer(actual) &amp;&amp; Buffer.isBuffer(expected)) {
    if (actual.length != expected.length) return false;

    for (var i = 0; i &lt; actual.length; i++) {
      if (actual[i] !== expected[i]) return false;
    }

    return true;

  // 7.2. If the expected value is a Date object, the actual value is
  // equivalent if it is also a Date object that refers to the same time.
  } else if (actual instanceof Date &amp;&amp; expected instanceof Date) {
    return actual.getTime() === expected.getTime();

  // 7.3 If the expected value is a RegExp object, the actual value is
  // equivalent if it is also a RegExp object with the same source and
  // properties (`global`, `multiline`, `lastIndex`, `ignoreCase`).
  } else if (actual instanceof RegExp &amp;&amp; expected instanceof RegExp) {
    return actual.source === expected.source &amp;&amp;
           actual.global === expected.global &amp;&amp;
           actual.multiline === expected.multiline &amp;&amp;
           actual.lastIndex === expected.lastIndex &amp;&amp;
           actual.ignoreCase === expected.ignoreCase;

  // 7.4. Other pairs that do not both pass typeof value == &#39;object&#39;,
  // equivalence is determined by ==.
  } else if (typeof actual != &#39;object&#39; &amp;&amp; typeof expected != &#39;object&#39;) {
    return actual == expected;

  // 7.5 For all other Object pairs, including Array objects, equivalence is
  // determined by having the same number of owned properties (as verified
  // with Object.prototype.hasOwnProperty.call), the same set of keys
  // (although not necessarily the same order), equivalent values for every
  // corresponding key, and an identical &#39;prototype&#39; property. Note: this
  // accounts for both named and indexed properties on Arrays.
  } else {
    return objEquiv(actual, expected);
  }
}

function isUndefinedOrNull(value) {
  return value === null || value === undefined;
}

function isArguments(object) {
  return Object.prototype.toString.call(object) == &#39;[object Arguments]&#39;;
}

function objEquiv(a, b) {
  if (isUndefinedOrNull(a) || isUndefinedOrNull(b))
    return false;
  // an identical &#39;prototype&#39; property.
  if (a.prototype !== b.prototype) return false;
  //~~~I&#39;ve managed to break Object.keys through screwy arguments passing.
  //   Converting to array solves the problem.
  if (isArguments(a)) {
    if (!isArguments(b)) {
      return false;
    }
    a = pSlice.call(a);
    b = pSlice.call(b);
    return _deepEqual(a, b);
  }
  try {
    var ka = Object.keys(a),
        kb = Object.keys(b),
        key, i;
  } catch (e) {//happens when one is a string literal and the other isn&#39;t
    return false;
  }
  // having the same number of owned properties (keys incorporates
  // hasOwnProperty)
  if (ka.length != kb.length)
    return false;
  //the same set of keys (although not necessarily the same order),
  ka.sort();
  kb.sort();
  //~~~cheap key test
  for (i = ka.length - 1; i &gt;= 0; i--) {
    if (ka[i] != kb[i])
      return false;
  }
  //equivalent values for every corresponding key, and
  //~~~possibly expensive deep test
  for (i = ka.length - 1; i &gt;= 0; i--) {
    key = ka[i];
    if (!_deepEqual(a[key], b[key])) return false;
  }
  return true;
}

// 8. The non-equivalence assertion tests for any deep inequality.
// assert.notDeepEqual(actual, expected, message_opt);

assert.notDeepEqual = function notDeepEqual(actual, expected, message) {
  if (_deepEqual(actual, expected)) {
    fail(actual, expected, message, &#39;notDeepEqual&#39;, assert.notDeepEqual);
  }
};

// 9. The strict equality assertion tests strict equality, as determined by ===.
// assert.strictEqual(actual, expected, message_opt);

assert.strictEqual = function strictEqual(actual, expected, message) {
  if (actual !== expected) {
    fail(actual, expected, message, &#39;===&#39;, assert.strictEqual);
  }
};

// 10. The strict non-equality assertion tests for strict inequality, as
// determined by !==.  assert.notStrictEqual(actual, expected, message_opt);

assert.notStrictEqual = function notStrictEqual(actual, expected, message) {
  if (actual === expected) {
    fail(actual, expected, message, &#39;!==&#39;, assert.notStrictEqual);
  }
};

function expectedException(actual, expected) {
  if (!actual || !expected) {
    return false;
  }

  if (Object.prototype.toString.call(expected) == &#39;[object RegExp]&#39;) {
    return expected.test(actual);
  } else if (actual instanceof expected) {
    return true;
  } else if (expected.call({}, actual) === true) {
    return true;
  }

  return false;
}

function _throws(shouldThrow, block, expected, message) {
  var actual;

  if (typeof expected === &#39;string&#39;) {
    message = expected;
    expected = null;
  }

  try {
    block();
  } catch (e) {
    actual = e;
  }

  message = (expected &amp;&amp; expected.name ? &#39; (&#39; + expected.name + &#39;).&#39; : &#39;.&#39;) +
            (message ? &#39; &#39; + message : &#39;.&#39;);

  if (shouldThrow &amp;&amp; !actual) {
    fail(actual, expected, &#39;Missing expected exception&#39; + message);
  }

  if (!shouldThrow &amp;&amp; expectedException(actual, expected)) {
    fail(actual, expected, &#39;Got unwanted exception&#39; + message);
  }

  if ((shouldThrow &amp;&amp; actual &amp;&amp; expected &amp;&amp;
      !expectedException(actual, expected)) || (!s</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in37_link" href="javascript:jShowHide('in37');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/child_process.js">/manta/public/examples/node-v0.10.17/lib/child_process.js</a>
<br />
<div id="in37_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var StringDecoder = require(&#39;string_decoder&#39;).StringDecoder;
var EventEmitter = require(&#39;events&#39;).EventEmitter;
var net = require(&#39;net&#39;);
var dgram = require(&#39;dgram&#39;);
var Process = process.binding(&#39;process_wrap&#39;).Process;
var assert = require(&#39;assert&#39;);
var util = require(&#39;util&#39;);
var constants; // if (!constants) constants = process.binding(&#39;constants&#39;);

var handleWraps = {};

function handleWrapGetter(name, callback) {
  var cons;

  Object.defineProperty(handleWraps, name, {
    get: function() {
      if (cons !== undefined) return cons;
      return cons = callback();
    }
  });
}

handleWrapGetter(&#39;Pipe&#39;, function() {
  return process.binding(&#39;pipe_wrap&#39;).Pipe;
});

handleWrapGetter(&#39;TTY&#39;, function() {
  return process.binding(&#39;tty_wrap&#39;).TTY;
});

handleWrapGetter(&#39;TCP&#39;, function() {
  return process.binding(&#39;tcp_wrap&#39;).TCP;
});

handleWrapGetter(&#39;UDP&#39;, function() {
  return process.binding(&#39;udp_wrap&#39;).UDP;
});

// constructors for lazy loading
function createPipe(ipc) {
  return new handleWraps.Pipe(ipc);
}

function createSocket(pipe, readable) {
  var s = new net.Socket({ handle: pipe });

  if (readable) {
    s.writable = false;
    s.readable = true;
  } else {
    s.writable = true;
    s.readable = false;
  }

  return s;
}


// this object contain function to convert TCP objects to native handle objects
// and back again.
var handleConversion = {
  &#39;net.Native&#39;: {
    simultaneousAccepts: true,

    send: function(message, handle) {
      return handle;
    },

    got: function(message, handle, emit) {
      emit(handle);
    }
  },

  &#39;net.Server&#39;: {
    simultaneousAccepts: true,

    send: function(message, server) {
      return server._handle;
    },

    got: function(message, handle, emit) {
      var self = this;

      var server = new net.Server();
      server.listen(handle, function() {
        emit(server);
      });
    }
  },

  &#39;net.Socket&#39;: {
    send: function(message, socket) {
      // if the socket was created by net.Server
      if (socket.server) {
        // the slave should keep track of the socket
        message.key = socket.server._connectionKey;

        var firstTime = !this._channel.sockets.send[message.key];
        var socketList = getSocketList(&#39;send&#39;, this, message.key);

        // the server should no longer expose a .connection property
        // and when asked to close it should query the socket status from
        // the slaves
        if (firstTime) socket.server._setupSlave(socketList);

        // Act like socket is detached
        socket.server._connections--;
      }

      // remove handle from socket object, it will be closed when the socket
      // will be sent
      var handle = socket._handle;
      handle.onread = function() {};
      socket._handle = null;

      return handle;
    },

    postSend: function(handle) {
      // Close the Socket handle after sending it
      handle.close();
    },

    got: function(message, handle, emit) {
      var socket = new net.Socket({handle: handle});
      socket.readable = socket.writable = true;

      // if the socket was created by net.Server we will track the socket
      if (message.key) {

        // add socket to connections list
        var socketList = getSocketList(&#39;got&#39;, this, message.key);
        socketList.add({
          socket: socket
        });
      }

      emit(socket);
    }
  },

  &#39;dgram.Native&#39;: {
    simultaneousAccepts: false,

    send: function(message, handle) {
      return handle;
    },

    got: function(message, handle, emit) {
      emit(handle);
    }
  },

  &#39;dgram.Socket&#39;: {
    simultaneousAccepts: false,

    send: function(message, socket) {
      message.dgramType = socket.type;

      return socket._handle;
    },

    got: function(message, handle, emit) {
      var socket = new dgram.Socket(message.dgramType);

      socket.bind(handle, function() {
        emit(socket);
      });
    }
  }
};

// This object keep track of the socket there are sended
function SocketListSend(slave, key) {
  EventEmitter.call(this);

  var self = this;

  this.key = key;
  this.slave = slave;
}
util.inherits(SocketListSend, EventEmitter);

SocketListSend.prototype._request = function(msg, cmd, callback) {
  var self = this;

  if (!this.slave.connected) return onclose();
  this.slave.send(msg);

  function onclose() {
    self.slave.removeListener(&#39;internalMessage&#39;, onreply);
    callback(new Error(&#39;Slave closed before reply&#39;));
  };

  function onreply(msg) {
    if (!(msg.cmd === cmd &amp;&amp; msg.key === self.key)) return;
    self.slave.removeListener(&#39;disconnect&#39;, onclose);
    self.slave.removeListener(&#39;internalMessage&#39;, onreply);

    callback(null, msg);
  };

  this.slave.once(&#39;disconnect&#39;, onclose);
  this.slave.on(&#39;internalMessage&#39;, onreply);
};

SocketListSend.prototype.close = function close(callback) {
  this._request({
    cmd: &#39;NODE_SOCKET_NOTIFY_CLOSE&#39;,
    key: this.key
  }, &#39;NODE_SOCKET_ALL_CLOSED&#39;, callback);
};

SocketListSend.prototype.getConnections = function getConnections(callback) {
  this._request({
    cmd: &#39;NODE_SOCKET_GET_COUNT&#39;,
    key: this.key
  }, &#39;NODE_SOCKET_COUNT&#39;, function(err, msg) {
    if (err) return callback(err);
    callback(null, msg.count);
  });
};

// This object keep track of the socket there are received
function SocketListReceive(slave, key) {
  EventEmitter.call(this);

  var self = this;

  this.connections = 0;
  this.key = key;
  this.slave = slave;

  function onempty() {
    if (!self.slave.connected) return;

    self.slave.send({
      cmd: &#39;NODE_SOCKET_ALL_CLOSED&#39;,
      key: self.key
    });
  }

  this.slave.on(&#39;internalMessage&#39;, function(msg) {
    if (msg.key !== self.key) return;

    if (msg.cmd === &#39;NODE_SOCKET_NOTIFY_CLOSE&#39;) {
      // Already empty
      if (self.connections === 0) return onempty();

      // Wait for sockets to get closed
      self.once(&#39;empty&#39;, onempty);
    } else if (msg.cmd === &#39;NODE_SOCKET_GET_COUNT&#39;) {
      if (!self.slave.connected) return;
      self.slave.send({
        cmd: &#39;NODE_SOCKET_COUNT&#39;,
        key: self.key,
        count: self.connections
      });
    }
  });
}
util.inherits(SocketListReceive, EventEmitter);

SocketListReceive.prototype.add = function(obj) {
  var self = this;

  this.connections++;

  // Notify previous owner of socket about its state change
  obj.socket.once(&#39;close&#39;, function() {
    self.connections--;

    if (self.connections === 0) self.emit(&#39;empty&#39;);
  });
};

function getSocketList(type, slave, key) {
  var sockets = slave._channel.sockets[type];
  var socketList = sockets[key];
  if (!socketList) {
    var Construct = type === &#39;send&#39; ? SocketListSend : SocketListReceive;
    socketList = sockets[key] = new Construct(slave, key);
  }
  return socketList;
}

var INTERNAL_PREFIX = &#39;NODE_&#39;;
function handleMessage(target, message, handle) {
  var eventName = &#39;message&#39;;
  if (message !== null &amp;&amp;
      typeof message === &#39;object&#39; &amp;&amp;
      typeof message.cmd === &#39;string&#39; &amp;&amp;
      message.cmd.length &gt; INTERNAL_PREFIX.length &amp;&amp;
      message.cmd.slice(0, INTERNAL_PREFIX.length) === INTERNAL_PREFIX) {
    eventName = &#39;internalMessage&#39;;
  }
  target.emit(eventName, message, handle);
}

function setupChannel(target, channel) {
  target._channel = channel;
  target._handleQueue = null;

  var decoder = new StringDecoder(&#39;utf8&#39;);
  var jsonBuffer = &#39;&#39;;
  channel.buffering = false;
  channel.onread = function(pool, offset, length, recvHandle) {
    if (pool) {
      jsonBuffer += decoder.write(pool.slice(offset, offset + length));

      var i, start = 0;

      //Linebreak is used as a message end sign
      while ((i = jsonBuffer.indexOf(&#39;\n&#39;, start)) &gt;= 0) {
        var json = jsonBuffer.slice(start, i);
        var message = JSON.parse(json);

        // There will be at most one NODE_HANDLE message in every chunk we
        // read because SCM_RIGHTS messages don&#39;t get coalesced. Make sure
        // that we deliver the handle with the right message however.
        if (message &amp;&amp; message.cmd === &#39;NODE_HANDLE&#39;)
          handleMessage(target, message, recvHandle);
        else
          handleMessage(target, message, undefined);

        start = i + 1;
      }
      jsonBuffer = jsonBuffer.slice(start);
      this.buffering = jsonBuffer.length !== 0;

    } else {
      this.buffering = false;
      target.disconnect();
      channel.onread = nop;
      channel.close();
      maybeClose(target);
    }
  };

  // object where socket lists will live
  channel.sockets = { got: {}, send: {} };

  // handlers will go through this
  target.on(&#39;internalMessage&#39;, function(message, handle) {
    // Once acknowledged - continue sending handles.
    if (message.cmd === &#39;NODE_HANDLE_ACK&#39;) {
      assert(Array.isArray(target._handleQueue));
      var queue = target._handleQueue;
      target._handleQueue = null;
      queue.forEach(function(args) {
        target.send(args.message, args.handle);
      });
      return;
    }

    if (message.cmd !== &#39;NODE_HANDLE&#39;) return;

    // Acknowledge handle receival.
    target.send({ cmd: &#39;NODE_HANDLE_ACK&#39; });

    var obj = handleConversion[me</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in38_link" href="javascript:jShowHide('in38');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/console.js">/manta/public/examples/node-v0.10.17/lib/console.js</a>
<br />
<div id="in38_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var util = require(&#39;util&#39;);

function Console(stdout, stderr) {
  if (!(this instanceof Console)) {
    return new Console(stdout, stderr);
  }
  if (!stdout || typeof stdout.write !== &#39;function&#39;) {
    throw new TypeError(&#39;Console expects a writable stream instance&#39;);
  }
  if (!stderr) {
    stderr = stdout;
  }
  var prop = {
    writable: true,
    enumerable: false,
    configurable: true
  };
  prop.value = stdout;
  Object.defineProperty(this, &#39;_stdout&#39;, prop);
  prop.value = stderr;
  Object.defineProperty(this, &#39;_stderr&#39;, prop);
  prop.value = {};
  Object.defineProperty(this, &#39;_times&#39;, prop);

  // bind the prototype functions to this Console instance
  Object.keys(Console.prototype).forEach(function(k) {
    this[k] = this[k].bind(this);
  }, this);
}

Console.prototype.log = function() {
  this._stdout.write(util.format.apply(this, arguments) + &#39;\n&#39;);
};


Console.prototype.info = Console.prototype.log;


Console.prototype.warn = function() {
  this._stderr.write(util.format.apply(this, arguments) + &#39;\n&#39;);
};


Console.prototype.error = Console.prototype.warn;


Console.prototype.dir = function(object) {
  this._stdout.write(util.inspect(object) + &#39;\n&#39;);
};


Console.prototype.time = function(label) {
  this._times[label] = Date.now();
};


Console.prototype.timeEnd = function(label) {
  var time = this._times[label];
  if (!time) {
    throw new Error(&#39;No such label: &#39; + label);
  }
  var duration = Date.now() - time;
  this.log(&#39;%s: %dms&#39;, label, duration);
};


Console.prototype.trace = function() {
  // TODO probably can to do this better with V8&#39;s debug object once that is
  // exposed.
  var err = new Error;
  err.name = &#39;Trace&#39;;
  err.message = util.format.apply(this, arguments);
  Error.captureStackTrace(err, arguments.callee);
  this.error(err.stack);
};


Console.prototype.assert = function(expression) {
  if (!expression) {
    var arr = Array.prototype.slice.call(arguments, 1);
    require(&#39;assert&#39;).ok(false, util.format.apply(this, arr));
  }
};


module.exports = new Console(process.stdout, process.stderr);
module.exports.Console = Console;
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in39_link" href="javascript:jShowHide('in39');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/buffer.js">/manta/public/examples/node-v0.10.17/lib/buffer.js</a>
<br />
<div id="in39_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var SlowBuffer = process.binding(&#39;buffer&#39;).SlowBuffer;
var assert = require(&#39;assert&#39;);

exports.INSPECT_MAX_BYTES = 50;

// Make SlowBuffer inherit from Buffer.
// This is an exception to the rule that __proto__ is not allowed in core.
SlowBuffer.prototype.__proto__ = Buffer.prototype;


function clamp(index, len, defaultValue) {
  if (typeof index !== &#39;number&#39;) return defaultValue;
  index = ~~index;  // Coerce to integer.
  if (index &gt;= len) return len;
  if (index &gt;= 0) return index;
  index += len;
  if (index &gt;= 0) return index;
  return 0;
}


function toHex(n) {
  if (n &lt; 16) return &#39;0&#39; + n.toString(16);
  return n.toString(16);
}


SlowBuffer.prototype.toString = function(encoding, start, end) {
  encoding = String(encoding || &#39;utf8&#39;).toLowerCase();
  start = +start || 0;
  if (typeof end !== &#39;number&#39;) end = this.length;

  // Fastpath empty strings
  if (+end == start) {
    return &#39;&#39;;
  }

  switch (encoding) {
    case &#39;hex&#39;:
      return this.hexSlice(start, end);

    case &#39;utf8&#39;:
    case &#39;utf-8&#39;:
      return this.utf8Slice(start, end);

    case &#39;ascii&#39;:
      return this.asciiSlice(start, end);

    case &#39;binary&#39;:
      return this.binarySlice(start, end);

    case &#39;base64&#39;:
      return this.base64Slice(start, end);

    case &#39;ucs2&#39;:
    case &#39;ucs-2&#39;:
    case &#39;utf16le&#39;:
    case &#39;utf-16le&#39;:
      return this.ucs2Slice(start, end);

    default:
      throw new TypeError(&#39;Unknown encoding: &#39; + encoding);
  }
};


SlowBuffer.prototype.write = function(string, offset, length, encoding) {
  // Support both (string, offset, length, encoding)
  // and the legacy (string, encoding, offset, length)
  if (isFinite(offset)) {
    if (!isFinite(length)) {
      encoding = length;
      length = undefined;
    }
  } else {  // legacy
    var swap = encoding;
    encoding = offset;
    offset = length;
    length = swap;
  }

  offset = +offset || 0;
  var remaining = this.length - offset;
  if (!length) {
    length = remaining;
  } else {
    length = +length;
    if (length &gt; remaining) {
      length = remaining;
    }
  }
  encoding = String(encoding || &#39;utf8&#39;).toLowerCase();

  switch (encoding) {
    case &#39;hex&#39;:
      return this.hexWrite(string, offset, length);

    case &#39;utf8&#39;:
    case &#39;utf-8&#39;:
      return this.utf8Write(string, offset, length);

    case &#39;ascii&#39;:
      return this.asciiWrite(string, offset, length);

    case &#39;binary&#39;:
      return this.binaryWrite(string, offset, length);

    case &#39;base64&#39;:
      return this.base64Write(string, offset, length);

    case &#39;ucs2&#39;:
    case &#39;ucs-2&#39;:
    case &#39;utf16le&#39;:
    case &#39;utf-16le&#39;:
      return this.ucs2Write(string, offset, length);

    default:
      throw new TypeError(&#39;Unknown encoding: &#39; + encoding);
  }
};


// slice(start, end)
SlowBuffer.prototype.slice = function(start, end) {
  var len = this.length;
  start = clamp(start, len, 0);
  end = clamp(end, len, len);
  return new Buffer(this, end - start, start);
};


var zeroBuffer = new SlowBuffer(0);

// Buffer
function Buffer(subject, encoding, offset) {
  if (!(this instanceof Buffer)) {
    return new Buffer(subject, encoding, offset);
  }

  var type;

  // Are we slicing?
  if (typeof offset === &#39;number&#39;) {
    if (!Buffer.isBuffer(subject)) {
      throw new TypeError(&#39;First argument must be a Buffer when slicing&#39;);
    }

    this.length = +encoding &gt; 0 ? Math.ceil(encoding) : 0;
    this.parent = subject.parent ? subject.parent : subject;
    this.offset = offset;
  } else {
    // Find the length
    switch (type = typeof subject) {
      case &#39;number&#39;:
        this.length = +subject &gt; 0 ? Math.ceil(subject) : 0;
        break;

      case &#39;string&#39;:
        this.length = Buffer.byteLength(subject, encoding);
        break;

      case &#39;object&#39;: // Assume object is array-ish
        this.length = +subject.length &gt; 0 ? Math.ceil(subject.length) : 0;
        break;

      default:
        throw new TypeError(&#39;First argument needs to be a number, &#39; +
                            &#39;array or string.&#39;);
    }

    if (this.length &gt; Buffer.poolSize) {
      // Big buffer, just alloc one.
      this.parent = new SlowBuffer(this.length);
      this.offset = 0;

    } else if (this.length &gt; 0) {
      // Small buffer.
      if (!pool || pool.length - pool.used &lt; this.length) allocPool();
      this.parent = pool;
      this.offset = pool.used;
      // Align on 8 byte boundary to avoid alignment issues on ARM.
      pool.used = (pool.used + this.length + 7) &amp; ~7;

    } else {
      // Zero-length buffer
      this.parent = zeroBuffer;
      this.offset = 0;
    }

    // optimize by branching logic for new allocations
    if (typeof subject !== &#39;number&#39;) {
      if (type === &#39;string&#39;) {
        // We are a string
        this.length = this.write(subject, 0, encoding);
      // if subject is buffer then use built-in copy method
      } else if (Buffer.isBuffer(subject)) {
        if (subject.parent)
          subject.parent.copy(this.parent,
                              this.offset,
                              subject.offset,
                              this.length + subject.offset);
        else
          subject.copy(this.parent, this.offset, 0, this.length);
      } else if (isArrayIsh(subject)) {
        for (var i = 0; i &lt; this.length; i++)
          this.parent[i + this.offset] = subject[i];
      }
    }
  }

  SlowBuffer.makeFastBuffer(this.parent, this, this.offset, this.length);
}

function isArrayIsh(subject) {
  return Array.isArray(subject) ||
         subject &amp;&amp; typeof subject === &#39;object&#39; &amp;&amp;
         typeof subject.length === &#39;number&#39;;
}

exports.SlowBuffer = SlowBuffer;
exports.Buffer = Buffer;


Buffer.isEncoding = function(encoding) {
  switch (encoding &amp;&amp; encoding.toLowerCase()) {
    case &#39;hex&#39;:
    case &#39;utf8&#39;:
    case &#39;utf-8&#39;:
    case &#39;ascii&#39;:
    case &#39;binary&#39;:
    case &#39;base64&#39;:
    case &#39;ucs2&#39;:
    case &#39;ucs-2&#39;:
    case &#39;utf16le&#39;:
    case &#39;utf-16le&#39;:
    case &#39;raw&#39;:
      return true;

    default:
      return false;
  }
};



Buffer.poolSize = 8 * 1024;
var pool;

function allocPool() {
  pool = new SlowBuffer(Buffer.poolSize);
  pool.used = 0;
}


// Static methods
Buffer.isBuffer = function isBuffer(b) {
  return b instanceof Buffer;
};


// Inspect
Buffer.prototype.inspect = function inspect() {
  var out = [],
      len = this.length,
      name = this.constructor.name;

  for (var i = 0; i &lt; len; i++) {
    out[i] = toHex(this[i]);
    if (i == exports.INSPECT_MAX_BYTES) {
      out[i + 1] = &#39;...&#39;;
      break;
    }
  }

  return &#39;&lt;&#39; + name + &#39; &#39; + out.join(&#39; &#39;) + &#39;&gt;&#39;;
};


Buffer.prototype.get = function get(offset) {
  if (offset &lt; 0 || offset &gt;= this.length)
    throw new RangeError(&#39;offset is out of bounds&#39;);
  return this.parent[this.offset + offset];
};


Buffer.prototype.set = function set(offset, v) {
  if (offset &lt; 0 || offset &gt;= this.length)
    throw new RangeError(&#39;offset is out of bounds&#39;);
  return this.parent[this.offset + offset] = v;
};


// write(string, offset = 0, length = buffer.length-offset, encoding = &#39;utf8&#39;)
Buffer.prototype.write = function(string, offset, length, encoding) {
  // Support both (string, offset, length, encoding)
  // and the legacy (string, encoding, offset, length)
  if (isFinite(offset)) {
    if (!isFinite(length)) {
      encoding = length;
      length = undefined;
    }
  } else {  // legacy
    var swap = encoding;
    encoding = offset;
    offset = length;
    length = swap;
  }

  offset = +offset || 0;
  var remaining = this.length - offset;
  if (!length) {
    length = remaining;
  } else {
    length = +length;
    if (length &gt; remaining) {
      length = remaining;
    }
  }
  encoding = String(encoding || &#39;utf8&#39;).toLowerCase();

  if (string.length &gt; 0 &amp;&amp; (length &lt; 0 || offset &lt; 0))
    throw new RangeError(&#39;attempt to write beyond buffer bounds&#39;);

  var ret;
  switch (encoding) {
    case &#39;hex&#39;:
      ret = this.parent.hexWrite(string, this.offset + offset, length);
      break;

    case &#39;utf8&#39;:
    case &#39;utf-8&#39;:
      ret = this.parent.utf8Write(string, this.offset + offset, length);
      break;

    case &#39;ascii&#39;:
      ret = this.parent.asciiWrite(string, this.offset + offset, length);
      break;

    case &#39;binary&#39;:
      ret = this.parent.binaryWrite(string, this.offset + offset, length);
      break;

    case &#39;base64&#39;:
      // Warning: maxLength not taken into account in base64Write
      ret = this.parent.base64Write(string, this.offset + offset, length);
      break;

    case &#39;ucs2&#39;:
    case &#39;ucs-2&#39;:
    case &#39;utf16le&#39;:
    case &#39;utf-16le&#39;:
      ret = this.parent.ucs2Write(string, this.offset + offset, length);
      break;

    default:
      throw new TypeError(&#39;Unknown encoding: &#39; + encoding);
  }

  Buffer._charsWritten = SlowBuffer._charsWritten;

  return ret;
};


Buffer.prototype.toJSON = function() {
  return Array.prototype.slice.call(this, 0);
};


// toString(encoding, start=0, end=buffer.length)
Buffer.prototype.toString = function(encoding, start, end) {
  encoding = String(encoding || &#39;utf8&#39;).toLowerCase();

  if (typeof start !== &#39;number&#39; || start &lt; 0) {
    start = 0;
  }</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in40_link" href="javascript:jShowHide('in40');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/cluster.js">/manta/public/examples/node-v0.10.17/lib/cluster.js</a>
<br />
<div id="in40_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var assert = require(&#39;assert&#39;);
var fork = require(&#39;child_process&#39;).fork;
var net = require(&#39;net&#39;);
var EventEmitter = require(&#39;events&#39;).EventEmitter;
var util = require(&#39;util&#39;);

function isObject(o) {
  return (typeof o === &#39;object&#39; &amp;&amp; o !== null);
}

var debug;
if (process.env.NODE_DEBUG &amp;&amp; /cluster/.test(process.env.NODE_DEBUG)) {
  debug = function(x) {
    var prefix = process.pid + &#39;,&#39; +
        (process.env.NODE_UNIQUE_ID ? &#39;Worker&#39; : &#39;Master&#39;);
    console.error(prefix, x);
  };
} else {
  debug = function() { };
}

// cluster object:
function Cluster() {
  EventEmitter.call(this);
}

util.inherits(Cluster, EventEmitter);

var cluster = module.exports = new Cluster();

// Used in the master:
var masterStarted = false;
var ids = 0;
var serverHandlers = {};

// Used in the worker:
var serverListeners = {};
var queryIds = 0;
var queryCallbacks = {};

// Define isWorker and isMaster
cluster.isWorker = &#39;NODE_UNIQUE_ID&#39; in process.env;
cluster.isMaster = ! cluster.isWorker;

// The worker object is only used in a worker
cluster.worker = cluster.isWorker ? {} : null;
// The workers array is only used in the master
cluster.workers = cluster.isMaster ? {} : null;

// Settings object
var settings = cluster.settings = {};

// Simple function to call a function on each worker
function eachWorker(cb) {
  // Go through all workers
  for (var id in cluster.workers) {
    if (cluster.workers.hasOwnProperty(id)) {
      cb(cluster.workers[id]);
    }
  }
}

// Extremely simple progress tracker
function ProgressTracker(missing, callback) {
  this.missing = missing;
  this.callback = callback;
}
ProgressTracker.prototype.done = function() {
  this.missing -= 1;
  this.check();
};
ProgressTracker.prototype.check = function() {
  if (this.missing === 0) this.callback();
};

cluster.setupMaster = function(options) {
  // This can only be called from the master.
  assert(cluster.isMaster);

  // Don&#39;t allow this function to run more than once
  if (masterStarted) return;
  masterStarted = true;

  // Get filename and arguments
  options = options || {};

  // By default, V8 writes the profile data of all processes to a single
  // v8.log.
  //
  // Running that log file through a tick processor produces bogus numbers
  // because many events won&#39;t match up with the recorded memory mappings
  // and you end up with graphs where 80+% of ticks is unaccounted for.
  //
  // Fixing the tick processor to deal with multi-process output is not very
  // useful because the processes may be running wildly disparate workloads.
  //
  // That&#39;s why we fix up the command line arguments to include
  // a &quot;--logfile=v8-%p.log&quot; argument (where %p is expanded to the PID)
  // unless it already contains a --logfile argument.
  var execArgv = options.execArgv || process.execArgv;
  if (execArgv.some(function(s) { return /^--prof/.test(s); }) &amp;&amp;
      !execArgv.some(function(s) { return /^--logfile=/.test(s); }))
  {
    execArgv = execArgv.slice();
    execArgv.push(&#39;--logfile=v8-%p.log&#39;);
  }

  // Set settings object
  settings = cluster.settings = {
    exec: options.exec || process.argv[1],
    execArgv: execArgv,
    args: options.args || process.argv.slice(2),
    silent: options.silent || false
  };

  // emit setup event
  cluster.emit(&#39;setup&#39;);
};

// Check if a message is internal only
var INTERNAL_PREFIX = &#39;NODE_CLUSTER_&#39;;
function isInternalMessage(message) {
  return isObject(message) &amp;&amp;
      typeof message.cmd === &#39;string&#39; &amp;&amp;
      message.cmd.length &gt; INTERNAL_PREFIX.length &amp;&amp;
      message.cmd.slice(0, INTERNAL_PREFIX.length) === INTERNAL_PREFIX;
}

// Modify message object to be internal
function internalMessage(inMessage) {
  var outMessage = util._extend({}, inMessage);

  // Add internal prefix to cmd
  outMessage.cmd = INTERNAL_PREFIX + (outMessage.cmd || &#39;&#39;);

  return outMessage;
}

// Handle callback messages
function handleResponse(outMessage, outHandle, inMessage, inHandle, worker) {

  // The message there will be sent
  var message = internalMessage(outMessage);

  // callback id - will be undefined if not set
  message._queryEcho = inMessage._requestEcho;

  // Call callback if a query echo is received
  if (inMessage._queryEcho) {
    queryCallbacks[inMessage._queryEcho](inMessage.content, inHandle);
    delete queryCallbacks[inMessage._queryEcho];
  }

  // Send if outWrap contains something useful
  if (!(outMessage === undefined &amp;&amp; message._queryEcho === undefined)) {
    sendInternalMessage(worker, message, outHandle);
  }
}

// Handle messages from both master and workers
var messageHandler = {};
function handleMessage(worker, inMessage, inHandle) {

  // Remove internal prefix
  var message = util._extend({}, inMessage);
  message.cmd = inMessage.cmd.substr(INTERNAL_PREFIX.length);

  var respondUsed = false;
  function respond(outMessage, outHandler) {
    respondUsed = true;
    handleResponse(outMessage, outHandler, inMessage, inHandle, worker);
  }

  // Run handler if it exists
  if (messageHandler[message.cmd]) {
    messageHandler[message.cmd](message, worker, respond);
  }

  // Send respond if it hasn&#39;t been called yet
  if (respondUsed === false) {
    respond();
  }
}

// Messages to the master will be handled using these methods
if (cluster.isMaster) {

  // Handle online messages from workers
  messageHandler.online = function(message, worker) {
    worker.state = &#39;online&#39;;
    debug(&#39;Worker &#39; + worker.process.pid + &#39; online&#39;);
    worker.emit(&#39;online&#39;);
    cluster.emit(&#39;online&#39;, worker);
  };

  // Handle queryServer messages from workers
  messageHandler.queryServer = function(message, worker, send) {

    // This sequence of information is unique to the connection
    // but not to the worker
    var args = [message.address,
                message.port,
                message.addressType,
                message.fd];
    var key = args.join(&#39;:&#39;);
    var handler;

    if (serverHandlers.hasOwnProperty(key)) {
      handler = serverHandlers[key];
    } else if (message.addressType === &#39;udp4&#39; ||
               message.addressType === &#39;udp6&#39;) {
      var dgram = require(&#39;dgram&#39;);
      handler = dgram._createSocketHandle.apply(net, args);
      serverHandlers[key] = handler;
    } else {
      handler = net._createServerHandle.apply(net, args);
      serverHandlers[key] = handler;
    }

    // echo callback with the fd handler associated with it
    send({}, handler);
  };

  // Handle listening messages from workers
  messageHandler.listening = function(message, worker) {

    worker.state = &#39;listening&#39;;

    // Emit listening, now that we know the worker is listening
    worker.emit(&#39;listening&#39;, {
      address: message.address,
      port: message.port,
      addressType: message.addressType,
      fd: message.fd
    });
    cluster.emit(&#39;listening&#39;, worker, {
      address: message.address,
      port: message.port,
      addressType: message.addressType,
      fd: message.fd
    });
  };

  // Handle suicide messages from workers
  messageHandler.suicide = function(message, worker) {
    worker.suicide = true;
  };
}


// Messages to a worker will be handled using these methods
else if (cluster.isWorker) {

  // Handle worker.disconnect from master
  messageHandler.disconnect = function(message, worker) {
    worker.disconnect();
  };
}

function toDecInt(value) {
  value = parseInt(value, 10);
  return isNaN(value) ? null : value;
}

// Create a worker object, that works both for master and worker
function Worker(customEnv) {
  if (!(this instanceof Worker)) return new Worker();
  EventEmitter.call(this);

  var self = this;
  var env = process.env;

  // Assign a unique id, default null
  this.id = cluster.isMaster ? ++ids : toDecInt(env.NODE_UNIQUE_ID);

  // XXX: Legacy.  Remove in 0.9
  this.workerID = this.uniqueID = this.id;

  // Assign state
  this.state = &#39;none&#39;;

  // Create or get process
  if (cluster.isMaster) {

    // Create env object
    // first: copy and add id property
    var envCopy = util._extend({}, env);
    envCopy[&#39;NODE_UNIQUE_ID&#39;] = this.id;
    // second: extend envCopy with the env argument
    if (isObject(customEnv)) {
      envCopy = util._extend(envCopy, customEnv);
    }

    // fork worker
    this.process = fork(settings.exec, settings.args, {
      &#39;env&#39;: envCopy,
      &#39;silent&#39;: settings.silent,
      &#39;execArgv&#39;: settings.execArgv
    });
  } else {
    this.process = process;
  }

  if (cluster.isMaster) {
    // Save worker in the cluster.workers array
    cluster.workers[this.id] = this;

    // Emit a fork event, on next tick
    // There is no worker.fork event since this has no real purpose
    process.nextTick(function() {
      cluster.emit(&#39;fork&#39;, self);
    });
  }

  // handle internalMessage, exit and disconnect event
  this.process.on(&#39;internalMessage&#39;, handleMessage.bind(null, this));
  this.process.once(&#39;exit&#39;, function(exitCode, signalCode) {
    prepareExit(self, &#39;dead&#39;);
    self.emit(&#39;exit&#39;, exitCode, signalCode);
    cluster.emit(&#39;exit&#39;, self, exitCode, signalCode);
  });
  this.process.once(&#39;disconnect&#39;, function() {
    prepareExit(self, &#39;disconne</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in41_link" href="javascript:jShowHide('in41');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/constants.js">/manta/public/examples/node-v0.10.17/lib/constants.js</a>
<br />
<div id="in41_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

module.exports = process.binding(&#39;constants&#39;);
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in42_link" href="javascript:jShowHide('in42');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/dgram.js">/manta/public/examples/node-v0.10.17/lib/dgram.js</a>
<br />
<div id="in42_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var assert = require(&#39;assert&#39;);
var util = require(&#39;util&#39;);
var events = require(&#39;events&#39;);

var UDP = process.binding(&#39;udp_wrap&#39;).UDP;

var BIND_STATE_UNBOUND = 0;
var BIND_STATE_BINDING = 1;
var BIND_STATE_BOUND = 2;

// lazily loaded
var cluster = null;
var dns = null;
var net = null;


// no-op callback
function noop() {
}


function isIP(address) {
  if (!net)
    net = require(&#39;net&#39;);

  return net.isIP(address);
}


function lookup(address, family, callback) {
  if (!dns)
    dns = require(&#39;dns&#39;);

  return dns.lookup(address, family, callback);
}


function lookup4(address, callback) {
  return lookup(address || &#39;0.0.0.0&#39;, 4, callback);
}


function lookup6(address, callback) {
  return lookup(address || &#39;::0&#39;, 6, callback);
}


function newHandle(type) {
  if (type == &#39;udp4&#39;) {
    var handle = new UDP;
    handle.lookup = lookup4;
    return handle;
  }

  if (type == &#39;udp6&#39;) {
    var handle = new UDP;
    handle.lookup = lookup6;
    handle.bind = handle.bind6;
    handle.send = handle.send6;
    return handle;
  }

  if (type == &#39;unix_dgram&#39;)
    throw new Error(&#39;unix_dgram sockets are not supported any more.&#39;);

  throw new Error(&#39;Bad socket type specified. Valid types are: udp4, udp6&#39;);
}


exports._createSocketHandle = function(address, port, addressType, fd) {
  // Opening an existing fd is not supported for UDP handles.
  assert(typeof fd !== &#39;number&#39; || fd &lt; 0);

  var handle = newHandle(addressType);

  if (port || address) {
    var r = handle.bind(address, port || 0, 0);
    if (r == -1) {
      handle.close();
      handle = null;
    }
  }

  return handle;
};


function Socket(type, listener) {
  events.EventEmitter.call(this);

  var handle = newHandle(type);
  handle.owner = this;

  this._handle = handle;
  this._receiving = false;
  this._bindState = BIND_STATE_UNBOUND;
  this.type = type;
  this.fd = null; // compatibility hack

  if (typeof listener === &#39;function&#39;)
    this.on(&#39;message&#39;, listener);
}
util.inherits(Socket, events.EventEmitter);
exports.Socket = Socket;


exports.createSocket = function(type, listener) {
  return new Socket(type, listener);
};


function startListening(socket) {
  socket._handle.onmessage = onMessage;
  // Todo: handle errors
  socket._handle.recvStart();
  socket._receiving = true;
  socket._bindState = BIND_STATE_BOUND;
  socket.fd = -42; // compatibility hack

  socket.emit(&#39;listening&#39;);
}

function replaceHandle(self, newHandle) {

  // Set up the handle that we got from master.
  newHandle.lookup = self._handle.lookup;
  newHandle.bind = self._handle.bind;
  newHandle.send = self._handle.send;
  newHandle.owner = self;

  // Replace the existing handle by the handle we got from master.
  self._handle.close();
  self._handle = newHandle;
}

Socket.prototype.bind = function(/*port, address, callback*/) {
  var self = this;

  self._healthCheck();

  if (this._bindState != BIND_STATE_UNBOUND)
    throw new Error(&#39;Socket is already bound&#39;);

  this._bindState = BIND_STATE_BINDING;

  if (typeof arguments[arguments.length - 1] === &#39;function&#39;)
    self.once(&#39;listening&#39;, arguments[arguments.length - 1]);

  var UDP = process.binding(&#39;udp_wrap&#39;).UDP;
  if (arguments[0] instanceof UDP) {
    replaceHandle(self, arguments[0]);
    startListening(self);
    return;
  }

  var port = arguments[0];
  var address = arguments[1];
  if (typeof address === &#39;function&#39;) address = &#39;&#39;;  // a.k.a. &quot;any address&quot;

  // resolve address first
  self._handle.lookup(address, function(err, ip) {
    if (err) {
      self._bindState = BIND_STATE_UNBOUND;
      self.emit(&#39;error&#39;, err);
      return;
    }

    if (!cluster)
      cluster = require(&#39;cluster&#39;);

    if (cluster.isWorker) {
      cluster._getServer(self, ip, port, self.type, -1, function(handle) {
        if (!self._handle)
          // handle has been closed in the mean time.
          return handle.close();

        replaceHandle(self, handle);
        startListening(self);
      });

    } else {
      if (!self._handle)
        return; // handle has been closed in the mean time

      if (self._handle.bind(ip, port || 0, /*flags=*/ 0)) {
        self.emit(&#39;error&#39;, errnoException(process._errno, &#39;bind&#39;));
        self._bindState = BIND_STATE_UNBOUND;
        // Todo: close?
        return;
      }

      startListening(self);
    }
  });
};


// thin wrapper around `send`, here for compatibility with dgram_legacy.js
Socket.prototype.sendto = function(buffer,
                                   offset,
                                   length,
                                   port,
                                   address,
                                   callback) {
  if (typeof offset !== &#39;number&#39; || typeof length !== &#39;number&#39;)
    throw new Error(&#39;send takes offset and length as args 2 and 3&#39;);

  if (typeof address !== &#39;string&#39;)
    throw new Error(this.type + &#39; sockets must send to port, address&#39;);

  this.send(buffer, offset, length, port, address, callback);
};


Socket.prototype.send = function(buffer,
                                 offset,
                                 length,
                                 port,
                                 address,
                                 callback) {
  var self = this;

  if (!Buffer.isBuffer(buffer))
    throw new TypeError(&#39;First argument must be a buffer object.&#39;);

  offset = offset | 0;
  if (offset &lt; 0)
    throw new RangeError(&#39;Offset should be &gt;= 0&#39;);

  if (offset &gt;= buffer.length)
    throw new RangeError(&#39;Offset into buffer too large&#39;);

  // Sending a zero-length datagram is kind of pointless but it _is_
  // allowed, hence check that length &gt;= 0 rather than &gt; 0.
  length = length | 0;
  if (length &lt; 0)
    throw new RangeError(&#39;Length should be &gt;= 0&#39;);

  if (offset + length &gt; buffer.length)
    throw new RangeError(&#39;Offset + length beyond buffer length&#39;);

  port = port | 0;
  if (port &lt;= 0 || port &gt; 65535)
    throw new RangeError(&#39;Port should be &gt; 0 and &lt; 65536&#39;);

  callback = callback || noop;

  self._healthCheck();

  if (self._bindState == BIND_STATE_UNBOUND)
    self.bind(0, null);

  // If the socket hasn&#39;t been bound yet, push the outbound packet onto the
  // send queue and send after binding is complete.
  if (self._bindState != BIND_STATE_BOUND) {
    // If the send queue hasn&#39;t been initialized yet, do it, and install an
    // event handler that flushes the send queue after binding is done.
    if (!self._sendQueue) {
      self._sendQueue = [];
      self.once(&#39;listening&#39;, function() {
        // Flush the send queue.
        for (var i = 0; i &lt; self._sendQueue.length; i++)
          self.send.apply(self, self._sendQueue[i]);
        self._sendQueue = undefined;
      });
    }
    self._sendQueue.push([buffer, offset, length, port, address, callback]);
    return;
  }

  self._handle.lookup(address, function(err, ip) {
    if (err) {
      if (callback) callback(err);
      self.emit(&#39;error&#39;, err);
    }
    else if (self._handle) {
      var req = self._handle.send(buffer, offset, length, port, ip);
      if (req) {
        req.oncomplete = afterSend;
        req.cb = callback;
      }
      else {
        // don&#39;t emit as error, dgram_legacy.js compatibility
        var err = errnoException(process._errno, &#39;send&#39;);
        process.nextTick(function() {
          callback(err);
        });
      }
    }
  });
};


function afterSend(status, handle, req, buffer) {
  var self = handle.owner;

  if (req.cb)
    req.cb(null, buffer.length); // compatibility with dgram_legacy.js
}


Socket.prototype.close = function() {
  this._healthCheck();
  this._stopReceiving();
  this._handle.close();
  this._handle = null;
  this.emit(&#39;close&#39;);
};


Socket.prototype.address = function() {
  this._healthCheck();

  var address = this._handle.getsockname();
  if (!address)
    throw errnoException(process._errno, &#39;getsockname&#39;);

  return address;
};


Socket.prototype.setBroadcast = function(arg) {
  if (this._handle.setBroadcast((arg) ? 1 : 0)) {
    throw errnoException(process._errno, &#39;setBroadcast&#39;);
  }
};


Socket.prototype.setTTL = function(arg) {
  if (typeof arg !== &#39;number&#39;) {
    throw new TypeError(&#39;Argument must be a number&#39;);
  }

  if (this._handle.setTTL(arg)) {
    throw errnoException(process._errno, &#39;setTTL&#39;);
  }

  return arg;
};


Socket.prototype.setMulticastTTL = function(arg) {
  if (typeof arg !== &#39;number&#39;) {
    throw new TypeError(&#39;Argument must be a number&#39;);
  }

  if (this._handle.setMulticastTTL(arg)) {
    throw errnoException(process._errno, &#39;setMulticastTTL&#39;);
  }

  return arg;
};


Socket.prototype.setMulticastLoopback = function(arg) {
  arg = arg ? 1 : 0;

  if (this._handle.setMulticastLoopback(arg)) {
    throw errnoException(process._errno, &#39;setMulticastLoopback&#39;);
  }

  return arg; // 0.4 compatibility
};


Socket.prototype.addMembership = function(multicastAddress,
                                          interfaceAddress) {
  this._healthCheck();

  if (!multicastAddress) {
    throw new Error(&#39;multicast address must be specified&#39;);
  }

  if (this._handle.addMembership(multicastAddress, interfaceAdd</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in43_link" href="javascript:jShowHide('in43');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/crypto.js">/manta/public/examples/node-v0.10.17/lib/crypto.js</a>
<br />
<div id="in43_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

// Note: In 0.8 and before, crypto functions all defaulted to using
// binary-encoded strings rather than buffers.

exports.DEFAULT_ENCODING = &#39;buffer&#39;;

try {
  var binding = process.binding(&#39;crypto&#39;);
  var SecureContext = binding.SecureContext;
  var randomBytes = binding.randomBytes;
  var pseudoRandomBytes = binding.pseudoRandomBytes;
  var getCiphers = binding.getCiphers;
  var getHashes = binding.getHashes;
  var crypto = true;
} catch (e) {

  var crypto = false;
}

var stream = require(&#39;stream&#39;);
var util = require(&#39;util&#39;);

// This is here because many functions accepted binary strings without
// any explicit encoding in older versions of node, and we don&#39;t want
// to break them unnecessarily.
function toBuf(str, encoding) {
  encoding = encoding || &#39;binary&#39;;
  if (typeof str === &#39;string&#39;) {
    if (encoding === &#39;buffer&#39;)
      encoding = &#39;binary&#39;;
    str = new Buffer(str, encoding);
  }
  return str;
}


var assert = require(&#39;assert&#39;);
var StringDecoder = require(&#39;string_decoder&#39;).StringDecoder;

function Credentials(secureProtocol, flags, context) {
  if (!(this instanceof Credentials)) {
    return new Credentials(secureProtocol, flags, context);
  }

  if (!crypto) {
    throw new Error(&#39;node.js not compiled with openssl crypto support.&#39;);
  }

  if (context) {
    this.context = context;
  } else {
    this.context = new SecureContext();

    if (secureProtocol) {
      this.context.init(secureProtocol);
    } else {
      this.context.init();
    }
  }

  if (flags) this.context.setOptions(flags);
}

exports.Credentials = Credentials;


exports.createCredentials = function(options, context) {
  if (!options) options = {};

  var c = new Credentials(options.secureProtocol,
                          options.secureOptions,
                          context);

  if (context) return c;

  if (options.key) {
    if (options.passphrase) {
      c.context.setKey(options.key, options.passphrase);
    } else {
      c.context.setKey(options.key);
    }
  }

  if (options.cert) c.context.setCert(options.cert);

  if (options.ciphers) c.context.setCiphers(options.ciphers);

  if (options.ca) {
    if (Array.isArray(options.ca)) {
      for (var i = 0, len = options.ca.length; i &lt; len; i++) {
        c.context.addCACert(options.ca[i]);
      }
    } else {
      c.context.addCACert(options.ca);
    }
  } else {
    c.context.addRootCerts();
  }

  if (options.crl) {
    if (Array.isArray(options.crl)) {
      for (var i = 0, len = options.crl.length; i &lt; len; i++) {
        c.context.addCRL(options.crl[i]);
      }
    } else {
      c.context.addCRL(options.crl);
    }
  }

  if (options.sessionIdContext) {
    c.context.setSessionIdContext(options.sessionIdContext);
  }

  if (options.pfx) {
    var pfx = options.pfx;
    var passphrase = options.passphrase;

    pfx = toBuf(pfx);
    if (passphrase)
      passphrase = toBuf(passphrase);

    if (passphrase) {
      c.context.loadPKCS12(pfx, passphrase);
    } else {
      c.context.loadPKCS12(pfx);
    }
  }

  return c;
};


function LazyTransform(options) {
  this._options = options;
}
util.inherits(LazyTransform, stream.Transform);

[
  &#39;_readableState&#39;,
  &#39;_writableState&#39;,
  &#39;_transformState&#39;
].forEach(function(prop, i, props) {
  Object.defineProperty(LazyTransform.prototype, prop, {
    get: function() {
      stream.Transform.call(this, this._options);
      this._writableState.decodeStrings = false;
      this._writableState.defaultEncoding = &#39;binary&#39;;
      return this[prop];
    },
    set: function(val) {
      Object.defineProperty(this, prop, {
        value: val,
        enumerable: true,
        configurable: true,
        writable: true
      });
    },
    configurable: true,
    enumerable: true
  });
});


exports.createHash = exports.Hash = Hash;
function Hash(algorithm, options) {
  if (!(this instanceof Hash))
    return new Hash(algorithm, options);
  this._binding = new binding.Hash(algorithm);
  LazyTransform.call(this, options);
}

util.inherits(Hash, LazyTransform);

Hash.prototype._transform = function(chunk, encoding, callback) {
  this._binding.update(chunk, encoding);
  callback();
};

Hash.prototype._flush = function(callback) {
  var encoding = this._readableState.encoding || &#39;buffer&#39;;
  this.push(this._binding.digest(encoding), encoding);
  callback();
};

Hash.prototype.update = function(data, encoding) {
  encoding = encoding || exports.DEFAULT_ENCODING;
  if (encoding === &#39;buffer&#39; &amp;&amp; typeof data === &#39;string&#39;)
    encoding = &#39;binary&#39;;
  this._binding.update(data, encoding);
  return this;
};


Hash.prototype.digest = function(outputEncoding) {
  outputEncoding = outputEncoding || exports.DEFAULT_ENCODING;
  return this._binding.digest(outputEncoding);
};


exports.createHmac = exports.Hmac = Hmac;

function Hmac(hmac, key, options) {
  if (!(this instanceof Hmac))
    return new Hmac(hmac, key, options);
  this._binding = new binding.Hmac();
  this._binding.init(hmac, toBuf(key));
  LazyTransform.call(this, options);
}

util.inherits(Hmac, LazyTransform);

Hmac.prototype.update = Hash.prototype.update;
Hmac.prototype.digest = Hash.prototype.digest;
Hmac.prototype._flush = Hash.prototype._flush;
Hmac.prototype._transform = Hash.prototype._transform;


function getDecoder(decoder, encoding) {
  if (encoding === &#39;utf-8&#39;) encoding = &#39;utf8&#39;;  // Normalize encoding.
  decoder = decoder || new StringDecoder(encoding);
  assert(decoder.encoding === encoding, &#39;Cannot change encoding&#39;);
  return decoder;
}


exports.createCipher = exports.Cipher = Cipher;
function Cipher(cipher, password, options) {
  if (!(this instanceof Cipher))
    return new Cipher(cipher, password, options);
  this._binding = new binding.Cipher;

  this._binding.init(cipher, toBuf(password));
  this._decoder = null;

  LazyTransform.call(this, options);
}

util.inherits(Cipher, LazyTransform);

Cipher.prototype._transform = function(chunk, encoding, callback) {
  this.push(this._binding.update(chunk, encoding));
  callback();
};

Cipher.prototype._flush = function(callback) {
  this.push(this._binding.final());
  callback();
};

Cipher.prototype.update = function(data, inputEncoding, outputEncoding) {
  inputEncoding = inputEncoding || exports.DEFAULT_ENCODING;
  outputEncoding = outputEncoding || exports.DEFAULT_ENCODING;

  var ret = this._binding.update(data, inputEncoding);

  if (outputEncoding &amp;&amp; outputEncoding !== &#39;buffer&#39;) {
    this._decoder = getDecoder(this._decoder, outputEncoding);
    ret = this._decoder.write(ret);
  }

  return ret;
};


Cipher.prototype.final = function(outputEncoding) {
  outputEncoding = outputEncoding || exports.DEFAULT_ENCODING;
  var ret = this._binding.final();

  if (outputEncoding &amp;&amp; outputEncoding !== &#39;buffer&#39;) {
    this._decoder = getDecoder(this._decoder, outputEncoding);
    ret = this._decoder.end(ret);
  }

  return ret;
};


Cipher.prototype.setAutoPadding = function(ap) {
  this._binding.setAutoPadding(ap);
  return this;
};



exports.createCipheriv = exports.Cipheriv = Cipheriv;
function Cipheriv(cipher, key, iv, options) {
  if (!(this instanceof Cipheriv))
    return new Cipheriv(cipher, key, iv, options);
  this._binding = new binding.Cipher();
  this._binding.initiv(cipher, toBuf(key), toBuf(iv));
  this._decoder = null;

  LazyTransform.call(this, options);
}

util.inherits(Cipheriv, LazyTransform);

Cipheriv.prototype._transform = Cipher.prototype._transform;
Cipheriv.prototype._flush = Cipher.prototype._flush;
Cipheriv.prototype.update = Cipher.prototype.update;
Cipheriv.prototype.final = Cipher.prototype.final;
Cipheriv.prototype.setAutoPadding = Cipher.prototype.setAutoPadding;



exports.createDecipher = exports.Decipher = Decipher;
function Decipher(cipher, password, options) {
  if (!(this instanceof Decipher))
    return new Decipher(cipher, password, options);

  this._binding = new binding.Decipher;
  this._binding.init(cipher, toBuf(password));
  this._decoder = null;

  LazyTransform.call(this, options);
}

util.inherits(Decipher, LazyTransform);

Decipher.prototype._transform = Cipher.prototype._transform;
Decipher.prototype._flush = Cipher.prototype._flush;
Decipher.prototype.update = Cipher.prototype.update;
Decipher.prototype.final = Cipher.prototype.final;
Decipher.prototype.finaltol = Cipher.prototype.final;
Decipher.prototype.setAutoPadding = Cipher.prototype.setAutoPadding;



exports.createDecipheriv = exports.Decipheriv = Decipheriv;
function Decipheriv(cipher, key, iv, options) {
  if (!(this instanceof Decipheriv))
    return new Decipheriv(cipher, key, iv, options);

  this._binding = new binding.Decipher;
  this._binding.initiv(cipher, toBuf(key), toBuf(iv));
  this._decoder = null;

  LazyTransform.call(this, options);
}

util.inherits(Decipheriv, LazyTransform);

Decipheriv.prototype._transform = Cipher.prototype._transform;
Decipheriv.prototype._flush = Cipher.prototype._flush;
Decipheriv.prototype.update = Cipher.prototype.update;
Decipheriv.prototype.final = Cipher.prototype.final;
Decipheriv.prototype.finaltol = Cipher.prototype.final;
Decipheriv.prototype.setAutoPadding = Cipher.prototype.</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in44_link" href="javascript:jShowHide('in44');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/events.js">/manta/public/examples/node-v0.10.17/lib/events.js</a>
<br />
<div id="in44_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var domain;

exports.usingDomains = false;

function EventEmitter() {
  this.domain = null;
  if (exports.usingDomains) {
    // if there is an active domain, then attach to it.
    domain = domain || require(&#39;domain&#39;);
    if (domain.active &amp;&amp; !(this instanceof domain.Domain)) {
      this.domain = domain.active;
    }
  }
  this._events = this._events || {};
  this._maxListeners = this._maxListeners || defaultMaxListeners;
}
exports.EventEmitter = EventEmitter;

// By default EventEmitters will print a warning if more than
// 10 listeners are added to it. This is a useful default which
// helps finding memory leaks.
//
// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
var defaultMaxListeners = 10;
EventEmitter.prototype.setMaxListeners = function(n) {
  if (typeof n !== &#39;number&#39; || n &lt; 0)
    throw TypeError(&#39;n must be a positive number&#39;);
  this._maxListeners = n;
};

EventEmitter.prototype.emit = function(type) {
  var er, handler, len, args, i, listeners;

  if (!this._events)
    this._events = {};

  // If there is no &#39;error&#39; event listener then throw.
  if (type === &#39;error&#39;) {
    if (!this._events.error ||
        (typeof this._events.error === &#39;object&#39; &amp;&amp;
         !this._events.error.length)) {
      er = arguments[1];
      if (this.domain) {
        if (!er) er = new TypeError(&#39;Uncaught, unspecified &quot;error&quot; event.&#39;);
        er.domainEmitter = this;
        er.domain = this.domain;
        er.domainThrown = false;
        this.domain.emit(&#39;error&#39;, er);
      } else if (er instanceof Error) {
        throw er; // Unhandled &#39;error&#39; event
      } else {
        throw TypeError(&#39;Uncaught, unspecified &quot;error&quot; event.&#39;);
      }
      return false;
    }
  }

  handler = this._events[type];

  if (typeof handler === &#39;undefined&#39;)
    return false;

  if (this.domain &amp;&amp; this !== process)
    this.domain.enter();

  if (typeof handler === &#39;function&#39;) {
    switch (arguments.length) {
      // fast cases
      case 1:
        handler.call(this);
        break;
      case 2:
        handler.call(this, arguments[1]);
        break;
      case 3:
        handler.call(this, arguments[1], arguments[2]);
        break;
      // slower
      default:
        len = arguments.length;
        args = new Array(len - 1);
        for (i = 1; i &lt; len; i++)
          args[i - 1] = arguments[i];
        handler.apply(this, args);
    }
  } else if (typeof handler === &#39;object&#39;) {
    len = arguments.length;
    args = new Array(len - 1);
    for (i = 1; i &lt; len; i++)
      args[i - 1] = arguments[i];

    listeners = handler.slice();
    len = listeners.length;
    for (i = 0; i &lt; len; i++)
      listeners[i].apply(this, args);
  }

  if (this.domain &amp;&amp; this !== process)
    this.domain.exit();

  return true;
};

EventEmitter.prototype.addListener = function(type, listener) {
  var m;

  if (typeof listener !== &#39;function&#39;)
    throw TypeError(&#39;listener must be a function&#39;);

  if (!this._events)
    this._events = {};

  // To avoid recursion in the case that type === &quot;newListener&quot;! Before
  // adding it to the listeners, first emit &quot;newListener&quot;.
  if (this._events.newListener)
    this.emit(&#39;newListener&#39;, type, typeof listener.listener === &#39;function&#39; ?
              listener.listener : listener);

  if (!this._events[type])
    // Optimize the case of one listener. Don&#39;t need the extra array object.
    this._events[type] = listener;
  else if (typeof this._events[type] === &#39;object&#39;)
    // If we&#39;ve already got an array, just append.
    this._events[type].push(listener);
  else
    // Adding the second element, need to change to array.
    this._events[type] = [this._events[type], listener];

  // Check for listener leak
  if (typeof this._events[type] === &#39;object&#39; &amp;&amp; !this._events[type].warned) {
    m = this._maxListeners;
    if (m &amp;&amp; m &gt; 0 &amp;&amp; this._events[type].length &gt; m) {
      this._events[type].warned = true;
      console.error(&#39;(node) warning: possible EventEmitter memory &#39; +
                    &#39;leak detected. %d listeners added. &#39; +
                    &#39;Use emitter.setMaxListeners() to increase limit.&#39;,
                    this._events[type].length);
      console.trace();
    }
  }

  return this;
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.once = function(type, listener) {
  if (typeof listener !== &#39;function&#39;)
    throw TypeError(&#39;listener must be a function&#39;);

  function g() {
    this.removeListener(type, g);
    listener.apply(this, arguments);
  }

  g.listener = listener;
  this.on(type, g);

  return this;
};

// emits a &#39;removeListener&#39; event iff the listener was removed
EventEmitter.prototype.removeListener = function(type, listener) {
  var list, position, length, i;

  if (typeof listener !== &#39;function&#39;)
    throw TypeError(&#39;listener must be a function&#39;);

  if (!this._events || !this._events[type])
    return this;

  list = this._events[type];
  length = list.length;
  position = -1;

  if (list === listener ||
      (typeof list.listener === &#39;function&#39; &amp;&amp; list.listener === listener)) {
    delete this._events[type];
    if (this._events.removeListener)
      this.emit(&#39;removeListener&#39;, type, listener);

  } else if (typeof list === &#39;object&#39;) {
    for (i = length; i-- &gt; 0;) {
      if (list[i] === listener ||
          (list[i].listener &amp;&amp; list[i].listener === listener)) {
        position = i;
        break;
      }
    }

    if (position &lt; 0)
      return this;

    if (list.length === 1) {
      list.length = 0;
      delete this._events[type];
    } else {
      list.splice(position, 1);
    }

    if (this._events.removeListener)
      this.emit(&#39;removeListener&#39;, type, listener);
  }

  return this;
};

EventEmitter.prototype.removeAllListeners = function(type) {
  var key, listeners;

  if (!this._events)
    return this;

  // not listening for removeListener, no need to emit
  if (!this._events.removeListener) {
    if (arguments.length === 0)
      this._events = {};
    else if (this._events[type])
      delete this._events[type];
    return this;
  }

  // emit removeListener for all listeners on all events
  if (arguments.length === 0) {
    for (key in this._events) {
      if (key === &#39;removeListener&#39;) continue;
      this.removeAllListeners(key);
    }
    this.removeAllListeners(&#39;removeListener&#39;);
    this._events = {};
    return this;
  }

  listeners = this._events[type];

  if (typeof listeners === &#39;function&#39;) {
    this.removeListener(type, listeners);
  } else {
    // LIFO order
    while (listeners.length)
      this.removeListener(type, listeners[listeners.length - 1]);
  }
  delete this._events[type];

  return this;
};

EventEmitter.prototype.listeners = function(type) {
  var ret;
  if (!this._events || !this._events[type])
    ret = [];
  else if (typeof this._events[type] === &#39;function&#39;)
    ret = [this._events[type]];
  else
    ret = this._events[type].slice();
  return ret;
};

EventEmitter.listenerCount = function(emitter, type) {
  var ret;
  if (!emitter._events || !emitter._events[type])
    ret = 0;
  else if (typeof emitter._events[type] === &#39;function&#39;)
    ret = 1;
  else
    ret = emitter._events[type].length;
  return ret;
};
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in45_link" href="javascript:jShowHide('in45');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/domain.js">/manta/public/examples/node-v0.10.17/lib/domain.js</a>
<br />
<div id="in45_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var util = require(&#39;util&#39;);
var events = require(&#39;events&#39;);
var EventEmitter = events.EventEmitter;
var inherits = util.inherits;

// methods that are called when trying to shut down expliclitly bound EEs
var endMethods = [&#39;end&#39;, &#39;abort&#39;, &#39;destroy&#39;, &#39;destroySoon&#39;];

// communicate with events module, but don&#39;t require that
// module to have to load this one, since this module has
// a few side effects.
events.usingDomains = true;

// let the process know we&#39;re using domains
process._usingDomains();

exports.Domain = Domain;

exports.create = exports.createDomain = function(cb) {
  return new Domain(cb);
};

// it&#39;s possible to enter one domain while already inside
// another one.  the stack is each entered domain.
var stack = [];
exports._stack = stack;
// the active domain is always the one that we&#39;re currently in.
exports.active = null;


inherits(Domain, EventEmitter);

function Domain() {
  EventEmitter.call(this);

  this.members = [];
}

Domain.prototype.enter = function() {
  if (this._disposed) return;

  // note that this might be a no-op, but we still need
  // to push it onto the stack so that we can pop it later.
  exports.active = process.domain = this;
  stack.push(this);
};

Domain.prototype.exit = function() {
  if (this._disposed) return;

  // exit all domains until this one.
  var d;
  do {
    d = stack.pop();
  } while (d &amp;&amp; d !== this);

  exports.active = stack[stack.length - 1];
  process.domain = exports.active;
};

// note: this works for timers as well.
Domain.prototype.add = function(ee) {
  // disposed domains can&#39;t be used for new things.
  if (this._disposed) return;

  // already added to this domain.
  if (ee.domain === this) return;

  // has a domain already - remove it first.
  if (ee.domain) {
    ee.domain.remove(ee);
  }

  // check for circular Domain-&gt;Domain links.
  // This causes bad insanity!
  //
  // For example:
  // var d = domain.create();
  // var e = domain.create();
  // d.add(e);
  // e.add(d);
  // e.emit(&#39;error&#39;, er); // RangeError, stack overflow!
  if (this.domain &amp;&amp; (ee instanceof Domain)) {
    for (var d = this.domain; d; d = d.domain) {
      if (ee === d) return;
    }
  }

  ee.domain = this;
  this.members.push(ee);
};

Domain.prototype.remove = function(ee) {
  ee.domain = null;
  var index = this.members.indexOf(ee);
  if (index !== -1) {
    this.members.splice(index, 1);
  }
};

Domain.prototype.run = function(fn) {
  return this.bind(fn)();
};

Domain.prototype.intercept = function(cb) {
  return this.bind(cb, true);
};

Domain.prototype.bind = function(cb, interceptError) {
  // if cb throws, catch it here.
  var self = this;
  var b = function() {
    // disposing turns functions into no-ops
    if (self._disposed) return;

    if (this instanceof Domain) {
      return cb.apply(this, arguments);
    }

    // only intercept first-arg errors if explicitly requested.
    if (interceptError &amp;&amp; arguments[0] &amp;&amp;
        (arguments[0] instanceof Error)) {
      var er = arguments[0];
      util._extend(er, {
        domainBound: cb,
        domainThrown: false,
        domain: self
      });
      self.emit(&#39;error&#39;, er);
      return;
    }

    // remove first-arg if intercept as assumed to be the error-arg
    if (interceptError) {
      var len = arguments.length;
      var args;
      switch (len) {
        case 0:
        case 1:
          // no args that we care about.
          args = [];
          break;
        case 2:
          // optimization for most common case: cb(er, data)
          args = [arguments[1]];
          break;
        default:
          // slower for less common case: cb(er, foo, bar, baz, ...)
          args = new Array(len - 1);
          for (var i = 1; i &lt; len; i++) {
            args[i - 1] = arguments[i];
          }
          break;
      }
      self.enter();
      var ret = cb.apply(this, args);
      self.exit();
      return ret;
    }

    self.enter();
    var ret = cb.apply(this, arguments);
    self.exit();
    return ret;
  };
  b.domain = this;
  return b;
};

Domain.prototype.dispose = function() {
  if (this._disposed) return;

  // if we&#39;re the active domain, then get out now.
  this.exit();

  this.emit(&#39;dispose&#39;);

  // remove error handlers.
  this.removeAllListeners();
  this.on(&#39;error&#39;, function() {});

  // try to kill all the members.
  // XXX There should be more consistent ways
  // to shut down things!
  this.members.forEach(function(m) {
    // if it&#39;s a timeout or interval, cancel it.
    clearTimeout(m);

    // drop all event listeners.
    if (m instanceof EventEmitter) {
      m.removeAllListeners();
      // swallow errors
      m.on(&#39;error&#39;, function() {});
    }

    // Be careful!
    // By definition, we&#39;re likely in error-ridden territory here,
    // so it&#39;s quite possible that calling some of these methods
    // might cause additional exceptions to be thrown.
    endMethods.forEach(function(method) {
      if (typeof m[method] === &#39;function&#39;) {
        try {
          m[method]();
        } catch (er) {}
      }
    });

  });

  // remove from parent domain, if there is one.
  if (this.domain) this.domain.remove(this);

  // kill the references so that they can be properly gc&#39;ed.
  this.members.length = 0;

  // finally, mark this domain as &#39;no longer relevant&#39;
  // so that it can&#39;t be entered or activated.
  this._disposed = true;
};
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in46_link" href="javascript:jShowHide('in46');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/dns.js">/manta/public/examples/node-v0.10.17/lib/dns.js</a>
<br />
<div id="in46_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &#39;Software&#39;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &#39;AS IS&#39;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var cares = process.binding(&#39;cares_wrap&#39;),
    net = require(&#39;net&#39;),
    isIp = net.isIP;


function errnoException(errorno, syscall) {
  // TODO make this more compatible with ErrnoException from src/node.cc
  // Once all of Node is using this function the ErrnoException from
  // src/node.cc should be removed.

  // For backwards compatibility. libuv returns ENOENT on NXDOMAIN.
  if (errorno == &#39;ENOENT&#39;) {
    errorno = &#39;ENOTFOUND&#39;;
  }

  var e = new Error(syscall + &#39; &#39; + errorno);

  e.errno = e.code = errorno;
  e.syscall = syscall;
  return e;
}


// c-ares invokes a callback either synchronously or asynchronously,
// but the dns API should always invoke a callback asynchronously.
//
// This function makes sure that the callback is invoked asynchronously.
// It returns a function that invokes the callback within nextTick().
//
// To avoid invoking unnecessary nextTick(), `immediately` property of
// returned function should be set to true after c-ares returned.
//
// Usage:
//
// function someAPI(callback) {
//   callback = makeAsync(callback);
//   channel.someAPI(..., callback);
//   callback.immediately = true;
// }
function makeAsync(callback) {
  if (typeof callback !== &#39;function&#39;) {
    return callback;
  }
  return function asyncCallback() {
    if (asyncCallback.immediately) {
      // The API already returned, we can invoke the callback immediately.
      callback.apply(null, arguments);
    } else {
      var args = arguments;
      process.nextTick(function() {
        callback.apply(null, args);
      });
    }
  };
}


// Easy DNS A/AAAA look up
// lookup(domain, [family,] callback)
exports.lookup = function(domain, family, callback) {
  // parse arguments
  if (arguments.length === 2) {
    callback = family;
    family = 0;
  } else if (!family) {
    family = 0;
  } else {
    family = +family;
    if (family !== 4 &amp;&amp; family !== 6) {
      throw new Error(&#39;invalid argument: `family` must be 4 or 6&#39;);
    }
  }
  callback = makeAsync(callback);

  if (!domain) {
    callback(null, null, family === 6 ? 6 : 4);
    return {};
  }

  // Hack required for Windows because Win7 removed the
  // localhost entry from c:\WINDOWS\system32\drivers\etc\hosts
  // See http://daniel.haxx.se/blog/2011/02/21/localhost-hack-on-windows/
  // TODO Remove this once c-ares handles this problem.
  if (process.platform == &#39;win32&#39; &amp;&amp; domain == &#39;localhost&#39;) {
    callback(null, &#39;127.0.0.1&#39;, 4);
    return {};
  }

  var matchedFamily = net.isIP(domain);
  if (matchedFamily) {
    callback(null, domain, matchedFamily);
    return {};
  }

  function onanswer(addresses) {
    if (addresses) {
      if (family) {
        callback(null, addresses[0], family);
      } else {
        callback(null, addresses[0], addresses[0].indexOf(&#39;:&#39;) &gt;= 0 ? 6 : 4);
      }
    } else {
      callback(errnoException(process._errno, &#39;getaddrinfo&#39;));
    }
  }

  var wrap = cares.getaddrinfo(domain, family);

  if (!wrap) {
    throw errnoException(process._errno, &#39;getaddrinfo&#39;);
  }

  wrap.oncomplete = onanswer;

  callback.immediately = true;
  return wrap;
};


function resolver(bindingName) {
  var binding = cares[bindingName];

  return function query(name, callback) {
    function onanswer(status, result) {
      if (!status) {
        callback(null, result);
      } else {
        callback(errnoException(process._errno, bindingName));
      }
    }

    callback = makeAsync(callback);
    var wrap = binding(name, onanswer);
    if (!wrap) {
      throw errnoException(process._errno, bindingName);
    }

    callback.immediately = true;
    return wrap;
  }
}


var resolveMap = {};
exports.resolve4 = resolveMap.A = resolver(&#39;queryA&#39;);
exports.resolve6 = resolveMap.AAAA = resolver(&#39;queryAaaa&#39;);
exports.resolveCname = resolveMap.CNAME = resolver(&#39;queryCname&#39;);
exports.resolveMx = resolveMap.MX = resolver(&#39;queryMx&#39;);
exports.resolveNs = resolveMap.NS = resolver(&#39;queryNs&#39;);
exports.resolveTxt = resolveMap.TXT = resolver(&#39;queryTxt&#39;);
exports.resolveSrv = resolveMap.SRV = resolver(&#39;querySrv&#39;);
exports.resolveNaptr = resolveMap.NAPTR = resolver(&#39;queryNaptr&#39;);
exports.reverse = resolveMap.PTR = resolver(&#39;getHostByAddr&#39;);


exports.resolve = function(domain, type_, callback_) {
  var resolver, callback;
  if (typeof type_ == &#39;string&#39;) {
    resolver = resolveMap[type_];
    callback = callback_;
  } else {
    resolver = exports.resolve4;
    callback = type_;
  }

  if (typeof resolver === &#39;function&#39;) {
    return resolver(domain, callback);
  } else {
    throw new Error(&#39;Unknown type &quot;&#39; + type_ + &#39;&quot;&#39;);
  }
};


// ERROR CODES
exports.NODATA = &#39;ENODATA&#39;;
exports.FORMERR = &#39;EFORMERR&#39;;
exports.SERVFAIL = &#39;ESERVFAIL&#39;;
exports.NOTFOUND = &#39;ENOTFOUND&#39;;
exports.NOTIMP = &#39;ENOTIMP&#39;;
exports.REFUSED = &#39;EREFUSED&#39;;
exports.BADQUERY = &#39;EBADQUERY&#39;;
exports.ADNAME = &#39;EADNAME&#39;;
exports.BADFAMILY = &#39;EBADFAMILY&#39;;
exports.BADRESP = &#39;EBADRESP&#39;;
exports.CONNREFUSED = &#39;ECONNREFUSED&#39;;
exports.TIMEOUT = &#39;ETIMEOUT&#39;;
exports.EOF = &#39;EOF&#39;;
exports.FILE = &#39;EFILE&#39;;
exports.NOMEM = &#39;ENOMEM&#39;;
exports.DESTRUCTION = &#39;EDESTRUCTION&#39;;
exports.BADSTR = &#39;EBADSTR&#39;;
exports.BADFLAGS = &#39;EBADFLAGS&#39;;
exports.NONAME = &#39;ENONAME&#39;;
exports.BADHINTS = &#39;EBADHINTS&#39;;
exports.NOTINITIALIZED = &#39;ENOTINITIALIZED&#39;;
exports.LOADIPHLPAPI = &#39;ELOADIPHLPAPI&#39;;
exports.ADDRGETNETWORKPARAMS = &#39;EADDRGETNETWORKPARAMS&#39;;
exports.CANCELLED = &#39;ECANCELLED&#39;;
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in47_link" href="javascript:jShowHide('in47');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/freelist.js">/manta/public/examples/node-v0.10.17/lib/freelist.js</a>
<br />
<div id="in47_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

// This is a free list to avoid creating so many of the same object.
exports.FreeList = function(name, max, constructor) {
  this.name = name;
  this.constructor = constructor;
  this.max = max;
  this.list = [];
};


exports.FreeList.prototype.alloc = function() {
  //debug(&quot;alloc &quot; + this.name + &quot; &quot; + this.list.length);
  return this.list.length ? this.list.shift() :
                            this.constructor.apply(this, arguments);
};


exports.FreeList.prototype.free = function(obj) {
  //debug(&quot;free &quot; + this.name + &quot; &quot; + this.list.length);
  if (this.list.length &lt; this.max) {
    this.list.push(obj);
  }
};
</code></pre>
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in48_link" href="javascript:jShowHide('in48');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/http.js">/manta/public/examples/node-v0.10.17/lib/http.js</a>
<br />
<div id="in48_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var util = require(&#39;util&#39;);
var net = require(&#39;net&#39;);
var Stream = require(&#39;stream&#39;);
var timers = require(&#39;timers&#39;);
var url = require(&#39;url&#39;);
var EventEmitter = require(&#39;events&#39;).EventEmitter;
var FreeList = require(&#39;freelist&#39;).FreeList;
var HTTPParser = process.binding(&#39;http_parser&#39;).HTTPParser;
var assert = require(&#39;assert&#39;).ok;

var debug;
if (process.env.NODE_DEBUG &amp;&amp; /http/.test(process.env.NODE_DEBUG)) {
  debug = function(x) { console.error(&#39;HTTP: %s&#39;, x); };
} else {
  debug = function() { };
}

function readStart(socket) {
  if (!socket || !socket._handle || !socket._handle.readStart) return;
  socket._handle.readStart();
}

function readStop(socket) {
  if (!socket || !socket._handle || !socket._handle.readStop) return;
  socket._handle.readStop();
}

// Only called in the slow case where slow means
// that the request headers were either fragmented
// across multiple TCP packets or too large to be
// processed in a single run. This method is also
// called to process trailing HTTP headers.
function parserOnHeaders(headers, url) {
  // Once we exceeded headers limit - stop collecting them
  if (this.maxHeaderPairs &lt;= 0 ||
      this._headers.length &lt; this.maxHeaderPairs) {
    this._headers = this._headers.concat(headers);
  }
  this._url += url;
}

// info.headers and info.url are set only if .onHeaders()
// has not been called for this request.
//
// info.url is not set for response parsers but that&#39;s not
// applicable here since all our parsers are request parsers.
function parserOnHeadersComplete(info) {
  var parser = this;
  var headers = info.headers;
  var url = info.url;

  if (!headers) {
    headers = parser._headers;
    parser._headers = [];
  }

  if (!url) {
    url = parser._url;
    parser._url = &#39;&#39;;
  }

  parser.incoming = new IncomingMessage(parser.socket);
  parser.incoming.httpVersionMajor = info.versionMajor;
  parser.incoming.httpVersionMinor = info.versionMinor;
  parser.incoming.httpVersion = info.versionMajor + &#39;.&#39; + info.versionMinor;
  parser.incoming.url = url;

  var n = headers.length;

  // If parser.maxHeaderPairs &lt;= 0 - assume that there&#39;re no limit
  if (parser.maxHeaderPairs &gt; 0) {
    n = Math.min(n, parser.maxHeaderPairs);
  }

  for (var i = 0; i &lt; n; i += 2) {
    var k = headers[i];
    var v = headers[i + 1];
    parser.incoming._addHeaderLine(k, v);
  }


  if (info.method) {
    // server only
    parser.incoming.method = info.method;
  } else {
    // client only
    parser.incoming.statusCode = info.statusCode;
    // CHECKME dead code? we&#39;re always a request parser
  }

  parser.incoming.upgrade = info.upgrade;

  var skipBody = false; // response to HEAD or CONNECT

  if (!info.upgrade) {
    // For upgraded connections and CONNECT method request,
    // we&#39;ll emit this after parser.execute
    // so that we can capture the first part of the new protocol
    skipBody = parser.onIncoming(parser.incoming, info.shouldKeepAlive);
  }

  return skipBody;
}

// XXX This is a mess.
// TODO: http.Parser should be a Writable emits request/response events.
function parserOnBody(b, start, len) {
  var parser = this;
  var stream = parser.incoming;

  // if the stream has already been removed, then drop it.
  if (!stream)
    return;

  var socket = stream.socket;

  // pretend this was the result of a stream._read call.
  if (len &gt; 0 &amp;&amp; !stream._dumped) {
    var slice = b.slice(start, start + len);
    var ret = stream.push(slice);
    if (!ret)
      readStop(socket);
  }
}

function parserOnMessageComplete() {
  var parser = this;
  var stream = parser.incoming;

  if (stream) {
    stream.complete = true;
    // Emit any trailing headers.
    var headers = parser._headers;
    if (headers) {
      for (var i = 0, n = headers.length; i &lt; n; i += 2) {
        var k = headers[i];
        var v = headers[i + 1];
        parser.incoming._addHeaderLine(k, v);
      }
      parser._headers = [];
      parser._url = &#39;&#39;;
    }

    if (!stream.upgrade)
      // For upgraded connections, also emit this after parser.execute
      stream.push(null);
  }

  if (stream &amp;&amp; !parser.incoming._pendings.length) {
    // For emit end event
    stream.push(null);
  }

  if (parser.socket.readable) {
    // force to read the next incoming message
    readStart(parser.socket);
  }
}


var parsers = new FreeList(&#39;parsers&#39;, 1000, function() {
  var parser = new HTTPParser(HTTPParser.REQUEST);

  parser._headers = [];
  parser._url = &#39;&#39;;

  // Only called in the slow case where slow means
  // that the request headers were either fragmented
  // across multiple TCP packets or too large to be
  // processed in a single run. This method is also
  // called to process trailing HTTP headers.
  parser.onHeaders = parserOnHeaders;
  parser.onHeadersComplete = parserOnHeadersComplete;
  parser.onBody = parserOnBody;
  parser.onMessageComplete = parserOnMessageComplete;

  return parser;
});
exports.parsers = parsers;


var CRLF = &#39;\r\n&#39;;
var STATUS_CODES = exports.STATUS_CODES = {
  100 : &#39;Continue&#39;,
  101 : &#39;Switching Protocols&#39;,
  102 : &#39;Processing&#39;,                 // RFC 2518, obsoleted by RFC 4918
  200 : &#39;OK&#39;,
  201 : &#39;Created&#39;,
  202 : &#39;Accepted&#39;,
  203 : &#39;Non-Authoritative Information&#39;,
  204 : &#39;No Content&#39;,
  205 : &#39;Reset Content&#39;,
  206 : &#39;Partial Content&#39;,
  207 : &#39;Multi-Status&#39;,               // RFC 4918
  300 : &#39;Multiple Choices&#39;,
  301 : &#39;Moved Permanently&#39;,
  302 : &#39;Moved Temporarily&#39;,
  303 : &#39;See Other&#39;,
  304 : &#39;Not Modified&#39;,
  305 : &#39;Use Proxy&#39;,
  307 : &#39;Temporary Redirect&#39;,
  400 : &#39;Bad Request&#39;,
  401 : &#39;Unauthorized&#39;,
  402 : &#39;Payment Required&#39;,
  403 : &#39;Forbidden&#39;,
  404 : &#39;Not Found&#39;,
  405 : &#39;Method Not Allowed&#39;,
  406 : &#39;Not Acceptable&#39;,
  407 : &#39;Proxy Authentication Required&#39;,
  408 : &#39;Request Time-out&#39;,
  409 : &#39;Conflict&#39;,
  410 : &#39;Gone&#39;,
  411 : &#39;Length Required&#39;,
  412 : &#39;Precondition Failed&#39;,
  413 : &#39;Request Entity Too Large&#39;,
  414 : &#39;Request-URI Too Large&#39;,
  415 : &#39;Unsupported Media Type&#39;,
  416 : &#39;Requested Range Not Satisfiable&#39;,
  417 : &#39;Expectation Failed&#39;,
  418 : &#39;I\&#39;m a teapot&#39;,              // RFC 2324
  422 : &#39;Unprocessable Entity&#39;,       // RFC 4918
  423 : &#39;Locked&#39;,                     // RFC 4918
  424 : &#39;Failed Dependency&#39;,          // RFC 4918
  425 : &#39;Unordered Collection&#39;,       // RFC 4918
  426 : &#39;Upgrade Required&#39;,           // RFC 2817
  428 : &#39;Precondition Required&#39;,      // RFC 6585
  429 : &#39;Too Many Requests&#39;,          // RFC 6585
  431 : &#39;Request Header Fields Too Large&#39;,// RFC 6585
  500 : &#39;Internal Server Error&#39;,
  501 : &#39;Not Implemented&#39;,
  502 : &#39;Bad Gateway&#39;,
  503 : &#39;Service Unavailable&#39;,
  504 : &#39;Gateway Time-out&#39;,
  505 : &#39;HTTP Version Not Supported&#39;,
  506 : &#39;Variant Also Negotiates&#39;,    // RFC 2295
  507 : &#39;Insufficient Storage&#39;,       // RFC 4918
  509 : &#39;Bandwidth Limit Exceeded&#39;,
  510 : &#39;Not Extended&#39;,               // RFC 2774
  511 : &#39;Network Authentication Required&#39; // RFC 6585
};


var connectionExpression = /Connection/i;
var transferEncodingExpression = /Transfer-Encoding/i;
var closeExpression = /close/i;
var chunkExpression = /chunk/i;
var contentLengthExpression = /Content-Length/i;
var dateExpression = /Date/i;
var expectExpression = /Expect/i;
var continueExpression = /100-continue/i;

var dateCache;
function utcDate() {
  if (!dateCache) {
    var d = new Date();
    dateCache = d.toUTCString();
    timers.enroll(utcDate, 1000 - d.getMilliseconds());
    timers._unrefActive(utcDate);
  }
  return dateCache;
}
utcDate._onTimeout = function() {
  dateCache = undefined;
};


/* Abstract base class for ServerRequest and ClientResponse. */
function IncomingMessage(socket) {
  Stream.Readable.call(this);

  // XXX This implementation is kind of all over the place
  // When the parser emits body chunks, they go in this list.
  // _read() pulls them out, and when it finds EOF, it ends.

  this.socket = socket;
  this.connection = socket;

  this.httpVersion = null;
  this.complete = false;
  this.headers = {};
  this.trailers = {};

  this.readable = true;

  this._pendings = [];
  this._pendingIndex = 0;

  // request (server) only
  this.url = &#39;&#39;;
  this.method = null;

  // response (client) only
  this.statusCode = null;
  this.client = this.socket;

  // flag for backwards compatibility grossness.
  this._consuming = false;

  // flag for when we decide that this message cannot possibly be
  // read by the user, so there&#39;s no point continuing to handle it.
  this._dumped = false;
}
util.inherits(IncomingMessage, Stream.Readable);


exports.IncomingMessage = IncomingMessage;


IncomingMessage.prototype.setTimeout = function(msecs, callback) {
  if (callback)
    this.on(&#39;timeout&#39;, callback);
  this.socket.setTimeout(msecs);
};


IncomingMessage.prototype.read = function(n) {
  this._consuming = true;
  this.read = Stream.Readable.prototype.read;
  return this.read(n);
};


IncomingMessage.prototype._read = function(n) {
  // We actually do almost nothing here, because the parserOnBody
  // function fills up our internal buffer directly.  However, we
  // do need to unpause the underlying socket so that it flows.
  if (!this.socket.r</code></pre>
(contents truncated)
</div>
</td>
</tr>
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="in49_link" href="javascript:jShowHide('in49');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/public/examples/node-v0.10.17/lib/https.js">/manta/public/examples/node-v0.10.17/lib/https.js</a>
<br />
<div id="in49_contents" style="display: none" class="jObjectContents"><pre><code>// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

var tls = require(&#39;tls&#39;);
var http = require(&#39;http&#39;);
var util = require(&#39;util&#39;);
var url = require(&#39;url&#39;);
var inherits = require(&#39;util&#39;).inherits;

function Server(opts, requestListener) {
  if (!(this instanceof Server)) return new Server(opts, requestListener);

  if (process.features.tls_npn &amp;&amp; !opts.NPNProtocols) {
    opts.NPNProtocols = [&#39;http/1.1&#39;, &#39;http/1.0&#39;];
  }

  tls.Server.call(this, opts, http._connectionListener);

  this.httpAllowHalfOpen = false;

  if (requestListener) {
    this.addListener(&#39;request&#39;, requestListener);
  }

  this.addListener(&#39;clientError&#39;, function(err, conn) {
    conn.destroy(err);
  });
}
inherits(Server, tls.Server);


exports.Server = Server;


exports.createServer = function(opts, requestListener) {
  return new Server(opts, requestListener);
};


// HTTPS agents.

function createConnection(port, host, options) {
  if (typeof port === &#39;object&#39;) {
    options = port;
  } else if (typeof host === &#39;object&#39;) {
    options = host;
  } else if (typeof options === &#39;object&#39;) {
    options = options;
  } else {
    options = {};
  }

  if (typeof port === &#39;number&#39;) {
    options.port = port;
  }

  if (typeof host === &#39;string&#39;) {
    options.host = host;
  }

  return tls.connect(options);
}


function Agent(options) {
  http.Agent.call(this, options);
  this.createConnection = createConnection;
}
inherits(Agent, http.Agent);
Agent.prototype.defaultPort = 443;

var globalAgent = new Agent();

exports.globalAgent = globalAgent;
exports.Agent = Agent;

exports.request = function(options, cb) {
  if (typeof options === &#39;string&#39;) {
    options = url.parse(options);
  }

  if (options.protocol &amp;&amp; options.protocol !== &#39;https:&#39;) {
    throw new Error(&#39;Protocol:&#39; + options.protocol + &#39; not supported.&#39;);
  }

  options = util._extend({
    createConnection: createConnection,
    defaultPort: 443
  }, options);

  if (typeof options.agent === &#39;undefined&#39;) {
    if (typeof options.ca === &#39;undefined&#39; &amp;&amp;
        typeof options.cert === &#39;undefined&#39; &amp;&amp;
        typeof options.ciphers === &#39;undefined&#39; &amp;&amp;
        typeof options.key === &#39;undefined&#39; &amp;&amp;
        typeof options.passphrase === &#39;undefined&#39; &amp;&amp;
        typeof options.pfx === &#39;undefined&#39; &amp;&amp;
        typeof options.rejectUnauthorized === &#39;undefined&#39;) {
      options.agent = globalAgent;
    } else {
      options.agent = new Agent(options);
    }
  }

  return new http.ClientRequest(options, cb);
};

exports.get = function(options, cb) {
  var req = exports.request(options, cb);
  req.end();
  return req;
};
</code></pre>
</div>
</td>
</tr>
</table>
</div>

<h2>Output summary</h2>
<div class="jAnnotation">1 total outputs</div>

<div class="jSectionBody">
<table class="jObjectTable">
<tr>
<td class="jObjectAnnotation">
(<a class="jShowHideLink" id="out0_link" href="javascript:jShowHide('out0');">show</a>)
</td>
<td>
<a href="https://us-east.manta.joyent.com/manta/jobs/61aec44b-dd91-4ca8-c6da-841b7ff7b055/stor/reduce.1.7b9b59de-f207-44ed-8634-4e27aac6b4fc">/manta/jobs/61aec44b-dd91-4ca8-c6da-841b7ff7b055/stor/reduce.1.7b9b59de-f207-44ed-8634-4e27aac6b4fc</a>
<br />
<div id="out0_contents" style="display: none" class="jObjectContents"><pre><code>         c 1182   440132
        cc  254   351897
         h  620   216657
        js 1510   203378
         s   65    88721
        pl  164    85431
        py  188    79270
       asm   32    45631
      html  163    43539
       pod  337    38653
      json  194    31637
        md  343    27893
       txt   43    12749
  markdown   44    12569
       com   39    12395
</code></pre>
</div>
</td>
</tr>
</table>
</div>


<h2>Error summary</h2>
<div class="jAnnotation">0 total errors</div>

<div class="jSectionBody">
<table class="jErrorTable">
</table>
</div>

</div>
</body>
</html>

